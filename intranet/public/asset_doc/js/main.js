!function(e){function t(t){var a=0;return t.closest("form").find('input[type="file"]').each(function(){var t=e(this)[0].files;if(t.length>0)for(var n=0;n<t.length;n++)a+=t[n].size}),a}function a(){e(".select-remote-assignee").each(function(){var t=e(this);t.select2({minimumInputLength:2,ajax:{url:t.data("remote-url"),dataType:"json",delay:250,data:function(a){var n=[];return t.closest(".table-list-assignee").find("tbody tr").each(function(){var t=e(this).attr("data-emp");t&&n.push(t)}),{q:a.term,page:a.page,"exclude_ids[]":n,type:t.data("type")}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:20*t.page<e.total_count}}},cache:!0}})})}function n(t,a,n,i){"undefined"==typeof a&&(a=[]),"undefined"==typeof n&&(n=[]),s=e.ajax({url:docParams.urlGetSuggestReviewers,type:"GET",data:{doc_id:t,"team_ids[]":a,"employee_ids[]":n},success:function(t){var a=e("#tbl_reviewers tbody");a.find(".item-none").remove(),e("<table>"+t+"</table>").find("tr").each(function(){var t=e(this).attr("data-emp");a.find('tr[data-emp="'+t+'"]').length<1&&a.append(e(this)[0].outerHTML)})},error:function(e){bootbox.alert({className:"modal-warning",message:e.responseJSON})},complete:function(){"undefined"!=typeof i&&i()}})}"undefined"==typeof docParams&&(docParams={});var i=window.location.hash;i&&e("html, body").animate({scrollTop:e("#comment_box").offset().top},500);var o=window.location.search;o.indexOf("comment_page")>-1&&e("html, body").animate({scrollTop:e("#comment_box").offset().top},500),o.indexOf("history_page")>-1&&e("html, body").animate({scrollTop:e("#box_history").offset().top},500),e("body").on("change",'input[type="file"]',function(){if("fileUpload"!=e(this).attr("id")){e(this).parents().find(".text-green").remove();var a=e(this)[0].files[0];return t(e(this))>1024*docParams.maxSize?(bootbox.alert({className:"modal-danger",message:docParams.errorFileMaxSize+" ("+a.name+")",buttons:{ok:{label:confirmYes}}}),e(this).val(""),!1):void e(this).after('<span class="text-green">('+(a.size/1024).toFixed(2)+" KB)</span>")}}),e("#btn_add_input_file").click(function(t){t.preventDefault();var a=e(this).closest(".upload-wrapper").find(".list-input-fields");a.append('<div class="attach-file-item"><button class="btn btn-danger btn-sm btn-del-file" type="button"><i class="fa fa-close"></i></button><input type="file" name="'+e(this).data("name")+'"></div>')}),e("#btn_save_doc").click(function(){e(this).closest("form").find('input[name="status"]').val("")}),e(".btn-submit").click(function(){var t=e(this),a=t.closest("form");if(!a.valid())return void setTimeout(function(){t.prop("disabled",!1)},100);var n=a.find('input[name="status"]');return bootbox.confirm({className:"modal-warning",message:t.data("noti"),buttons:{cancel:{label:confirmNo},confirm:{label:confirmYes}},callback:function(e){e?(n.val(t.data("status")),a.submit()):t.prop("disabled",!1)}}),!1}),e(".multiselect2").length>0&&e(".multiselect2").multiselect({includeSelectAllOption:!1,numberDisplayed:2,nonSelectedText:"None selected",allSelectedText:"Selected all",nSelectedText:" Selected",enableFiltering:!0,enableCaseInsensitiveFiltering:!0,buttonText:function(t,a){if(0===t.length)return"None selected";if(t.length>2)return t.length+" selected";var n=[];return t.each(function(){n.push(e(this).text().trim())}),n.join(", ")+""}}),e("body").on("click",".btn-del-comment",function(t){t.preventDefault();var a=e(this).attr("data-url");if(a&&!e(this).is(":disabled")){var n=e(this);bootbox.confirm({className:"modal-danger",message:textConfirmDelete,buttons:{cancel:{label:confirmNo},confirm:{label:confirmYes}},callback:function(t){if(t){n.prop("disabled",!0);var i=n.closest(".comment-item");i.addClass("deleting"),e.ajax({type:"DELETE",url:a,data:{_token:siteConfigGlobal.token},success:function(){i.remove(),"undefined"!=typeof docParams&&(window.location.href=docParams.editUrl+"?comment_page=1")},error:function(e){var t=e.responseJSON.message;"undefined"==typeof t&&(t="Error!"),bootbox.alert({className:"modal-danger",message:t,buttons:{ok:{label:confirmYes}}})},complete:function(){n.prop("disabled",!1),i.removeClass("deleting")}})}}})}}),e("body").on("click",".btn-del-file",function(t){t.preventDefault(),e(this).closest(".attach-file-item").remove()}),e("#doc_publish_form").length>0&&e("#doc_publish_form").validate({ignore:[],rules:{"team_ids[]":{required:function(){return!e("#account_ids").val()}},email_subject:{required:!0}},errorPlacement:function(e,t){e.appendTo(t.closest(".form-group"))}}),e("body").on("change","#select_reviewer",function(t){t.preventDefault();var a=e(this),i=docParams.urlAddAssignee,o=a.attr("data-type");if("undefined"!=typeof i&&"undefined"!=typeof o){var s=a.val();if(s||o==docParams.typeEditor){a.prop("disabled",!0);var l=a.closest("tr").find(".add-loading");l.removeClass("hidden"),n(documentId,[],[s],function(){l.addClass("hidden"),a.prop("disabled",!1),a.val("").trigger("change")})}}}),a(),e("body").on("click",".btn-add-assignee",function(t){t.preventDefault();var a=e(this),n=a.attr("data-url"),i=a.attr("data-type");if("undefined"!=typeof n&&"undefined"!=typeof i){var o=a.closest(".tr-add-form").find("select"),s=o.val();if(!s&&i!=docParams.typeEditor)return void bootbox.alert({className:"modal-warning",message:textRequestAccount,buttons:{ok:{label:confirmYes}}});var l=a.closest("tr"),r=e('.tr-toggle[data-toggle="'+l.data("toggle")+'"]').not(l[0]),d=l.find(".add-loading");d.removeClass("hidden"),e.ajax({type:"POST",url:n,data:{type:i,employee_id:s,_token:siteConfigGlobal.token},success:function(t){r.find("td:first").text(t.displayName),t.itemHistory&&e("#list_histories").prepend(t.itemHistory),l.find(".btn-toggle").click(),i==docParams.typePublisher&&window.location.reload()},error:function(e){bootbox.alert({className:"modal-danger",message:e.responseJSON})},complete:function(){d.addClass("hidden")}})}}),e("body").on("click",".btn-del-assignee",function(t){t.preventDefault();var a=e(this);if(e("#tbl_reviewers tbody tr").length<2)return void bootbox.alert({className:"modal-danger",message:textMustHasPerson});var n=a.attr("data-type");if("undefined"!=typeof n){var i=a.closest("tr");bootbox.confirm({className:"modal-danger",message:textConfirmDelete,buttons:{cancel:{label:confirmNo},confirm:{label:confirmYes}},callback:function(e){e&&i.remove()}})}}),e(".checkbox-all").click(function(){var t=e(this).closest(".form-group").find(".checkbox-group");t.find('input[type="checkbox"]').prop("checked",e(this).is(":checked"))}),e('.checkbox-group input[type="checkbox"]').click(function(){var t=e(this).closest(".form-group").find(".checkbox-all"),a=e(this).closest(".checkbox-group");t.prop("checked",a.find('input[type="checkbox"]').length===a.find('input[type="checkbox"]:checked'))}),e(".btn-add-type").click(function(t){t.preventDefault();var a=e(this);if(!a.is(":disabled")){var n=a.closest(".form-add-type"),i=n.find(".type-name").val(),o=n.find(".type-parent").val();if(!i)return bootbox.alert({className:"modal-danger",message:textAlertInputData,buttons:{ok:{label:confirmYes}}}),!1;a.prop("disabled",!0),e.ajax({type:"POST",url:n.data("url"),data:{_token:siteConfigGlobal.token,name:i,parent_id:o},success:function(t){var a=e("#type_checkbox ul"),i=0;o&&(i=parseInt(a.find('li[data-id="'+o+'"]').attr("data-depth"))+1);var s='<li data-id="'+t.id+'" data-depth="'+i+'">'+"&nbsp;".repeat(8*i)+'<label><input type="checkbox" checked name="type_ids[]" value="'+t.id+'"> '+e("<div>"+t.name+"</div>").text()+"</label></li>",l='<option value="'+t.id+'">'+"--".repeat(i)+" "+e("<div>"+t.name+"</div>").text()+"</option>";o?(a.find('li[data-id="'+o+'"]').after(s),n.find('.type-parent option[value="'+o+'"]').after(l)):(a.append(s),n.find(".type-parent").append(l)),n.find(".type-name").val(""),n.find(".type-parent").val("").trigger("change")},error:function(e){bootbox.alert({className:"modal-danger",message:e.responseJSON,buttons:{ok:{label:confirmYes}}})},complete:function(){a.prop("disabled",!1)}})}}),e(".el-short-content").each(function(){var t=e(this).attr("data-showchars")||120;e(this).shortedContent({showChars:t})}),e(".tr-toggle .btn-toggle").click(function(t){t.preventDefault();var a=e(this).closest("tr"),n=e('.tr-toggle[data-toggle="'+a.data("toggle")+'"]').not(a[0]);a.addClass("hidden"),n.removeClass("hidden");var i=a.find(".select2-container");i.length<1&&(i=n.find(".select2-container")),i.width(240)}),e(".doc-form").length>0&&(jQuery.extend(jQuery.validator.messages,{required:requiredText}),e(".doc-form").validate({ignore:"",rules:{code:{required:!0,maxlength:255,remote:{url:docParams.urlCheckExistCode,type:"POST",data:{_token:siteConfigGlobal.token,id:function(){return e('input[name="id"]').length>0?e('input[name="id"]').val():null},code:function(){return e('input[name="code"]').val()}}}},file:{required:function(){var t=e('input[name="file_id"]'),a=e('input[name="file_link"]');if(e("#type_document").is(":checked")===!0)return!(t.length>0&&t.val()||a.length>0&&a.val())}},id_magazine:{required:function(){if(e("#type_magazine").is(":checked")===!0)return!0}},"team_ids[]":{required:!0},"assignees[3]":{required:!0}},messages:{code:{remote:docParams.errorCodeExists}},errorPlacement:function(t,a){var n=a.attr("name"),i=a;i="file"===n||"id_magazine"===n?e(a).closest(".file-group").find("label:first"):e(a).closest(".form-group").find("label:first"),t.insertAfter(i)}})),e(".list-types-bar li b").click(function(t){t.preventDefault();var a=e(this).closest("li");a.hasClass("open")?(a.find(">ul.list-child").slideUp(),a.removeClass("open"),e(this).removeClass("fa-minus").addClass("fa-plus")):(a.find(">ul.list-child").slideDown(),a.addClass("open"),e(this).addClass("fa-minus").removeClass("fa-plus"))}),e(".list-types-bar li.active").each(function(){var t=e(this).find(">div>b");t.length>0&&t.click(),e(this).parents(".list-child").each(function(){e(this).parent("li").find(">div>b").click()})}),e(".radio-show-box").change(function(){e(".radio-show-box-content").slideUp(),e("#radio_show_box_"+e(this).val()).slideDown()}),e(".radio-show-box:checked").trigger("change"),e("#checkbox_send_mail").change(function(){var t=e(this).closest(".form-group").next(".send-mail-box");e(this).is(":checked")?t.slideDown():t.slideUp()}),e("#doc_publish_btn").click(function(){var t=e(this).data("noti"),a=e(this).closest("form");return e("#checkbox_send_mail").is(":checked")?bootbox.confirm({className:"modal-warning",message:t,buttons:{cancel:{label:confirmNo},confirm:{label:confirmYes}},callback:function(e){e&&a[0].submit()}}):a[0].submit(),!1});var s=null;e("body").on("click",".btn-suggest-reviewer",function(t){t.preventDefault();var a=e(this),i=[];if(e('.doc-team-group input[type="checkbox"]:checked').each(function(){i.push(e(this).val())}),!(i.length<1)){var o=a.find("i");o.removeClass("hidden"),a.prop("disabled",!0),n(documentId,i,[],function(){o.addClass("hidden"),a.prop("disabled",!1)})}})}(jQuery);