function initManageButton(){pageType==typeArr[0]?($("#delete").css({visibility:"hidden"}),$("#delete").addClass("hidden")):($("#delete").css({visibility:"visible"}),$("#delete").removeClass("hidden"))}function setHelp(e,t,a,n,i,o,l){$("#help-id").val(e),$("#help-title").val(t),$("#help-active").val(a),$("#help-parent").val(n).trigger("change.select2"),$("#help-slug").val(l),setParentHelp(e),$("#help-order").val(i),setCKEditorContent("help-content",o),window.history.pushState("","","/help/edit/"+e)}function setParentHelp(e){$("#help-parent option").prop("disabled",!1);var t=$('#help-parent option[value="'+e+'"]'),a=t.next("option");t.prop("disabled",!0);try{for(var n=t.attr("class").split("-").pop();n<a.attr("class").split("-").pop();)$('#help-parent option[value="'+a.val()+'"]').prop("disabled",!0),a=a.next("option")}catch(i){i instanceof TypeError}$("#help-parent").reloadSelect2()}function customMenu(e){var t={createItem:{label:"Create Child",action:function(){var e=$("#help-id").val();$("#addHelp").trigger("click"),$("#help-parent").val(e).trigger("change.select2")}},deleteItem:{label:"Delete",action:function(){$("#delete").is(":disabled")||$("#delete").trigger("click")}}};return t}function setHelpbyID(e){waiting(),$.ajax({type:"get",url:getHelp,data:{id:e.selected.toString(),_token:_token},success:function(e){e.parent||(e.parent="#"),setHelp(e.id,e.title,e.active,e.parent,e.order,e.content,e.slug),finish()},error:function(e,t,a){finish()}})}function viewFile(e){$("#modal-view-file iframe").html(""),$("#modal-view-file iframe").attr("src",e),$("#modal-view-file").modal("show")}function appendViewFileElement(){$("#help-content a").each(function(){var e=$(this),t=$(this).attr("href");if(t&&t.length>0){var a=t.replace(/^(http|https):\/\/(.){0,99}(\.com)/,"");if(t===a){var n=a.substring(a.lastIndexOf("/")+1);/(pdf|doc|docx|jpg|xlsx|pptx|xls|csv|png)$/gi.test(n)&&$.ajax({url:t,error:function(){},success:function(){var a="http://"+window.location.hostname+t,n=JSON.stringify("https://docs.google.com/gview?url="+a+"&embedded=true");e.parent().append("&nbsp;&nbsp;<a style='color:red;' data-toggle='modal' href='#' onclick='viewFile("+n+")'>View File</a>")}})}}})}function setHelpContentbyID(e){waiting(),$.ajax({type:"get",url:getHelpContent,data:{id:e,_token:_token},success:function(e){$("#help-title").html(htmlEntities(e.title)),$("#help-content").html(e.content),window.history.pushState("","","/help/view/"+e.id),appendViewFileElement(),finish()},error:function(e,t,a){finish()}})}function createHelp(){"visible"==$("#delete").css("visibility")&&($("#delete").css({visibility:"hidden"}),$("#delete").addClass("hidden")),waiting(),$("#container").jstree().deselect_all(),$("#help-id").val(""),$("#help-title").val(""),$("#help-active").val(0),$("#help-parent option").prop("disabled",!1),$("#help-slug").val(""),$("#help-parent").reloadSelect2(),$("#help-parent").val("#").trigger("change.select2"),$("#help-order").val(""),removeCKEditorContent("help-content",function(){}),window.history.pushState("","","/help/create"),finish()}function saveHelp(){var e={};e.id=$("#help-id").val(),e.title=$("#help-title").val(),e.active=$("#help-active").find(":selected").val(),e.parent=$("#help-parent").find(":selected").val(),e.order=$("#help-order").val(),e.content=CKEDITOR.instances["help-content"].getData(),waiting(),$.ajax({type:"post",url:saveHelpRoute,data:{item:JSON.stringify(e),_token:_token},success:function(e){if(e.success)if($("#modal-success-notification > .modal-dialog > .modal-content > .modal-header > .modal-title").text(e.notification),$("#modal-success-notification > .modal-dialog > .modal-content > .modal-body > .text-default").text(e.message),$("#modal-success-notification").modal("show"),e.data&&setTimeout(function(){window.location.href=e.routerView},1500),$("#help-id").val()){var t=$("#container").find(".jstree-clicked").parent().attr("id");$("#container").jstree().rename_node(t,htmlEntities(e.data.title)),e.data.parent||(e.data.parent="#"),e.data.parent!=$("#container").jstree().get_parent(t)&&($('option[value="'+e.data.id+'"]').detach().insertAfter('option[value="'+e.data.parent+'"]'),$("#container").jstree().is_loaded(e.data.parent)?$("#container").jstree().move_node(t,e.data.parent,"last"):$("#container").jstree().delete_node(t));var a=-1;if("#"!=e.data.parent)var a=parseInt($('#help-parent option[value="'+e.data.parent+'"]').attr("class").split("-").pop());$('#help-parent option[value="'+e.data.id+'"]').text(appendLevel(a+1)+e.data.title),$("#help-parent").reloadSelect2(),$("#"+t+" > a").addClass("jstree-clicked")}else{$("#container").jstree("deselect_all"),$("#delete").css({visibility:"visible"}),$("#delete").removeClass("hidden"),window.history.pushState("","","/help/edit/"+e.data.id),$("#help-id").val(e.data.id),e.data.parent||(e.data.parent="#"),$("#container").jstree().is_loaded(e.data.parent)&&($("#container").jstree().create_node(e.data.parent,{id:e.data.id,text:htmlEntities(e.data.title),type:"leaf"},"last",function(){}),$("#"+e.data.id+" > a").addClass("jstree-clicked"));var a=-1;if("#"!=e.data.parent)var a=parseInt($('#help-parent option[value="'+e.data.parent+'"]').attr("class").split("-").pop()),n='<option class="level-'+(a+1)+'" value="'+e.data.id+'" disabled>'+appendLevel(a+1)+htmlEntities(e.data.title)+"</option>";else var n='<option class="level-0" value="'+e.data.id+'" disabled>'+appendLevel(a+1)+htmlEntities(e.data.title)+"</option>";$(n).insertAfter('option[value="'+e.data.parent+'"]'),$("#help-parent").reloadSelect2()}e.error&&($("#modal-warning-notification > .modal-dialog > .modal-content > .modal-header > .modal-title").text(e.notification),$("#modal-warning-notification > .modal-dialog > .modal-content > .modal-body > .text-default").text(e.message),$("#modal-warning-notification").modal("show")),$("#save").prop("disabled",!1),finish()},error:function(e,t,a){finish()}})}function appendLevel(e){for(var t="",a=0;a<e;a++)t+="- ";return t}function deleteHelp(){var e=$("#help-id").val();$("#container").jstree().is_leaf(e)?$("#help-confirm-modal").find(".modal-body .text-default").text("Bạn có chắc chắn xóa đối tượng không?"):$("#help-confirm-modal").find(".modal-body .text-default").text("Bạn có chắc chắn xóa đối tượng không? Ấn đồng ý sẽ xóa cả những đối tượng con!"),$("#help-confirm-modal").modal("show"),$("#help-confirm-modal").on("show.bs.modal",function(e){$(this).find(".modal-footer .btn-ok").show(),$(this).find(".modal-body .text-default").show()}),$("#help-confirm-modal > .modal-dialog > .modal-content > .modal-footer > .btn-ok").one("click",function(){$("#help-confirm-modal").modal("hide"),$.ajax({type:"post",url:deleteHelpRoute,data:{id:e,_token:_token},success:function(t){t.success&&($("option:disabled").remove(),$("#container").jstree().delete_node(e),$("#addHelp").click(),$("#modal-success-notification > .modal-dialog > .modal-content > .modal-header > .modal-title").text(t.notification),$("#modal-success-notification > .modal-dialog > .modal-content > .modal-body > .text-default").text(t.message),$("#modal-success-notification").modal("show"),setTimeout(function(){window.location.href=t.routerView},1500)),t.error&&($("#modal-warning-notification > .modal-dialog > .modal-content > .modal-header > .modal-title").text(t.notification),$("#modal-warning-notification > .modal-dialog > .modal-content > .modal-body > .text-default").text(t.message),$("#modal-warning-notification").modal("show"))}})})}function removeCKEditorContent(e){try{CKEDITOR.instances[e].setData("")}catch(t){t instanceof TypeError}}function setCKEditorContent(e,t){try{CKEDITOR.instances[e].setData(t)}catch(a){a instanceof TypeError}}function validateForm(){$("#form-post-edit").validate({rules:{"help[title]":{required:!0,maxlength:255},"help[active]":{required:!0},"help[order]":{number:!0,greaterThan:-1}},messages:{"help[title]":{required:"&nbsp&nbsp"+validateErr[0],maxlength:"&nbsp&nbsp"+validateErr[1]},"help[active]":{required:"&nbsp&nbsp"+validateErr[0]},"help[order]":{greaterThan:"&nbsp&nbsp"+validateErr[2]}},submitHandler:function(){return saveHelp(),!1}}).resetForm(),$.validator.addMethod("greaterThan",function(e,t,a){return e>a})}function searchHelps(e){return waiting(),$("#container").jstree("deselect_all"),(e=htmlEntities(e))?void $.ajax({type:"get",url:searchHelp,data:{id:e,type:pageType,_token:_token},success:function(e){if(e.length>0)for(var t=0;t<e.length;t++)$("#container").jstree()._open_to(e[t]),$("#"+e[t].id+" > a").addClass("jstree-clicked");else 0==$("#search-error").length&&$('<p id="search-error" style="color:red; font-size: 16px">&nbsp&nbsp'+searchErr[0]+"</p>").insertAfter($(".display-search")),setTimeout(function(){$("#search-error").remove()},3500);finish()},error:function(e,t,a){finish()}}):(0==$("#search-empty").length&&$('<p id="search-empty" style="color:red; font-size: 16px">&nbsp&nbsp'+searchErr[1]+"</p>").insertAfter($(".display-search")),finish(),finish(),setTimeout(function(){$("#search-empty").remove()},1500),!1)}function edit(){var e=window.location.pathname.match("\\d+$");window.location.href="http://"+$(location).attr("hostname")+"/help/edit/"+e}function waiting(){$("#overlay").show(),$("html, body").css("cursor","progress")}function finish(){$("#overlay").hide(),$("html, body").css("cursor","default")}function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function enableFixedMenu(){$(document).scroll(function(){var e=$(this).scrollTop(),t=$(".view-wraper").offset().top;$(document).width()>425&&(e>t?$("#contentL").addClass("sticky"):$("#contentL").removeClass("sticky"))})}$.fn.menuItemClickListener=function(){$(this).on("select_node.jstree",function(e,t){"hidden"==$("#delete").css("visibility")&&($("#delete").css({visibility:"visible"}),$("#delete").removeClass("hidden"));try{$("#form-post-edit").validate().resetForm(),setHelpbyID(t)}catch(e){e instanceof TypeError}})},$.fn.menuItemViewClickListener=function(){$(this).on("select_node.jstree",function(e,t){try{$(".button-manage > #edit").css("visibility","visible"),setHelpContentbyID(t.selected.toString())}catch(e){e instanceof TypeError}})},$.fn.initMenu=function(){var e="undefined"!=typeof helpModId?helpModId:window.location.pathname.match("\\d+$");pageType==typeArr[2]?$(this).jstree({core:{check_callback:!0,dblclick_toggle:!1,themes:{name:"proton",responsive:!0},data:menu},types:{parent:{icon:"fa fa-folder-o"},leaf:{icon:"fa fa-file-o"},"default":{}},plugins:["types"]}):$(this).jstree({core:{check_callback:!0,dblclick_toggle:!1,themes:{name:"proton",responsive:!0},data:menu},types:{parent:{icon:"fa fa-folder-o"},leaf:{icon:"fa fa-file-o"},"default":{}},plugins:["contextmenu","types"],contextmenu:{items:customMenu}}),$(this).on("ready.jstree",function(){try{e&&$("#container").jstree().select_node(e)}catch(t){t instanceof TypeError}})},$.fn.clickToSearch=function(){$(this).on("click",function(e){var t=$("#input-search").val();searchHelps(t)})},$.fn.pressEnterToSearch=function(){$(this).keypress(function(e){var t=$("#input-search").val();13==e.which&&searchHelps(t)})},$.fn.showEditButton=function(){var e=window.location.pathname.match("\\d+$");e&&$(this).css("visibility","visible")},$.fn.reloadSelect2=function(){$(this).select2({dropdownCssClass:"bigdrop"})};