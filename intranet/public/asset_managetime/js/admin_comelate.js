var tableStaffLate={init:function(){this.loadSelect2(),this.loadDatePicker(),this.clickButton(),this.createData(),this.updateData(),this.removeRow(),this.addRow()},clickButton:function(){$("body").on("click","button[data-btn-action=edit]",function(){var t=$(this).closest("tr");t.find(".text").addClass("hidden"),t.find(".input").removeClass("hidden")})},checkInput:function(t,e){var a=!0;if(t.find(".f-input").each(function(){var n=$(this).val(),i=$(this).attr("name");if(""===n||void 0===n){var d="."+i+"-error";t.find(d).text("không để trống"),t.find(d).removeClass("hidden"),a=!1}else e[i]=n}),"undefined"!=typeof e.startDate){var n=moment(e.startDate,"DD/MM/YYYY"),i=moment(e.endDate,"DD/MM/YYYY");n>i&&(RKExternal.notify(mesStartLessEnd,!1),a=!1)}return"undefined"!=typeof e.minute&&(e.minute>119||e.minute<0)&&(RKExternal.notify("Số phút không hợp lệ",!1),a=!1),a},createData:function(){var t=this;$("#not-late-time").on("click","button[data-btn-action=create]",function(){var e=this,a=$(e).attr("data-url"),n=$(e).closest("tr");n.find(".error").addClass("hidden");var i={_token:token,id:n.attr("data-row-id")},d=t.checkInput(n,i);d&&($(e).find(".hidden").removeClass("hidden"),$.ajax({type:"post",url:a,data:i,success:function(e){if(e.errors&&t.getMessageErrors(e),e.status){var a=e.data;n.attr("data-row-id",a.id),n.find(".stt").text(++numberj),n.find(".btn-success").attr("data-btn-action","update"),n.find(".btn-success").attr("data-url",urUpdateNotLateTime),t.handlingResultSucees(e,n)}else n.find(".fa-refresh").addClass("hidden"),RKExternal.notify(e.message,!1)},error:function(t){RKExternal.notify(t,!1)}}))})},getMessageErrors:function(t){var e="";$.each(t.errors,function(t,a){$.each(a,function(t,a){e+=a+"\n"})}),RKExternal.notify(e,!1)},handlingResultSucees:function(t,e){var a=t.data;$.each(a,function(t,a){e.find(".txt-"+t).text(a),e.find(".txt-"+t).val(a)}),e.find(".fa-refresh").addClass("hidden"),e.find(".text").removeClass("hidden"),e.find(".input").addClass("hidden"),RKExternal.notify(t.message,!0)},updateData:function(){var t=this;$("#not-late-time").on("click","button[data-btn-action=update]",function(){var e=this,a=$(e).attr("data-url"),n=$(e).closest("tr");n.find(".error").addClass("hidden");var i={_token:token,id:n.attr("data-row-id")},d=t.checkInput(n,i);d&&($(e).find(".hidden").removeClass("hidden"),$.ajax({dataType:"json",type:"post",url:a,data:i,success:function(e){e.errors&&t.getMessageErrors(e),e.status?t.handlingResultSucees(e,n):(n.find(".fa-refresh").addClass("hidden"),RKExternal.notify(e.message,!1))},error:function(t){n.find(".fa-refresh").addClass("hidden"),RKExternal.notify(t,!1)}}))})},removeRow:function(){$("#not-late-time").on("click","button[data-btn-action=delete]",function(){var t=$(this).attr("data-url"),e=$(this).closest("tr"),a={_token:token,id:e.attr("data-row-id")},n=e.find(".txt-emp_name").text(),i=confirm(messageDelete+": "+n+"?");i&&$.ajax({dataType:"json",type:"post",url:t,data:a,success:function(t){if(t.errors){var a="";$.each(t.errors,function(t,e){$.each(e,function(t,e){a+=e+"\n"})}),RKExternal.notify(a,!1)}if(t.status){var n=t.data;$.each(n,function(t,a){e.find(".txt-"+t).text(a),e.find(".txt-"+t).val(a)}),e.css("background","red"),setTimeout(function(){e.remove()},500),RKExternal.notify(t.message,!0)}else RKExternal.notify(t.message,!1)},error:function(t){RKExternal.notify(t,!1)}})})},addRow:function(){var t=this;$(document).on("click",".btn-add",function(e){var a=$(this).attr("data-table-id");$("#"+a+" tbody:last-child")[0];$(rowNotLateTime).find(".stt").text(numberj),$("#"+a+" tbody:last-child").append(rowNotLateTime),t.loadSelect2(),t.loadDatePicker()})},loadSelect2:function(){$(".select-search-employee").selectSearchEmployee()},loadDatePicker:function(){$(".datepicker").datepicker({format:"dd/mm/yyyy"})}};$(function(){tableStaffLate.init()});