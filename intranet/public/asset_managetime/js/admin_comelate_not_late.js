function getRowNewNotLate(t){return'<tr data-row-id="new_not_late_'+t+'"> <td class="text-center">'+t+'</td> <td><div class="text email hidden"></div></td> <td><div class="text name hidden"></div> <div class="input input-box">   <select name="empid" class="form-control select-search-employee" data-remote-url="'+urlSearchEmp+'"></select>   <div class="error empid-error"></div> </div> </td> <td class="col-week"><div class="text week hidden"></div> <div class="input"> <select class="form-control weekdays select2-hidden-accessible" name="weekdays[]" multiple="multiple">'+strDayWeek+' </select> <div class="error weekdays-error"></div> </div> </td> <td class="ct_btn-group"> <div class="text hidden">  <button class="btn btn-primary btn-ss-action" data-btn-action="edit" type="button"><i class="fa fa-pencil"></i></button> <button class="btn btn-danger btn-ss-action" data-btn-action="delete" type="button"><i class="fa fa-trash"></i></button> </div> <div class="input "> <button class="btn btn-success btn-ss-action" data-btn-action="save" type="button"> <i class="fa fa-floppy-o"><i class="fa fa-refresh fa-spin margin-left-10 hidden" hiddenaria-hidden="true"></i></i></button> </div> </td> </tr>'}function loadSelect2(){$(".select-search-employee").selectSearchEmployee(),$(".weekdays").select2()}function setSelectWeek(t,e){if(e){for(var a="",n=0;n<e.length;n++)a+='<span class="label label-default">'+dataDayWeeks[e[n]]+"</span> ";t.find(".week").html(a)}}function updateRow(t,e){var a=t.data;e.find(".email").text(a.emp_email),e.find(".name").text(a.emp_name);var n=a.weekdays.split(",");setSelectWeek(e,n),e.find(".fa-refresh").addClass("hidden"),e.find(".text").removeClass("hidden"),e.find(".input").addClass("hidden"),RKExternal.notify(t.message,!0)}function messageError(t){var e="";$.each(t.errors,function(t,a){$.each(a,function(t,a){e+=a+"\n"})}),RKExternal.notify(e,!1)}$(function(){loadSelect2()}),$("#not-late").delegate("button[data-btn-action=update]","click",function(){var t=$(this).closest("tr"),e=t.find('select[name="empid"]').val(),a=t.find('select[name="weekdays[]"]').val(),n=t.attr("data-row-id"),d=!0;t.find(".error").text(""),""!==e&&null!=e||(t.find(".empid-error").text("Không để trống"),d=!1),""!==a&&null!==a||(t.find(".weekdays-error").text("Không để trống"),d=!1),d&&($(this).find(".hidden").removeClass("hidden"),$.ajax({dataType:"json",type:"post",url:urlUpdateNotLate,data:{_token:token,id:n,empId:e,weekdays:a},success:function(e){e.errors&&messageError(e),e.status?updateRow(e,t):RKExternal.notify(e.message,!1),t.find(".fa-refresh").addClass("hidden")},error:function(t){}}))}),$("body").on("click","button[data-btn-action=edit]",function(){var t=$(this).closest("tr");t.find(".text").addClass("hidden"),t.find(".input").removeClass("hidden")}),$(document).on("click",".btn-add",function(t){var e=$(this).attr("data-table-id"),a=getRowNewNotLate(++numberNotlate);$("#"+e+" tbody:last-child").append(a),loadSelect2()}),$("body").on("click","button[data-btn-action=save]",function(){var t=$(this).closest("tr"),e=t.find('select[name="empid"]').val(),a=t.find('select[name="weekdays[]"]').val(),n=!0;t.find(".error").text(""),""!==e&&null!=e||(t.find(".empid-error").text("Không để trống"),n=!1),""!==a&&null!==a||(t.find(".weekdays-error").text("Không để trống"),n=!1),n&&($(this).find(".hidden").removeClass("hidden"),$.ajax({dataType:"json",type:"post",url:urlSaveNotLate,data:{_token:token,empId:e,weekdays:a},success:function(e){if(e.errors&&messageError(e),e.status){updateRow(e,t);var a="new_not_late_"+numberNotlate,n=$("#not-late").find('tr[data-row-id="'+a+'"]');n.attr("data-row-id",e.data.id),$('tr[data-row-id="'+e.data.id+'"]').find('button[data-btn-action="save"]').attr("data-btn-action","update")}else RKExternal.notify(e.message,!1);t.find(".fa-refresh").addClass("hidden")},error:function(t){}}))}),$("body").on("click","button[data-btn-action=delete]",function(){var t=$(this).closest("tr"),e=t.find(".name").text();e=e.trim();var a=confirm(messageDelete+": "+e+"?");a&&$.ajax({dataType:"json",type:"post",url:urlDeleteNotLate,data:{_token:token,id:t.attr("data-row-id")},success:function(e){e.errors&&messageError(e),e.status?(t.css("background","red"),setTimeout(function(){t.remove()},500),RKExternal.notify(e.message,!0)):RKExternal.notify(e.message,!1)},error:function(t){RKExternal.notify(t,!1)}})});