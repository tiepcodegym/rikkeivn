function startAction(e,t,a,r){var i=$(t).data("DateTimePicker").date(),n=new Date(i),o=getStrDate(n);"increase"===a?increase(n,o,r,t,"timeIn"):decrease(n,o,r,t,"timeIn")}function endAction(e,t,a,r){var i=$(t).data("DateTimePicker").date(),n=new Date(i),o=getStrDate(n);"increase"===a?increase(n,o,r,t,"timeOut"):decrease(n,o,r,t,"timeOut")}function setStartDateOnChange(){var e=$("#datetimepicker-start-date").data("DateTimePicker").date(),t=new Date(e),a=getStrDate(t);setTimeStart(t,a,currentEmpId,"#datetimepicker-start-date"),reCalculateLeaveDay()}function reCalculateLeaveDay(){var e=$("#datetimepicker-start-date").data("DateTimePicker").date(),t=$("#datetimepicker-end-date").data("DateTimePicker").date(),a=currentEmpId,r=getDaysTimekeeping(e,t,a);$("#number_days_off").val(r),$("#number_validate").val(r)}function setEndDateOnChange(){var e=$("#datetimepicker-end-date").data("DateTimePicker").date(),t=new Date(e),a=getStrDate(t);setTimeEnd(t,a,currentEmpId,"#datetimepicker-end-date"),reCalculateLeaveDay()}function dateRange(e,t){var a=[];for(e=new Date(e),t=new Date(t);Date.parse(e)<=Date.parse(t);)a.push(getStrDate(e)),e.addDays(1);return a}function getDaysTimekeeping(e,t,a){for(var r=new Date(e),i=new Date(t),n=getStrDate(r),o=getStrDate(i),s=dateRange(n,o),d=0,l=$("#reason").find(":selected").data("calculate-full-day"),u=0;u<s.length;u++){var c=s[u],m="01",g=s[u].split("-")[0],f=s[u].split("-")[1],p=new Date(g,parseInt(f),0).getDate();0===u&&(m=r.getDate()),u===s.length-1&&(p=i.getDate()),1===(""+m).length&&(m="0"+m),1===(""+p).length&&(p="0"+p),m=new Date(s[u]),p=new Date(s[u]),s.length>1?(u<s.length-1?p.setHours(timeSetting[a][c].afternoonOutSetting.hour,timeSetting[a][c].afternoonOutSetting.minute,0):p.setHours(i.getHours(),i.getMinutes()),0===u?m.setHours(r.getHours(),r.getMinutes()):m.setHours(timeSetting[a][c].morningInSetting.hour,timeSetting[a][c].morningInSetting.minute,0)):(m.setHours(r.getHours(),r.getMinutes()),p.setHours(i.getHours(),i.getMinutes())),parseInt(l)||(isHolidayOrWeekend(m)&&m.setHours(timeSetting[a][c].morningInSetting.hour,timeSetting[a][c].morningInSetting.minute,0),isHolidayOrWeekend(p)&&p.setHours(timeSetting[a][c].afternoonOutSetting.hour,timeSetting[a][c].afternoonOutSetting.minute,0)),d+=getTimeDiffInRange(m,p,a,c)}return"1"===registerBranch?parseFloat(d)<0?0:rounding(parseFloat(d),2):(Math.round(2)/2,rounding(parseFloat(Math.round(2*d)/2),1))}function getTimeDiffInRange(e,t,a,r){var i=864e5,n=new Date(e),o=new Date(t);n.setHours(0,0),o.setHours(0,0);var s=getNumberDaysWeekend(new Date(e),new Date(t)),d=n.getTime(),l=o.getTime(),u=l-d,c=Math.round(u/i*100)/100;if(CalculateFullDay&&(s=0),c-=s,c<0)return 0;var m=getEveningBreak(c,a,r),g=getLunchBreak(e,t,c,a,r),f=m+g+24*s,p=getTimeDiff(e,t)-f;return"1"===registerBranch?parseFloat(rounding(p/getHoursWork(a,r),2)):parseFloat(rounding(p/getHoursWork(a,r),1))}function getHoursWork(e,t){var a=new Date,r=new Date;a.setHours(timeSetting[e][t].morningInSetting.hour,timeSetting[e][t].morningInSetting.minute,0),r.setHours(timeSetting[e][t].afternoonOutSetting.hour,timeSetting[e][t].afternoonOutSetting.minute,0);var i=getLunchBreak(a,r,0,e,t);return getTimeDiff(a,r)-i}function getEveningBreak(e,t,a){var r=new Date,i=new Date;return i.setDate(r.getDate()+1),r.setHours(timeSetting[t][a].afternoonOutSetting.hour,timeSetting[t][a].afternoonOutSetting.minute,0),i.setHours(timeSetting[t][a].morningInSetting.hour,timeSetting[t][a].morningInSetting.minute,0),getTimeDiff(r,i)*e}function getLunchBreak(e,t,a,r,i){var n=new Date,o=new Date;n.setHours(timeSetting[r][i].morningOutSetting.hour,timeSetting[r][i].morningOutSetting.minute,0),o.setHours(timeSetting[r][i].afternoonInSetting.hour,timeSetting[r][i].afternoonInSetting.minute,0);var s=getTimeDiff(n,o),d=a;return isMorningInTime(e)&&!isMorningOutTime(t)?d++:!isMorningInTime(e)&&isMorningOutTime(t)&&d--,d<0&&(d=0),s*d}function isMorningInTime(e){var t=[7,8,9,10,11,12];return $.inArray(e.getHours(),t)!==-1}function isMorningOutTime(e){var t=[7,8,9,10,11,12,13];return $.inArray(e.getHours(),t)!==-1}function getTimeDiff(e,t){return e=parseInt(e.getTime()/1e3),t=parseInt(t.getTime()/1e3),e>t?0:(t-e)/3600}function getNumberDaysWeekend(e,t){e.setHours(0,0),t.setHours(0,0);for(var a=e.getFullYear(),r=0,i=e;i<=t;i.setDate(i.getDate()+1)){a=i.getFullYear();var n=i.getTime();if(isWeekend(i)){for(var o=!1,s=compensationDays.com.length,d=0;d<s;d++)if(dateCom=new Date(compensationDays.com[d]),dateCom.setHours(0,0),getDateTimeCom=dateCom.getTime(),getDateTimeCom==n){o=!0;break}o||r++}else{var l=!1;if("object"==typeof arrAnnualHolidays)for(var u=arrAnnualHolidays.length,d=0;d<u;d++)if(dateAnnual=new Date(a+"-"+arrAnnualHolidays[d]),dateAnnual.setHours(0,0),getDateTimeAnnual=dateAnnual.getTime(),getDateTimeAnnual==n){l=!0;break}if(!l&&"object"==typeof arrSpecialHolidays)for(var c=arrSpecialHolidays.length,d=0;d<c;d++)if(dateSpecial=new Date(arrSpecialHolidays[d]),dateSpecial.setHours(0,0),getDateTimeSpecial=dateSpecial.getTime(),getDateTimeSpecial==n){l=!0;break}l&&r++}}return r}function checkFormLeaveDayRegister(){if($(".managetime-error").hide(),$("#check_status").length>0){var e=$("#check_status").val();if(e==STATUS_APPROVED)return $("#show_notification").text(notificationStatusApproved),$("#modal_allow_edit").modal("show"),!1;if(e==STATUS_CANCEL)return $("#show_notification").text(notificationStatusCanceled),$("#modal_allow_edit").modal("show"),!1}var t=1;$("#check_submit").val(1);var a=$("#datetimepicker-start-date").data("DateTimePicker").date();null==a&&($("#start_date-error").show(),t=0);var r=$("#datetimepicker-end-date").data("DateTimePicker").date();if(null==r&&($("#end_date-error").show(),t=0),null!=a&&null!=r){var i=$("#number_days_off").val();if(parseFloat(i)<=0)$("#end_date_before_start_date-error").show(),t=0;else{var n=$("#register_id").val(),o=$("#employee_id").val();if($("#employee_id").length&&null!=o){var s=checkExistRegister($("#start_date").val(),$("#end_date").val(),n,o);s&&($("#register_exist_error").show(),t=0)}}}if($("#employee_id").length){var o=$("#employee_id").val();null==o&&($("#registrant-error").show(),t=0)}if($("#approver").length){var d=$("#approver").val();null==d&&($("#approver-error").show(),t=0)}var l=$("#reason").find(":selected"),u=l.attr("data-reason-code"),c=$("#number_days_off").val();if(u==USED_LEAVE_DAY){var m=$("#number_days_remain").val(),g=$("#number_unapprove").val();parseFloat(c)-parseFloat(oldNumberDaysOff)>parseFloat(m)-parseFloat(g)&&($("#number_days_off-error").show(),t=0)}if(l.data("type")===leaveSpecialType)if(c>l.data("value"))$("#reason_special_value-error").show(),t=0;else if(parseInt(l.data("repeated"))>0){var n=$("#register_id").val(),o=$("#employee_id").val();if($("#employee_id").length&&null!=o){var f=checkExistRegisterType($("#start_date").val(),n,o);f.exist&&($("#register_type_exist_error").text(f.message),$("#register_type_exist_error").show(),t=0)}}var p=$("#reason").val().trim();""==p&&($("#reason-error").show(),t=0);var _=$("#team_code_pre_of_emp").val().trim(),v=$("#code_prefix_jp").val().trim(),h=$("#reason").val().trim(),D=$("#reason_paid_leave_jp").val().trim();if(_==v){if(h!=D){var k=$("#note").val().trim();""==k&&($("#note-error").show(),t=0)}}else{var k=$("#note").val().trim();""==k&&($("#note-error").show(),t=0)}return 0!=t}function checkRegisterBeforeOffcial(){if(!offcialDate)return!0;var e=$("#datetimepicker-start-date").data("DateTimePicker").date();return new Date(e).getTime()<new Date(offcialDate).getTime()}function checkExistRegister(e,t,a,r){var i=!1;return"undefined"==typeof a&&(a=null),"undefined"==typeof r&&(r=null),$.ajax({type:"GET",url:urlCheckRegisterExist,data:{registerId:a,startDate:e,endDate:t,employeeId:r},async:!1,success:function(e){i=e}}),i}function checkExistRegisterType(e,t,a){var r=!1;return"undefined"==typeof t&&(t=null),"undefined"==typeof a&&(a=null),$.ajax({type:"get",url:urlCheckRegisterTypeExist,data:{registerId:t,startDate:e,employeeId:a,reasonId:$("#reason").val()},async:!1,success:function(e){r=e}}),r}function get2Digis(e){return(e<10?"0":"")+e}function setTimeStart(e,t,a,r){var i=timeWorkingQuater[a][t],n=getStringTime(e);if(!i.timeIn.includes(n)){var o=i.timeIn[0].split(":");e.setHours(o[0],o[1]),$(r).data("DateTimePicker").date(e)}}function setTimeEnd(e,t,a,r){var i=timeWorkingQuater[a][t],n=getStringTime(e);if(!i.timeOut.includes(n)){var o=i.timeOut[i.timeOut.length-1].split(":");e.setHours(o[0],o[1]),$(r).data("DateTimePicker").date(e)}}function increase(e,t,a,r,i){var n=timeWorkingQuater[a][t],o=[];if(2==n[i].length)o=n.timeIn[1].split(":");else{var s=getStringTime(e);switch(getArrayKey(n[i],s)){case 0:o=n[i][1].split(":");break;case 1:o=n[i][2].split(":");break;case 2:o=n[i][3].split(":");break;default:o=n[i][0].split(":")}}hour=o[0],minute=o[1],e.setHours(hour,minute),$(r).data("DateTimePicker").date(e)}function decrease(e,t,a,r,i){var n=timeWorkingQuater[a][t],o=[];if(2==n[i].length)o=n[i][0].split(":");else{var s=getStringTime(e);switch(getArrayKey(n[i],s)){case 3:o=n[i][2].split(":");break;case 2:o=n[i][1].split(":");break;case 1:o=n[i][0].split(":");break;default:o=n[i][3].split(":")}}hour=o[0],minute=o[1],e.setHours(hour,minute),$(r).data("DateTimePicker").date(e)}function getArrayKey(e,t){var a=e.length,r=0;for(r;r<a;r++)if(e[r]==t)return r;return-1}function getStringTime(e){var t=(e.getHours()<10?"0":"")+e.getHours(),a=(e.getMinutes()<10?"0":"")+e.getMinutes();return t+":"+a}function getStringDate(e){var t=(e.getFullYear()<10?"0":"")+e.getFullYear(),a=(e.getMonth()+1<10?"0":"")+(e.getMonth()+1);return t+"-"+a}function getStrDate(e){var t=(e.getFullYear()<10?"0":"")+e.getFullYear(),a=(e.getMonth()+1<10?"0":"")+(e.getMonth()+1),r=(e.getDate()<10?"0":"")+e.getDate();return t+"-"+a+"-"+r}function isHolidayOrWeekend(e){var t=new Date(e);t.setHours(0,0);var a=t.getFullYear(),r=t.getTime();if(isWeekend(e))return!0;if("object"==typeof arrAnnualHolidays)for(var i=arrAnnualHolidays.length,n=0;n<i;n++){var o=new Date(a+"-"+arrAnnualHolidays[n]);o.setHours(0,0);var s=o.getTime();if(s==r)return!0}if("object"==typeof arrSpecialHolidays)for(var d=arrSpecialHolidays.length,n=0;n<d;n++){var l=new Date(arrSpecialHolidays[n]);l.setHours(0,0);var u=l.getTime();if(u==r)return!0}return!1}function updateTimeSettingData(e,t,a){if(t>a){var r=t;t=a,a=r}var i,n=dateRange(t,a),o=!0;for(i=0;i<n.length;i++)if(!timeSetting[e][n[i]]){o=!1,t=n[i];break}if(!o){for(i=n.length-1;i>=0;i--)if(!timeSetting[e][n[i]]){a=n[i];break}$.ajax({type:"post",dataType:"json",url:urlGetTimeSetting,async:!1,data:{period:{start_date:t,end_date:a},empId:e,_token:token},success:function(t){var a=t.timeWorking[e],r=t.timeQuater[e];Object.keys(a).forEach(function(t){timeSetting[e][t]=a[t],timeWorkingQuater[e][t]=r[t]})}})}}$(window).load(function(){$(".se-pre-con").fadeOut("slow")});var $startDateContainer=$("#datetimepicker-start-date"),$endDateContainer=$("#datetimepicker-end-date");$(function(){$(".managetime-upload-file input:file").fileuploader({addMore:!0,extensions:["jpg","jpeg","png","bmp"]}),$(".fancybox").fancybox({openEffect:"none",closeEffect:"none"});var e=0;void 0!==$("#reason").find(":selected").attr("data-salary-rate")&&(e=$("#reason").find(":selected").attr("data-salary-rate")),$("#salary_rate").val(e+" %");for(var t=0;t<weekends.length;t++)$.inArray(weekends[t],compensationDays.com)===-1&&disabledDates.push(moment(weekends[t],"YYYY-MM-DD"));for(var t=0;t<compensationDays.lea.length;t++)disabledDates.push(moment(compensationDays.lea[t],"YYYY-MM-DD"));$("#datetimepicker-start-date").datetimepicker({allowInputToggle:!0,sideBySide:!0,disabledDates:disabledDates,defaultDate:startDateDefault}).on("dp.show",function(){var e=$("#datetimepicker-start-date").data("DateTimePicker").date();$("#datetimepicker-start-date a[data-action=incrementHours]").attr("data-action","increase-hour").attr("href","javascript:void(0)").attr("onclick",'startAction(this, "#datetimepicker-start-date", "increase", '+currentEmpId+")"),$("#datetimepicker-start-date a[data-action=decrementHours]").attr("data-action","decrease-hour").attr("href","javascript:void(0)").attr("onclick",'startAction(this, "#datetimepicker-start-date", "decrease", '+currentEmpId+")"),$("#hidden-end-date").hide(),$("#datetimepicker-end-date").show();var t=$("#check_submit").val();1==t&&(null==e?($("#start_date-error").show(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide()):($("#start_date-error").hide(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide())),setStartDateOnChange()}).on("dp.hide",function(){var e=$("#datetimepicker-start-date").data("DateTimePicker").date();null==e&&($("#hidden-end-date").show(),$("#datetimepicker-end-date").hide(),$("#datetimepicker-end-date").data("DateTimePicker").date(null));var t=$("#check_submit").val();1==t&&(null==start_date?($("#start_date-error").show(),$("#end_date-error").show(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide()):($("#start_date-error").hide(),$("#register_exist_error").hide()))}).on("dp.change",function(){$("#number_days_off-error").hide();var e=$startDateContainer.data("DateTimePicker").date();if(!e)return void $startDateContainer.data("DateTimePicker").date(new Date);var t=$endDateContainer.data("DateTimePicker").date(),a=new Date(e),r=new Date(t),i=currentEmpId;$("select#employee_id").length>0&&null!=$("select#employee_id").val()&&(i=$("select#employee_id").val()),updateTimeSettingData(i,a.format("Y-m-d"),r.format("Y-m-d")),setStartDateOnChange()}),$("#datetimepicker-end-date").datetimepicker({allowInputToggle:!0,sideBySide:!0,disabledDates:disabledDates,defaultDate:endDateDefault}).on("dp.show",function(){$("#datetimepicker-end-date a[data-action=incrementHours]").attr("data-action","increase-hour").attr("href","javascript:void(0)").attr("onclick",'endAction(this, "#datetimepicker-end-date", "increase", '+currentEmpId+")"),$("#datetimepicker-end-date a[data-action=decrementHours]").attr("data-action","decrease-hour").attr("href","javascript:void(0)").attr("onclick",'endAction(this, "#datetimepicker-end-date", "descrease", '+currentEmpId+")");var e=$("#check_submit").val();if(1==e){var t=$("#datetimepicker-end-date").data("DateTimePicker").date();null==t?($("#end_date-error").show(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide()):($("#end_date-error").hide(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide())}setEndDateOnChange()}).on("dp.hide",function(e){var t=$("#check_submit").val();if(1==t){var a=$("#datetimepicker-end-date").data("DateTimePicker").date();null==a?($("#end_date-error").show(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide()):($("#end_date-error").hide(),$("#number_days_off-error").hide(),$("#end_date_before_start_date-error").hide(),$("#register_exist_error").hide())}}).on("dp.change",function(){$("#number_days_off-error").hide();var e=$endDateContainer.data("DateTimePicker").date();if(!e)return void $endDateContainer.data("DateTimePicker").date(new Date);var t=$startDateContainer.data("DateTimePicker").date(),a=new Date(t),r=new Date(e),i=currentEmpId;$("select#employee_id").length>0&&null!=$("select#employee_id").val()&&(i=$("select#employee_id").val()),updateTimeSettingData(i,a.format("Y-m-d"),r.format("Y-m-d")),setEndDateOnChange()}),reCalculateLeaveDay(),$("#managetime-icon-date-start").on("click",function(){$(".managetime-select-2").select2("close"),$("#related_persons").select2("close"),$("#datetimepicker-start-date").data("DateTimePicker").show()}),$("#managetime-icon-date-end").on("click",function(){$("#related_persons").select2("close"),$(".managetime-select-2").select2("close"),$("#datetimepicker-start-end").data("DateTimePicker").show()}),$(".search-employee").select2({ajax:{url:urlSearchRelatedPerson,dataType:"JSON",data:function(e){return{q:$.trim(e.term)}},processResults:function(e){return{results:e}},cache:!0}}),$("#reason").on("select2:select",function(e){var t=$("#reason").find(":selected").attr("data-salary-rate");$("#salary_rate").val(t+" %");var a=$("#reason").find(":selected").attr("data-reason-code");if(a==USED_LEAVE_DAY){var r=$("#check_submit").val();if(1==r){var i=$("#number_days_off").val(),n=$("#number_days_remain").val();parseFloat(i)>parseFloat(n)&&$("#number_days_off-error").show()}checkRegisterBeforeOffcial()?$("#day_off_before_offcial_error").show():$("#day_off_before_offcial_error").hide()}else $("#number_days_off-error").hide(),$("#day_off_before_offcial_error").hide()}),$("#reason").on("change",function(){var e=$(this).find("option:selected").data("calculate-full-day");e?CalculateFullDay=!0:CalculateFullDay=!1,reCalculateLeaveDay()}),$("#button_approve").click(function(){$("#register_id_approve").val($(this).val())}),$("#button_disapprove").click(function(){$("#reason_disapprove-error").hide(),$("#reason_disapprove").val(""),$("#register_id_disapprove").val($(this).val())}),$("#button_approve_submit").click(function(){var e=$("#register_id_approve").val(),t=window.location.href.substr(window.location.href),a=$(this);a.button("loading"),$.ajax({type:"GET",url:urlApprove,data:{registerId:e,urlCurrent:t},success:function(e){$("#modal_approve").modal("hide");var t=JSON.parse(e);window.location=t.url}})}),$("#button_disapprove_submit").click(function(){var e=$("#register_id_disapprove").val(),t=window.location.href.substr(window.location.href),a=$("#reason_disapprove").val();if(""==a.trim())return void $("#reason_disapprove-error").show();var r=$(this);r.button("loading"),$.ajax({type:"GET",url:urlDisapprove,data:{registerId:e,urlCurrent:t,reasonDisapprove:a},success:function(e){$("#modal_disapprove").modal("hide");var t=JSON.parse(e);window.location=t.url}})}),$("#reason_disapprove").keyup(function(){var e=$("#reason_disapprove").val();""==e.trim()?$("#reason_disapprove-error").show():$("#reason_disapprove-error").hide()}),$("#note").keyup(function(){var e=$("#team_code_pre_of_emp").val().trim(),t=$("#code_prefix_jp").val().trim(),a=$("#reason").val().trim(),r=$("#reason_paid_leave_jp").val.trim();if(e!=t&&a!=r){var i=$("#note").val();""==i.trim()?$("#note-error").show():$("#note-error").hide()}}),$("#approver").on("change",function(e){$("#approver-error").hide()})}),Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this};