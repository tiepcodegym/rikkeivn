function checkSubmitRegister(){var e=1;$("#check_submit").val(1);var t=$("#datetimepicker_start").data("DateTimePicker").date();null==t&&($("#start_date-error").show(),e=0);var a=$("#datetimepicker_end").data("DateTimePicker").date();if(null==a&&($("#end_date-error").show(),e=0),$("#employee_id").length){var i=$("#employee_id").val();null==i&&($("#registrant-error").show(),e=0)}""==$("#project_list").val()?($("#project-error").show(),e=0):$("#project-error").hide();var r=$("#reason").val().trim();if(""==r&&($("#reason-error").show(),e=0),t.format("DD-MM-YYYY")==a.format("DD-MM-YYYY")?t>=a&&(RKExternal.notify(mesStartLessEnd,!1),e=0):(RKExternal.notify(mesSameDay,!1),e=0),0==e)return!1;var n=[];return $("#has_set_time_break .set-time-break-item").each(function(){n.push({time_break:$(this).find(".time-break-value").val(),date:$(this).find(".time-break-date .time-break-date-val").text()})}),$("#time_breaks").val(JSON.stringify(n)),!0}function checkStartDate(){var e=$("#datetimepicker_start").data("DateTimePicker").date(),t=$("#project_list").val(),a=new Date(e),i=timeSetting[idCurrent][e.format("YYYY-MM-DD")].afternoonOutSetting,r=new Date(e);if(r.setHours(i.hour,i.minute),r.setTime(r.getTime()+36e5),isWeekendOrHoliday(a)){var n=timeSetting[idCurrent][e.format("YYYY-MM-DD")].morningInSetting,o=new Date(e);o.setHours(n.hour,n.minute),a<o&&$("#datetimepicker_start").data("DateTimePicker").date(o)}else projectAllowedOT18Key.indexOf(t)>=0?(a.setHours(i.hour,i.minute),$("#datetimepicker_start").data("DateTimePicker").date(a)):a<r&&(a.setHours(r.getHours(),r.getMinutes()),$("#datetimepicker_start").data("DateTimePicker").date(a))}function setTimeDefaultStart(e){var t=$("#datetimepicker_start").data("DateTimePicker").date(),a=timeSetting[idCurrent][t.format("YYYY-MM-DD")].morningInSetting,i=new Date(t),r=new Date(t);e.oldDate&&(r=new Date(moment(e.oldDate.format("DD-MM-YYYY HH:mm").toString(),"DD-MM-YYYY HH:mm"))),i.setHours(a.hour,a.minute),e.oldDate&&e.oldDate.format("DD-MM-YYYY")!==t.format("DD-MM-YYYY")&&isWeekendOrHoliday(i)&&!isWeekendOrHoliday(r)&&$("#datetimepicker_start").data("DateTimePicker").date(i)}function isWeekendOrHoliday(e){var t=new Date(e.getTime());t.setHours(0,0);var a=t.getDay(),i=t.getFullYear(),r=t.getTime();if(0==a||6==a)return!0;if("object"==typeof annualHolidayList)for(var n=annualHolidayList.length,o=0;o<n;o++){var m=new Date(i+"-"+annualHolidayList[o]);m.setHours(0,0);var d=m.getTime();if(d==r)return!0}if("object"==typeof specialHolidayList)for(var s=specialHolidayList.length,o=0;o<s;o++){var l=new Date(specialHolidayList[o]);l.setHours(0,0);var c=l.getTime();if(c==r)return!0}return!1}function showHideBreak(){var e=moment($("#datetimepicker_start").find("input:first").val(),"DD-MM-YYYY"),t=moment($("#datetimepicker_end").find("input:first").val(),"DD-MM-YYYY");e=new Date(e),t=new Date(t),hasHolidayOrWeekend(e,t,annualHolidayList,specialHolidayList)?$("#form_set_time_break").show():$("#form_set_time_break").hide()}function saveSetTimeBreak(){var e=0,t="",a=0;$("#box_set_time_break .time-break-value").each(function(){var i=parseFloat($(this).val());if(""!=$(this).val()&&null!==$(this).val()&&(i>14&&(a=1,$(this).parent().find(".max_time_break-error").show()),0==a&&(e+=parseFloat($(this).val()))),0==a){var r=$(this).closest(".set-time-break-item").find(".time-break-date").html();i=i.toFixed(2),t=t+"<div class='set-time-break-item row'><div class='col-md-4 ot-form-group'><label class='control-label time-break-date'>"+r+"</label></div><div class='col-md-8 ot-form-group'><input type='text' class='form-control time-break-value' value='"+i+"'></div></div>"}}),1!=a&&($("#check_set_break_time").val(1),$("#total_time_break").val(e.toFixed(2)),$("#has_set_time_break").html(t),$("#modal_set_time_break").modal("hide"))}$(document).on("keyup",".time-break-value",function(){$(this).parent().find(".max_time_break-error").hide()}),$(".ot-select-2").select2({minimumResultsForSearch:1/0}),$(".minimal").iCheck({checkboxClass:"icheckbox_square-blue"});var $employeeSelect=$("#employee_id"),$startDateContainer=$("#datetimepicker_start"),$endDateContainer=$("#datetimepicker_end");$("#reason").keyup(function(){var e=$("#reason").val();""==e.trim()?$("#reason-error").show():$("#reason-error").hide()}),$employeeSelect.on("change",function(){$("#registrant-error").hide();var e=$employeeSelect.val(),t=new Date($startDateContainer.data("DateTimePicker").date()).format("Y-m-d"),a=new Date($endDateContainer.data("DateTimePicker").date()).format("Y-m-d"),i={empId:e,start_at:t,end_at:a};t>a&&(i.start_at=a,i.end_at=t),$.ajax({url:urlGetProject,type:"GET",data:i,dataType:"JSON",success:function(t){var a=document.getElementById("project_list");a.options.length=0;for(var i=t.projects,r='<option value="'+keyNotProject+'">'+notProject[keyNotProject]+"</option>",n=0;n<i.length;n++)r+="<option value="+i[n].project_id+">"+i[n].projName+"</option>";$("#project_list").append(r),idCurrent=e,timeSetting[e]=t.timeSetting[e],checkStartDate()}})}),$("#datetimepicker_start").datetimepicker({allowInputToggle:!0,format:"DD-MM-YYYY HH:mm",sideBySide:!0}).on("dp.hide",function(){checkStartDate(),showHideBreak()}).on("dp.change",function(e){if(!$startDateContainer.data("DateTimePicker").date())return void $startDateContainer.data("DateTimePicker").date(moment(startDateDefault,"DD-MM-YYYY HH:mm"));var t=new Date($startDateContainer.data("DateTimePicker").date()).format("Y-m-d"),a=new Date($endDateContainer.data("DateTimePicker").date()).format("Y-m-d");updateTimeSettingData(idCurrent,t,a),setTimeDefaultStart(e)}),$("#datetimepicker_end").datetimepicker({allowInputToggle:!0,format:"DD-MM-YYYY HH:mm",sideBySide:!0}).on("dp.hide",function(){showHideBreak()}).on("dp.change",function(e){var t=$("#datetimepicker_end").data("DateTimePicker").date(),a=t?new Date(t):moment(endDateDefault,"DD-MM-YYYY HH:mm").toDate();(22==a.getHours()&&a.getMinutes()>0||a.getHours()>22)&&a.setHours(22,0),$("#datetimepicker_end").data("DateTimePicker").date(a),t=new Date($endDateContainer.data("DateTimePicker").date()).format("Y-m-d");var i=new Date($startDateContainer.data("DateTimePicker").date()).format("Y-m-d");updateTimeSettingData(idCurrent,i,t)}),$("#project_list").change(function(){""==$("#project_list").val()?$("#project-error").show():$("#project-error").hide(),checkStartDate()}),$(".btn-set-time-break").click(function(e){e.preventDefault();var t=$("#check_change_date").val(),a=$("#check_set_break_time").val();if(1==t||0==t&&0==a){$("#box_set_time_break").html("");var i=moment($("#datetimepicker_start").find("input:first").val(),"DD-MM-YYYY"),r=moment($("#datetimepicker_end").find("input:first").val(),"DD-MM-YYYY");if(null!=i&&null!=r){i=new Date(i),r=new Date(r),i.setHours(0,0),r.setHours(0,0);for(var n=i;n<=r;n.setDate(n.getDate()+1)){var o=isHolidayOrWeekend(n,annualHolidayList,specialHolidayList);if(o){var m=n.getMonth()+1;m=m.toString(),1===m.length&&(m="0"+m);var d=n.getDate();d=d.toString(),1===d.length&&(d="0"+d);var s=getDayOfWeek(n.getDay());$("#duplicate_set_time_break_item .time-break-date .time-break-date-val").text(d+"/"+m+"/"+n.getFullYear()),$("#duplicate_set_time_break_item .time-break-date .time-break-date-day").text(" ("+s+")");var l=$("#duplicate_set_time_break_item").html();$("#box_set_time_break").append(l)}}}}else $("#box_set_time_break").html($("#has_set_time_break").html());$(".time-break-value").limitBreakInputLength(),$("#check_change_date").val(0),$("#modal_set_time_break").modal("show")});