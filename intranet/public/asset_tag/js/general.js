!function(e){var t={};t.getHtmlFieldTree={treePath:null,html:null,option:{},init:function(e,a,n,i,r){if("undefined"==typeof e||"undefined"==typeof a||!e||!a)return!0;switch("undefined"==typeof r&&(r={}),this.treePath=a,this.html="",this.option=r,n){case 2:this.html=[],this.html.push({id:e,label:t.general.htmlDecode("&nbsp;")}),this._getOptionRecursive(e,i,0);break;default:this._getHtmlRecursive(e,0)}return this.html},_getHtmlRecursive:function(e,a){var n=this;if("undefined"==typeof n.treePath[e]||!n.treePath[e].child.length)return"";var i,r=n.treePath[e].child,o=t.general.htmlLevel(a);for(i in r){var s,l=r[i],d=n.treePath[l];"undefined"!=typeof n.treePath[l]&&(s=this.option.attrMore?this.option.attrMore.replace(/\{\{id\}\}/gi,l):"",n.html+='<li data-id="'+l+'" class="field-item" ng-class="{\'active\': '+l+'==fieldActiveId}" data-parent-id="'+e+'" '+s+'><span><a href="javascript:void(0)">'+o+'<span class="field-color" style="background-color: '+d.data.color+'"></span><span class="field-text">'+d.data.name+'</span>&nbsp;&nbsp;<span class="tag-count tc-label" ng-if="fieldTagReviewCount['+l+"] > 0 || fieldTagTotal["+l+'] > 0">(</span><span class="tag-count" ng-if="fieldTagReviewCount['+l+'] > 0"><span ng-bind="fieldTagReviewCount['+l+']"></span>/</span><span class="tag-count tc-total" ng-if="fieldTagTotal['+l+'] > 0"><span ng-bind="fieldTagTotal['+l+']"></span></span><span class="tag-count tc-label" ng-if="fieldTagReviewCount['+l+"] > 0 || fieldTagTotal["+l+'] > 0">)</span></a></span>',n.treePath[l].child.length&&(n.option.type&&n.option.type==n.treePath[l].data.type&&n.option.level&&n.option.level-2<a||n._getHtmlRecursive(l,a+1)),n.html+="</li>")}},_getOptionRecursive:function(e,a,n){var i=this;if("undefined"==typeof i.treePath[e]||!i.treePath[e].child.length)return"";"undefined"==typeof a&&(a=0);var r,o,s,l=i.treePath[e].child;for(r in l){var d=l[r];if("undefined"!=typeof i.treePath[d]&&a!=d&&(!i.option.type||i.option.type!=i.treePath[d].data.type)){for(s="",o=0;o<n;o++)s+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";s+=i.treePath[d].data.name,i.html.push({id:d,label:t.general.htmlDecode(s)}),n<0&&i.treePath[d].child.length&&i._getOptionRecursive(d,a,n+1)}}}},t.general={getTemplate:function(e){return RKVarGlobalTag.pathAssetTemplate+"/"+e+"?v="+RKVarGlobalTag.assetVersion},notifyError:function(t){"undefined"==typeof t&&(t="System error"),e.notifyClose(),e.notify({message:t},{type:"warning",z_index:2e3})},notifySuccess:function(t){"undefined"==typeof t&&(t="Success"),e.notifyClose(),e.notify({message:t},{type:"success",z_index:2e3})},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue},treeCreateItem:function(a,n,i,r){var o,s,l=e('field-list-tree[data-type-id="'+a+'"] .tree-list'),d=l.find('.field-item[data-id="'+n+'"]');return o=a==n?-1:d.find(".indent").length,null!==i?r=e('<li class="field-item" ng-click="fieldItemClick($event);" data-id="'+i.id+"\" ng-class=\"{'active': "+i.id+'==fieldActiveId}"data-parent-id="'+n+'"><span><a href="#">'+t.general.htmlLevel(o+1)+'<span class="field-color" style="background-color: '+i.color+'"></span><span class="field-text">'+i.name+"</span></a></span></li>"):r.attr("data-parent-id",n),a==n?(l.append(r),r):(s=l.find('.field-item[data-parent-id="'+n+'"]').last(),s.length?s.after(r):d.after(r),r)},htmlLevel:function(e){var t,a="";if(e>0)for(t=0;t<e;t++)a+='<span class="indent"></span>';return a},popupConfirmDanger:function(t,a){"undefined"!=typeof t.message&&null!==t.message||(t.message="Are you sure delete item?"),"undefined"!=typeof t.title&&null!==t.title||(t.title=RKTagTrans.Confirm),"undefined"==typeof a&&(a={});var n=e("#ng-modal-delete-confirm");return n.length?(n.find(".modal-title").html(t.title),n.find(".modal-body").html(t.message)):(n=e('<div class="modal fade modal-danger" id="ng-modal-delete-confirm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button><h4 class="modal-title">'+t.title+'</h4></div><div class="modal-body">'+t.message+'</div><div class="modal-footer"><button type="button" class="btn btn-outline btn-close" data-dismiss="modal">Close</button><button type="button" class="btn btn-outline btn-ok">OK</button></div></div></div></div>'),e("body").append(n)),n.modal("show"),"undefined"==t.ok||(a.modal=n,e("#ng-modal-delete-confirm .btn-ok").on("click",function(){t.ok(a),e("#ng-modal-delete-confirm .btn-ok").off("click"),a.modal.modal("hide")}),n.on("hide.bs.modal",function(){e("#ng-modal-delete-confirm .btn-ok").off("click"),"function"==typeof t.close&&t.close(a)}),void n.on("hidden.bs.modal",function(){"function"==typeof t.closed&&t.closed(a)}))},fieldTagTypes:function(e){var t,a,n={approve:{},review:{}};for(t in e)a=e[t],a.status==RKVarGlobalTag.tagStatusApprove?n.approve[a.id]=a:n.review[a.id]=a;return n},jsonArrayToInt:function(e){var t,a={};for(t in e)a[t]=this.json2ToInt(e[t]);return a},json2ToInt:function(e){var t,a={};for(t in e)a[t]=this.jsonToInt(e[t]);return a},jsonToInt:function(e){var t,a={};for(t in e)isNaN(e[t])||!e[t]?a[t]=e[t]:a[t]=parseInt(e[t]);return a},jsonToArray:function(e,t){var a,n=[];"undefined"==typeof t&&(t=!0);for(a in e)t&&(a=parseInt(a)),n.push({id:a,label:e[a]});return n},objectFilter:function(e,t){var a,n={};if("undefined"==typeof t||!t.length||!e)return n;for(a in e)a=parseInt(a),t.indexOf(a)>=0&&(n[a]=e[a]);return n},validateRemoteDelay:function(){e(document).on("focus",'form [data-validate-remote="1"]',function(){e(this).closest("form").validate().settings.onkeyup=!1}),e(document).on("blur",'form [data-validate-remote="1"]',function(){e(this).closest("form").validate().settings.onkeyup=e.validator.defaults.onkeyup})},notChangeValueObject:function(e,t){try{return Array.isArray(e[t.colGroup][t.colName])||Array.isArray(t.value)?this.equalArray(e[t.colGroup][t.colName],t.value):e[t.colGroup][t.colName]==t.value}catch(a){return!1}},equalArray:function(e,t){if(Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]),e.length!==t.length)return!1;for(var a in e)if(t.indexOf(e[a])<0)return!1;return!0},intersectionArray:function(e,t){Array.isArray(e)||(e=[]),Array.isArray(t)||(t=[]);for(var a in e)if(t.indexOf(e[a])>-1)return!0;return!1},paramField:function(t){var a,n={},i="field";if(n=e.extend(!0,{},t),"undefined"==typeof n[i])return n;for(a in n[i])n[i][a]=n[i][a].join("-");return n},encodeSlugField:function(e){var t,a,n="";for(t in e)a=e[t],n+=t+":"+a.join("-")+"_";return n&&(n=n.slice(0,-1)),n},decodeSlugField:function(e){var t={field:{},tag:[]};return e.split("_").map(function(e){var a=e.split(":");if(2===a.length){var n=a[1].split("-");t.field[a[0]]=n,t.tag=t.tag.concat(n)}}),t},encodeSlugTag:function(e){return e.join("::")},decodeSlugTag:function(e){return e.split("::")}},t.validate={addGreaterDate:function(){e.validator.addMethod("greaterDate",function(t,a,n){return/Invalid|NaN/.test(new Date(t))?isNaN(t)&&isNaN(e(n).val())||Number(t)>Number(e(n).val()):new Date(t)>new Date(e(n).val())},"Must be greater than {0}.")},addGreaterEqualDate:function(){e.validator.addMethod("greaterEqualDate",function(t,a,n){return/Invalid|NaN/.test(new Date(t))?isNaN(t)&&isNaN(e(n).val())||Number(t)>=Number(e(n).val()):new Date(t)>=new Date(e(n).val())},"Must be greater or equal than {0}.")},addLessEqualDate:function(){e.validator.addMethod("lessEqualDate",function(t,a,n){return/Invalid|NaN/.test(new Date(t))?isNaN(t)&&isNaN(e(n).val())||Number(t)<=Number(e(n).val()):new Date(t)<=new Date(e(n).val())},"Must be less or equal than {0}.")}},t.select2={notSearch:function(){return{minimumResultsForSearch:1/0}},remote:function(e){var t=this;return{id:function(e){return e.id},ajax:{url:e,dataType:"json",delay:500,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:20*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},minimumInputLength:1,templateResult:t.__formatReponse,templateSelection:t.__formatReponesSelection}},__formatReponse:function(e){return e.loading?e.text:markup="<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'>"+e.text+"</div></div>"},__formatReponesSelection:function(e){return e.text}},t.teamTree={treePath:{},teamDev:{},arrayCodeTeamDev:[],idsSelected:null,treePathParentTeamDev:[],html:null,init:function(e,t,a){return this.treePath=e,this.teamDev=t,this.arrayCodeTeamDev=Object.keys(t),this.html=[],this._treeDev(),"undefined"!=typeof a&&Array.isArray(a)?this.idsSelected=a:this.idsSelected=[],this._getOptionRecursive(0,0),this.html},_getOptionRecursive:function(e,a){var n=this;if("undefined"==typeof n.treePath[e]||!n.treePath[e].child.length)return null;var i,r,o,s,l,d,c=n.treePath[e].child,u=n.treePath[e];if(n.arrayCodeTeamDev.indexOf(u.data.code)>=0&&!n.teamDev[u.data.code].child)return null;for(i in c)if(d=c[i],s=n.treePath[d],l=!1,"undefined"!=typeof n.treePath[d]&&!(n.arrayCodeTeamDev.indexOf(s.data.code)<0&&n.arrayCodeTeamDev.indexOf(u.data.code)<0&&n.treePathParentTeamDev.indexOf(d)<0)){for((n.arrayCodeTeamDev.indexOf(s.data.code)<0&&n.arrayCodeTeamDev.indexOf(u.data.code)<0||n.arrayCodeTeamDev.indexOf(s.data.code)>=0&&!n.teamDev[s.data.code].self)&&(l=!0),o="",r=0;r<a;r++)o+="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";o+=s.data.name,n.html.push({id:d,label:t.general.htmlDecode(o),disabled:l}),n.treePath[d].child.length&&n._getOptionRecursive(d,a+1)}},_treeDev:function(){var e,t,a=this,n=[];for(e in a.treePath)t=a.treePath[e],a.arrayCodeTeamDev.indexOf(t.data.code)>=0&&(n=n.concat(t.parent));return a.treePathParentTeamDev=n.filter(function(e,t){return n.indexOf(e)===t}),a.treePathParentTeamDev}},t.tagUi={flagIsDelete:!1,processSaveTag:!1,list:function(t,a,n){if(!t.length)return!1;var i=this;"undefined"==typeof n&&(n={}),i.flagIsDelete=!1;var r=t.tagit({itemName:"item",fieldName:"tag_item",allowSpaces:!0,caseSensitive:!1,beforeTagRemoved:function(a,r){i.flagIsDelete=!0,n.scope.funcFieldTagDelete(r.tag,e.extend(n,{callback:function(){i.flagIsDelete=!1}})),"function"==typeof n.beforeChangeAny&&n.beforeChangeAny(t,i)},afterTagAdded:function(e,t){var a=t.tag.attr("class").match(/tag-id-\d+/);if(n.color&&i.setColorForTag(t.tag,n.color),!a||!a.length||!a[0]){var r=t.tag.closest("[data-field-id]").data("field-id");return n.compileAngular&&n.scope.funcFieldTagAdd(r,t.tag,t.tagLabel,n),!0}a=parseInt(a[0].replace(/\D+/,"")),t.tag.data("id",a),n.tagReview&&t.tag.append('<span title="'+RKTagTrans.Approve+'" class="tag-check-approve" ng-click="funcFieldTagApprove($event, '+a+')"><i class="fa fa-check"></i></span>'),n.compileAngular&&n.compile(t.tag.contents())(n.scope)},beforeTagAdded:function(a,r){if("function"==typeof n.beforeChangeAny&&n.beforeChangeAny(t,i),"undefined"!=typeof r.duringInitialization&&r.duringInitialization.createDefault)return!0;var o=e(n.checkDuplidate);return!n.checkDuplidate||!o.length||(i.tagCheckExists(r.tagLabel,o),!0)}});if(n.inputAddRemove&&t.data("ui-tagit").tagInput.addClass("hidden"),"undefined"==typeof a)return r;var o,s;n.classAdd||(n.classAdd="");for(o in a)s=a[o],t.tagit("createTag",s.value,n.classAdd+" tag-id-"+s.id+" tag-status-"+s.status,{createDefault:!0});return n.editor&&i.editTag(t,n),"function"==typeof n.funcOptions&&n.funcOptions(t,i),i},editTag:function(t,a){var n=this;e(document).on("dblclick",t.selector+" .tagit-choice.tagit-choice-editable",function(i){if("function"==typeof a.beforeChangeAny&&a.beforeChangeAny(t,n),n.flagIsDelete)return!0;var r=e(this),o=r.data("id");if(!o)return!0;if(!n._activeEditTag(t,r))return!0;var s=r.children(".tagit-label").text(),l=e('<input type="text" class=" tagit-label input-tagit-editor" autocomplete="off" value="'+s+'" data-id="'+o+'">');r.prepend(l),l.focus()}),n.eventSaveEditorTag(t,a)},eventSaveEditorTag:function(t,a){var n=this;e(document).on("keypress",".tagit-choice-editable .input-tagit-editor",function(i){i.which===e.ui.keyCode.ENTER&&n.saveEditorTag(t,e(this),a)}),e(document).on("blur",".tagit-choice-editable .input-tagit-editor",function(){n.saveEditorTag(t,e(this),a)})},saveEditorTag:function(a,n,i){a=e(a.selector);var r=this,o=n.data("id"),s=n.val(),l=n.closest(".tagit-choice-editable"),d=l.closest("li.tagit-choice").children(".tagit-label").text().toLowerCase();if(r.processSaveTag)return!0;if(!o||!s||s.length>255)return!0;if(d==s.toLowerCase())return r._inactiveEditTag(a),r.processSaveTag=!1,!0;if(r.tagCheckExists(s,a,o))return!0;var c=e(i.checkDuplidate);return!i.checkDuplidate||!c.length||(!!r.tagCheckExists(s,c,o)||(r.processSaveTag=!0,void e.ajax({method:"post",url:RKVarGlobalTag.urlTagSave,headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"json",data:{tag_id:o,tag_name:s,_token:siteConfigGlobal.token},success:function(e){return e.success?(t.general.notifySuccess(e.message),r._inactiveEditTag(a),l.children(".tagit-label").text(s),void("function"==typeof i.thenUpdateLabelTag&&i.thenUpdateLabelTag(o,s,e))):(t.general.notifyError(e.message),!0)},error:function(){t.general.notifyError()},complete:function(){r.processSaveTag=!1}})))},_activeEditTag:function(e,t){return!t.hasClass("editoring")&&(e.children(".tagit-choice").removeClass("editoring"),e.find("input.input-tagit-editor").remove(),t.addClass("editoring"),!0)},_inactiveEditTag:function(e){e.children(".tagit-choice").removeClass("editoring");try{e.find("input.input-tagit-editor").remove()}catch(t){}},_activeHighlightTag:function(e,t){return!t.hasClass("hightlight")&&(e.children(".tagit-choice").removeClass("hightlight"),t.addClass("hightlight"),!0)},_inactiveHighlightTag:function(e){e.children(".tagit-choice").removeClass("hightlight")},deleteItem:function(a){var n=a.data("id");return"undefined"==typeof option&&(option={}),!!n&&(e.ajax({method:"delete",url:RKVarGlobalTag.urlFieldDeleteTagItem,headers:{"Content-Type":"application/x-www-form-urlencoded"},dataType:"json",data:{id:n,_token:siteConfigGlobal.token},success:function(e){return e.success?void t.general.notifySuccess(e.message):(t.general.notifyError(e.message),!0)},error:function(e){t.general.notifyError()}}),!0)},updateColor:function(t,a){var n=e(".field-tag-wrapper .tag-field-list.tagit li.tagit-choice");t?(this.setColorForTag(n,t),"undefined"!=typeof a&&a.find(".field-color").css({background:t})):n.removeAttr("style")},setColorForTag:function(e,t){e.css({})},tagCheckExists:function(t,a,n){var i=!1;return a.find("li.tagit-choice").each(function(a,r){if(e(r).data("id")!=n&&e(r).find("span.tagit-label:first").text().toLowerCase()===t.toLowerCase())return e(r).effect("highlight"),i=!0,!1}),i}},t.ng={tagitSource:function(e,t,a){var n=e.getStorageTags(),i=10,r=0;if(!n)return[];var o=a.tagit("assignedTags"),s=[];for(var l in n)for(var d in n[l]){var c=n[l][d];if(!(o.indexOf(c.value)>-1)&&c.value.toLowerCase().startsWith(t.term.toLowerCase())&&(s.push(c.value),r++,r>=i))return s}return s},tagOfField:function(e,t,a){var n=e.getStorageTags();if(!n||"undefined"==typeof n[a]||!n[a].length)return[];var i=t.tagit("assignedTags"),r=[];for(var o in n[a]){var s=n[a][o];i.indexOf(s.value)>-1||r.push({id:s.id,value:s.value})}return r}},t.progressBar={bar:null,timeout:null,step:100,process:!1,start:function(){var t=this;return!!t.process||(t.process=!0,void(this.bar?(t.bar.progressbar("value",0),t.bar.show(),t.progress()):(e(".progressbar").length||e("body").append('<div class="progressbar ui-progressbar-top"></div>'),t.bar=e(".progressbar"),t.bar.progressbar({value:0,max:100,complete:function(){t.end()},create:function(){t.progress()}}))))},end:function(){var e=this;return e.process=!1,!e.bar||(100!==e.bar.progressbar("value")&&e.bar.progressbar("value",100),e.timeout&&clearTimeout(e.timeout),void setTimeout(function(){e.bar.hide()},700))},progress:function(){var e=this.bar.progressbar("value")||0,t=e+Math.floor(10*Math.random()),a=this;t<70?(a.bar.progressbar("value",t),a.timeout=setTimeout(function(){a.progress()},a.step)):t<95?(a.bar.progressbar("value",e+.5),a.timeout=setTimeout(function(){a.progress()},a.step)):clearTimeout(a.timeout)},setStep:function(e){return this.step=e,this}},window.RKTagFunction=t}(jQuery);