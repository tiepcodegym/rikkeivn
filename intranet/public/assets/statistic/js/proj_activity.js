!function(e,t,a,i,r){var o="object"==typeof globVarPass?globVarPass:{},n={chart:{},init:function(){var e=this;e.initHtmlChart(),e.initDate(),e.loadPlugin(),e.projName=null,e.action(),o.team.company={data:{name:"Company",isCompany:1}},setTimeout(function(){e.submitFormFilter()},500),e.getTeamQa()},getInfo:function(t){var a=this;return!(!a.formFilter.data("process")&&("function"!=typeof a.formFilter.valid||a.formFilter.valid()))||(a.formFilter.data("process",!0),e('[d-dom-btn="submit-filter"]').prop("disabled",!0),e('[d-dom-i="ajax-load"]').removeClass("hidden"),a.beforeSubmitFilter(),void e.ajax({url:o.urlGetInfo+t,type:"get",datatype:"json",data:a.getDataForm(),success:function(e){if(a.afterSubmitDone(),!e.status)return a.errorAjax(e);e.projName&&a.initProjName(e.projName);var i="execData"+t;"function"==typeof a[i]&&a[i](e),e=null},error:function(e){a.errorAjax(e),a.afterSubmitDone()}}))},afterSubmitDone:function(){var t=this;t.formFilter.data("process",!1),e('[d-dom-btn="submit-filter"]').prop("disabled",!1),e('[d-dom-i="ajax-load"]').addClass("hidden")},execDataemplLoc:function(e){var t=this,a={tab:"loc",dataFlag:"emplLoc",titleFilter:"Line of code changed of ",titleCompany:"Line of code changed in the company",titleXChart:"Line"};t.locDate={},t.callDataChartGeneral(e,a),t.execDataemplBug(e),t.execDataemplBuglea(e),t.execDataemplBugdefix(e),t.execDataemplBuglefix(e),t.execDataprojDeli(e),t.initSlider()},execDataemplBug:function(e){var t=this,a={tab:"bug",dataFlag:"emplBug",titleFilter:"Number new bug defect of ",titleCompany:"Number new bug defect in the company",titleXChart:"Number"};t.callDataChartGeneral(e,a)},execDataemplBuglea:function(e){var t=this,a={tab:"buglea",dataFlag:"emplBuglea",titleFilter:"Number new bug leakage of ",titleCompany:"Number new bug leakage in the company",titleXChart:"Number"};t.callDataChartGeneral(e,a)},execDataemplBugdefix:function(e){var t=this,a={tab:"bugdefix",dataFlag:"emplBugdefix",titleFilter:"Number bug defect fixed of ",titleCompany:"Number bug defect fixed in the company",titleXChart:"Number"};t.callDataChartGeneral(e,a)},execDataemplBuglefix:function(e){var t=this,a={tab:"buglefix",dataFlag:"emplBuglefix",titleFilter:"Number bug leakage fixed of ",titleCompany:"Number bug leakage fixed in the company",titleXChart:"Number"};t.callDataChartGeneral(e,a)},execDataprojDeli:function(t){var a=this;if(a.deli.wrap.html(""),!t.projDeli||!t.projDeli.length)return a.deli.noresult.removeClass("hidden"),a.deli.wrap.addClass("hidden"),!0;a.deli.noresult.addClass("hidden"),a.deli.wrap.removeClass("hidden"),a.deliDataProj=a.processDataText(t.projDeli);var i=0;a.renderHtmlprojDeli(a.deliDataProj.company,"company",0),e.each(a.deliDataProj.team,function(e,t){a.renderHtmlprojDeli(t,e,i++)})},renderHtmlprojDeli:function(t,a,i){var r=this,n=r.deli.htmlItem;"undefined"==typeof i&&(i=1),n=n.replace(/\{team\}/gi,o.team[a].data.name).replace(/\{number_deli\}/gi,t.deli.count).replace(/\{number_deli_proj\}/gi,t.deli.projs.length).replace(/\{number_out\}/gi,t.out.count).replace(/\{number_out_proj\}/gi,t.out.projs.length).replace(/\{team_id\}/gi,a),n=e(n),t.deli.projs.length&&r.renderHtmlDeliShort(n,t.deli.projs,"listFg"),t.out.projs.length&&r.renderHtmlDeliShort(n,t.out.projs,"listFg2"),o.team[a].data.isCompany&&n.addClass("db-company"),i%2===0&&n.addClass("even-clear"),o.isSlide?r.slideInner.append(n):r.deli.wrap.append(n)},renderHtmlDeliShort:function(e,t,a){var i=this,r=5,n=0;return o.isSlide&&(r=15),t.some(function(t){return n++,n>r?(e.find(i.deli[a]).append(i.deli.htmlProjMore),!0):void e.find(i.deli[a]).append(i.deli.htmlProjItem.replace(/\{proj_name\}/gi,i.projName[t]).replace(/xxx000/gi,t))}),e},callDataChartGeneral:function(t,a){var i=this;if(e("#project-"+a.tab).unbind(),!e('[data-chart-type="com-'+a.tab+'"]').length)return!0;if(e('[data-chart-type="com-'+a.tab+'"]').addClass("hidden"),i.domChartTeam[a.tab].html(""),i.domChartCompany[a.tab].html(i.htmlChartCompny[a.tab]),"function"==typeof a.callBack&&a.callBack(),!t[a.dataFlag]||!t[a.dataFlag].length)return i.noResult[a.tab].removeClass("hidden"),o.isSlide&&i.noResult[a.tab].closest("[d-dom-tab]").remove(),!0;i.noResult[a.tab].addClass("hidden");var n=i.processDatasetFormat(t[a.dataFlag],a),l=[],d=0;t[a.dataFlag]=null,i.isFilterEmployee?(l.push({label:i.isFilterEmployee,fill:!1,backgroundColoprojsExistsr:r.color(d),borderColor:r.color(d),data:n.companyTeam.company}),n=null,i.chartWrite({datasets:l,title:a.titleFilter+i.isFilterEmployee,elementId:"project-"+a.tab,chartKey:"com-"+a.tab},a),e('[data-chart-type="com-'+a.tab+'"]').removeClass("hidden")):(e.each(n.companyTeam,function(e,t){return!(!o.team[e].data.isCompany||!o.teamFilter||o.teamFilter.indexOf("-")!==-1)||(l.push({label:o.team[e].data.name,fill:!1,backgroundColor:r.color(d),borderColor:r.color(d),data:t}),void d++)}),i.chartWrite({datasets:l,title:a.titleCompany,elementId:"project-"+a.tab,chartKey:"com-"+a.tab},a),e('[data-chart-type="com-'+a.tab+'"]').removeClass("hidden"),e.each(n.teamProj,function(t,n){i.insertHtmlTeamChart(a,t);var d=0;l=[],e.each(n,function(e,t){l.push({label:i.projName[e],fill:!1,backgroundColor:r.color(d),borderColor:r.color(d),data:t}),d++}),i.chartWrite({datasets:l,title:a.titleFilter+o.team[t].data.name,chartKey:a.tab+"-"+t,elementId:"project-"+a.tab+"-"+t},a)}),n=null,i.domChartTeam[a.tab].removeClass("hidden"))},insertHtmlTeamChart:function(t,a){var i=this;o.isSlide?(e('[d-dom-tab="'+t.tab+'"]:last').after(i.htmlChartTeam[t.tab].replace(/\{teamId\}/gi,a)),i.domChartTeam[t.tab].remove()):i.domChartTeam[t.tab].append(i.htmlChartTeam[t.tab].replace(/\{teamId\}/gi,a))},chartWrite:function(e,a){var i,r,n=this,l=t.getElementById(e.elementId);return!l||(o.isSlide?(i=28,r=24):i=r=14,l=l.getContext("2d"),void(n.chart[e.chartKey]=new Chart(l,{type:"line",data:{labels:n.locDate[a.tab],datasets:e.datasets},options:{responsive:!0,title:{display:!0,text:e.title,fontSize:i},tooltips:{mode:"point",intersect:!1},hover:{mode:"nearest",intersect:!0},elements:{line:{tension:1e-6}},legend:{labels:{fontSize:r}},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Date",fontSize:r},ticks:{fontSize:r}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:a.titleXChart,fontSize:r},ticks:{fontSize:r}}]}}})))},processDatasetFormat:function(t,a){var i=this,r={company:{}},n={};i.locDate[a.tab]=[],t.forEach(function(e){if("loc"===a.tab&&e.value>2e3)return!0;if("undefined"==typeof i.projName[e.proj_id])return!0;var t=(e.team_id+"").split("-");t=i.teamFilterExec(t);var l=i.getTimePeriod(e.created_at);return"undefined"==typeof r.company[l]&&(r.company[l]=0,i.locDate[a.tab].push(l)),r.company[l]+=e.value,!t||!t.length||void t.forEach(function(t){return"undefined"==typeof o.team[t]||i.teamQA.indexOf(t)>-1||("undefined"==typeof r[t]&&(r[t]={}),"undefined"==typeof r[t][l]&&(r[t][l]=0),r[t][l]+=e.value,"undefined"==typeof n[t]&&(n[t]={}),"undefined"==typeof n[t][e.proj_id]&&(n[t][e.proj_id]={}),"undefined"==typeof n[t][e.proj_id][l]&&(n[t][e.proj_id][l]=0),void(n[t][e.proj_id][l]+=e.value))})}),i.locDate[a.tab].sort();var l={company:[]},d={};return i.locDate[a.tab].forEach(function(t){e.each(r,function(e,a){"undefined"==typeof l[e]&&(l[e]=[]),l[e].push("undefined"!=typeof a[t]?a[t]:0)}),e.each(n,function(a,i){"undefined"==typeof d[a]&&(d[a]={}),e.each(i,function(e,i){"undefined"==typeof d[a][e]&&(d[a][e]=[]),d[a][e].push("undefined"!=typeof i[t]?i[t]:0)})})}),{companyTeam:l,teamProj:d}},processDataText:function(t){var a=this,i={company:{deli:{count:0,projs:[]},out:{count:0,projs:[]}},team:{}};return e.each(t,function(e,t){if("undefined"==typeof a.projName[t.proj_id])return!0;if(i.company.deli.count++,i.company.deli.projs.indexOf(t.proj_id)===-1&&i.company.deli.projs.push(t.proj_id),t.atd&&t.cmd<t.atd&&(i.company.out.count++,i.company.out.projs.indexOf(t.proj_id)===-1&&i.company.out.projs.push(t.proj_id)),!t.team_id)return!0;var r=(t.team_id+"").split("-");return r=a.teamFilterExec(r),!r||!r.length||void r.forEach(function(e){return"undefined"==typeof o.team[e]||a.teamQA.indexOf(e)>-1||("undefined"==typeof i.team[e]&&(i.team[e]={deli:{count:0,projs:[]},out:{count:0,projs:[]}}),i.team[e].deli.count++,i.team[e].deli.projs.indexOf(t.proj_id)===-1&&i.team[e].deli.projs.push(t.proj_id),void(t.atd&&t.cmd<t.atd&&(i.team[e].out.count++,i.team[e].out.projs.indexOf(t.proj_id)===-1&&i.team[e].out.projs.push(t.proj_id))))})}),i},getTimePeriod:function(e){var t=this,a=t.getFilterUnit();if("d"===a)return e;var e=moment(e);return"m"===a?e.format("Y-MM"):e.format("Y")},initProjName:function(e){var t=this;if(t.projName={},!e||!e.length)return{};var t=this;return e.forEach(function(e){t.projName[e.id]=e.name}),t.projName},errorAjax:function(e){return"object"!=typeof e?(i.notify("System error",!1),!0):void("string"==typeof e.message?i.notify(e.message,!1):"object"==typeof e.responseJSON&&e.responseJSON.message?i.notify(e.responseJSON.message,!1):i.notify("System error",!1))},screenResize:function(){var a=e(t).width(),i=e(t).height();e(".chart-full-box").width(.9*a).height(.9*i)},canvasResize:function(){e(".chart-full-box").each(function(){var t=e(this),a=t.find("canvas");t.width(a.width()).height(a.height())})},action:function(){var a=this;e(t).on("click","[data-btn-chart]",function(t){t.preventDefault();var i=e(this).data("btn-chart"),r=e(this).closest("[data-chart-type]").data("chart-type");if(!r||!i||!a.chart[r])return!0;switch(i){case"hide":a.chart[r].data.datasets.forEach(function(t){e.each(t._meta,function(e,t){t.hidden=!0})}),a.chart[r].update();break;case"show":a.chart[r].data.datasets.forEach(function(t){e.each(t._meta,function(e,t){t.hidden=null})}),a.chart[r].update()}}),a.formFilter.submit(function(e){e.preventDefault(),a.submitFormFilter()}),e('[d-dom-flag="unit"]').change(function(){a.loadDatepicker(!1)}),e(t).on("click",".select2-selection__clear",function(t){return t.preventDefault(),e(this).closest(".select2-container").siblings("select").val(null).change(),!1}),e(t).on("click",'[d-list-detail="deli"]',function(t){t.preventDefault(),a.deliViewProjMore(e(this).closest("[data-list-type]"))})},submitFormFilter:function(){var e=this;e.getInfo("emplLoc")},initHtmlChart:function(){var t=this;t.noResult={},t.domChartCompany={},t.domChartCompany={},t.htmlChartCompny={},t.domChartTeam={},t.htmlChartTeam={},["loc","bug","buglea","bugdefix","buglefix"].forEach(function(a){t.noResult[a]=e('[data-no-result="'+a+'"]'),t.domChartCompany[a]=e('[d-dom-chart="'+a+'-company-team"]'),t.htmlChartCompny[a]=t.domChartCompany[a].html(),t.domChartTeam[a]=e('[d-dom-chart="'+a+'-team"]'),t.htmlChartTeam[a]=t.domChartTeam[a].html(),t.domChartTeam[a].html("")}),t.formFilter=e('[d-dom-form="proj-activity-filter"]'),t.deli={wrap:e('[d-db-wrap="deli"]'),noresult:e('[data-no-result="deli"]'),listFg:'[d-db-list-1="deli"]',listFg2:'[d-db-list-2="deli"]',htmlProjItem:e('[d-db-list-item="deli"]')[0].outerHTML,htmlProjMore:e('[d-db-list-item-more="deli"]')[0].outerHTML},t.slideInner=e("[d-slider-inner]"),e(t.deli.listFg).html(""),t.deli.htmlItem=e('[d-db-wrap="deli"]').html(),t.deli.wrap.html(""),o.isSlide&&t.deli.wrap.remove()},initDate:function(){var t=moment();e("#to").val(t.format("Y-MM-DD")),t=t.subtract(30,"days"),e("#from").val(t.format("Y-MM-DD"))},loadPlugin:function(){if(o.isSlide)return!0;var e=this;i.select2.init({allowClear:!0}),e.loadJValidate(),e.loadDatepicker(!0)},loadJValidate:function(){var e=this;e.formFilter.validate({rules:{from:{required:!0},to:{required:!0,greaterEqualThan:'[name="from"]'}},messages:{to:{greaterEqualThan:"Must be greater or equal than From"}}})},loadDatepicker:function(t){if(o.isSlide)return!0;var a=this;e("[data-date-picker]").data("datepicker")&&e("[data-date-picker]").datepicker("destroy");var i=a.getFilterUnit(),r={useCurrent:!1,todayHighlight:!0,weekStart:1,autoclose:!0,format:"yyyy-mm-dd"};if(!t){var n=e('[name="from"]').val(),l=e('[name="to"]').val();switch(i){case"d":e.extend(r,{format:"yyyy-mm-dd"}),/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(n)||(n=moment(n).date(1).format("Y-MM-DD"),l=moment(l).add(1,"months").date(0).format("Y-MM-DD"));break;case"m":e.extend(r,{format:"yyyy-mm",viewMode:"months",minViewMode:"months"}),n=moment(n).format("Y-MM"),l=moment(l).format("Y-MM");break;default:e.extend(r,{format:"yyyy",viewMode:"years",minViewMode:"years"}),n=moment(n).format("Y"),l=moment(l).format("Y")}e('[name="from"]').val(n),e('[name="to"]').val(l)}e("[data-date-picker]").datepicker(r).on("changeDate",function(e){a.projName=null})},getDataForm:function(){var t=this,a={};return t.isFilterEmployee=!1,t.formFilter.find("[d-filter-input]").each(function(i,r){var o=e(r),n=o.attr("name"),l=o.val(),d=t.getFilterUnit();switch(n){case"from":l=moment(l).format("Y-MM-DD");break;case"to":l=moment(l),"m"===d?l=l.add(1,"months").date(0):"y"===d&&(l=l.month(12).date(0)),l=l.format("Y-MM-DD");break;default:"employee"===n&&l&&(t.isFilterEmployee=RKfuncion.general.parseHtml(e('[name="employee"] option:selected').html()))}a[n]=l}),t.projName&&(a.projsExists=1),o.teamFilter&&(a.team=o.teamFilter,o.teamFilterArray=o.teamFilter.split("-")),a},teamFilterExec:function(e){return o.teamFilterArray?o.teamFilterArray.filter(function(e){return this.has(e)},new Set(e)):e},beforeSubmitFilter:function(){e('[name="employee"]').val()?(e('[d-dom-fg="hide-empl"]').addClass("hidden"),e('[d-dom-fg="show-empl"] a').trigger("click")):e('[d-dom-fg="hide-empl"]').removeClass("hidden")},getFilterUnit:function(){var t=e('[d-dom-flag="unit"]').val();return["y","m","d"].indexOf(t)===-1?"d":t},getTeamQa:function(){var t=this;return t.teamQA=[],e.each(o.team,function(e,a){return"object"!=typeof a.data||!a.data.name||void(/qa/i.test(a.data.name)&&t.teamQA.push(e))}),t.teamQA},initSlider:function(){if(!o.isSlide)return!0;var t=this;setTimeout(function(){t.carousel(e(".swiper-wrapper .swiper-slide"),0)},200)},carousel:function(t,a){var i=this;t.hide(),t.removeClass("active"),a++,a>t.length&&(a=1),t[a-1].style.display="block",t[a-1].classList.add("active"),i.centerHeighChart(e(t[a-1])),setTimeout(function(){i.centerHeighChart(e(t[a-1]))},10),setTimeout(function(){i.carousel(t,a)},2e4)},centerHeighChart:function(t){if(!t.data("dom-center"))return!0;var i=e(a).outerHeight(),r=t.outerHeight()+20;return i<=r||void t.css("margin-top",""+(i-r)/2+"px")},deliViewProjMore:function(t){var a,i=this,r=t.data("list-type"),n=t.data("team-id");if(!r||!n)return!0;if(a=isNaN(n)?i.deliDataProj.company:i.deliDataProj.team[n],!a||!a[r]||!a[r].projs)return!0;var l=e("#modal-pd-deli-more");l.length||(l=e('<div class="modal fade" tabindex="-1" role="dialog"> <div class="modal-dialog" role="document"> <div class="modal-content"> <div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" d-modal-title="deli"></h4> </div><div class="modal-body" d-modal-content=deli></div><div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> </div></div></div></div>')),l.find('[d-modal-title="deli"]').text(o.team[n].data.name);var d="";a[r].projs.some(function(e){d+=i.deli.htmlProjItem.replace(/\{proj_name\}/gi,i.projName[e]).replace(/xxx000/gi,e)}),l.find('[d-modal-content="deli"]').html(d),l.modal("show")}};n.init()}(jQuery,document,window,RKExternal,ColorArray);