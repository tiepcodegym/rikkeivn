!function(e){function a(s){if(!(stopSending||s.hasClass("success")||s.hasClass("sending"))){var r=s.offset().top-e("#salary_table thead").height();e("html, body").stop().animate({scrollTop:r},500,"swing");var i=s.next("tr"),d=s.find(".sending-status");s.addClass("sending").removeClass("sent-error success"),d.text("").addClass("fa fa-spin fa-refresh"),o=e.ajax({url:sendMailUrl,type:"POST",data:{_token:siteConfigGlobal.token,email:s.data("email"),salary_file_id:s.closest("table").data("file-id")},success:function(){d.removeClass("text-red fa-close").addClass("fa-check text-green"),s.addClass("success"),s.removeClass("active"),i.addClass("active")},error:function(e){d.removeClass("text-green fa-check").addClass("fa-close text-red"),s.addClass("sent-error"),0!==e.status&&(s.removeClass("active"),i.addClass("active"))},complete:function(){s.removeClass("sending"),d.removeClass("fa-spin fa-refresh"),o=null,i.length>0?n=setTimeout(function(){a(i)},1e3*delaySendMail):(t.removeClass("hidden"),l.addClass("hidden"),e("#salary_table tbody tr.sent-error").length>0?t.find(".send-error").length<1&&t.append('<span class="send-error"> (Gửi lại mục lỗi)</span>'):t.addClass("hidden"),bootbox.alert({className:"modal-success",message:'Đã gửi xong email, <a href="'+detailMailSentLink+'" style="color: #ffebc7;"> xem kết quả gửi mail</a>'}))}})}}function s(){o&&o.abort(),stopSending=1,clearTimeout(n)}e("#file_upload").on("change",function(){var a=e(this)[0].files;if(a.length>0){var s=a[0].size/1024;s>MAX_FILE_SIZE&&(bootbox.alert({className:"modal-danger",message:textErrorMaxFileSize}),e(this).val(""))}});var t=e("#btn_send_mail"),l=e("#btn_stop_send");t.click(function(s){s.preventDefault();var t=e("#salary_table tbody tr.active");t.length<1&&(t=e("#salary_table tbody tr:first"),t.hasClass("success")&&(t=e("#salary_table tbody tr.sent-error:first"))),stopSending=0,a(t),e(this).addClass("hidden"),l.removeClass("hidden")});var n,o=null;e("body").on("click",".del-temp-link",function(a){a.preventDefault(),e("#delete_salary_form").submit()}),l.click(function(a){a.preventDefault(),s(),e(this).addClass("hidden"),t.removeClass("hidden")}),window.onbeforeunload=function(){if(e(".send-salary-page").length>0){var a=e("#salary_table tbody tr").length,s=e("#salary_table tbody tr.success").length;if(a!==s)return!0}};var r=e(".group-button"),i=e(".content-container").offset().top;e(window).scroll(function(){var a=e(this).scrollTop();a>i?r.addClass("btn-fixed-right"):r.removeClass("btn-fixed-right")}),e("#send_pass_mail_btn").click(function(a){a.preventDefault();var s=e(this),t=s.find(".loading"),l=s.data("url");t.hasClass("hidden")&&l&&bootbox.confirm({className:"modal-warning",message:textConfirmSendMail,callback:function(a){a&&(s.prop("disabled",!0),t.removeClass("hidden"),e.ajax({type:"POST",url:l,data:{_token:siteConfigGlobal.token},success:function(e){bootbox.alert({message:e,className:"modal-success"})},error:function(e){bootbox.alert({message:e.responseJSON,className:"modal-danger"})},complete:function(){s.prop("disabled",!1),t.addClass("hidden")}}))}})})}(jQuery);