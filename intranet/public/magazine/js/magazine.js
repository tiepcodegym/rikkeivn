function addPage(i,t){var e=(t.turn("pages"),$("<div />",{}));t.turn("addPage",e,i)&&(e.html('<div class="gradient"></div><div class="loader"></div>'),loadPage(i,e))}function loadPage(i,t){var e=$("<img />");e.mousedown(function(i){i.preventDefault()}),e.load(function(){$(this).css({width:"100%",height:"100%"}),$(this).appendTo(t),t.find(".loader").remove()}),e.attr("src",$(".thumbnails li img.page-"+i).data("slide")),loadRegions(i,t)}function zoomTo(i){setTimeout(function(){$(".magazine-viewport").data().regionClicked?$(".magazine-viewport").data().regionClicked=!1:1==$(".magazine-viewport").zoom("value")?$(".magazine-viewport").zoom("zoomIn",i):$(".magazine-viewport").zoom("zoomOut")},1)}function loadRegions(i,t){$.getJSON("pages/"+i+"-regions.json").done(function(i){$.each(i,function(i,e){addRegion(e,t)})})}function addRegion(i,t){var e=$("<div />",{"class":"region  "+i["class"]}),a=$(".magazine").turn("options"),n=a.width/2,o=a.height;e.css({top:Math.round(i.y/o*100)+"%",left:Math.round(i.x/n*100)+"%",width:Math.round(i.width/n*100)+"%",height:Math.round(i.height/o*100)+"%"}).attr("region-data",$.param(i.data||"")),e.appendTo(t)}function regionClick(i){var t=$(i.target);if(t.hasClass("region")){$(".magazine-viewport").data().regionClicked=!0,setTimeout(function(){$(".magazine-viewport").data().regionClicked=!1},100);var e=$.trim(t.attr("class").replace("region",""));return processRegion(t,e)}}function processRegion(i,t){switch(data=decodeParams(i.attr("region-data")),t){case"link":window.open(data.url);break;case"zoom":var e=i.offset(),a=$(".magazine-viewport").offset(),n={x:e.left-a.left,y:e.top-a.top};$(".magazine-viewport").zoom("zoomIn",n);break;case"to-page":$(".magazine").turn("page",data.page)}}function loadLargePage(i,t){var e=$("<img />");e.load(function(){var i=t.find("img");$(this).css({width:"100%",height:"100%"}),$(this).appendTo(t),i.remove()}),e.attr("src",$(".thumbnails li img.page-"+i).data("full"))}function loadSmallPage(i,t){var e=t.find("img");e.css({width:"100%",height:"100%"}),e.unbind("load"),e.attr("src",$(".thumbnails li img.page-"+i).data("slide"))}function isChrome(){return navigator.userAgent.indexOf("Chrome")!=-1}function disableControls(i){1==i?$(".previous-button").hide():$(".previous-button").show(),i==$(".magazine").turn("pages")?$(".next-button").hide():$(".next-button").show()}function resizeViewport(){var i=$(window).width(),t=$(window).height(),e=$(".magazine").turn("options");if($(".magazine").removeClass("animated"),$(".magazine-viewport").css({width:i,height:t}).zoom("resize"),1==$(".magazine").turn("zoom")){var a=calculateBound({width:e.width,height:e.height,boundWidth:Math.min(e.width,i),boundHeight:Math.min(e.height,t)});a.width%2!==0&&(a.width-=1),a.width==$(".magazine").width()&&a.height==$(".magazine").height()||($(".magazine").turn("size",a.width,a.height),1==$(".magazine").turn("page")&&$(".magazine").turn("peel","br"),$(".next-button").css({height:a.height,backgroundPosition:"-38px "+(a.height/2-16)+"px"}),$(".previous-button").css({height:a.height,backgroundPosition:"-4px "+(a.height/2-16)+"px"})),$(".magazine").css({top:-a.height/2,left:-a.width/2})}var n=$(".magazine").offset(),o=t-n.top-$(".magazine").height(),d=(o-$(".thumbnails > div").height())/2;d<0?$(".thumbnails").css({height:1}):($(".thumbnails").css({height:o}),$(".thumbnails > div").css({marginTop:d})),n.top<$(".made").height()?$(".made").hide():$(".made").show(),$(".magazine").addClass("animated")}function numberOfViews(i){return i.turn("pages")/2+1}function getViewNumber(i,t){return parseInt((t||i.turn("page"))/2+1,10)}function moveBar(i){Modernizr&&Modernizr.csstransforms&&$("#slider .ui-slider-handle").css({zIndex:i?-1:1e4})}function setPreview(i){var t=112,e=73,a="pages/preview.jpg",n=$(_thumbPreview.children(":first")),o=1==i||i==$("#slider").slider("option","max")?1:2,d=1==o?t/2:t;_thumbPreview.addClass("no-transition").css({width:d+15,height:e+15,top:-e-30,left:($($("#slider").children(":first")).width()-d-15)/2}),n.css({width:d,height:e}),""!==n.css("background-image")&&"none"!=n.css("background-image")||(n.css({backgroundImage:"url("+a+")"}),setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)),n.css({backgroundPosition:"0px -"+(i-1)*e+"px"})}function largeMagazineWidth(){return 2214}function decodeParams(i){for(var t,e=i.split("&"),a={},n=0;n<e.length;n++)t=e[n].split("="),a[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return a}function calculateBound(i){var t={width:i.width,height:i.height};if(t.width>i.boundWidth||t.height>i.boundHeight){var e=t.width/t.height;i.boundWidth/e>i.boundHeight&&i.boundHeight*e<=i.boundWidth?(t.width=Math.round(i.boundHeight*e),t.height=i.boundHeight):(t.width=i.boundWidth,t.height=Math.round(i.boundWidth/e))}return t}