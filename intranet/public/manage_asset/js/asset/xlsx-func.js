$(function(){$(".check-all-modal").click(function(){$(".list_export_cols").find("input:checkbox").not(this).prop("checked",this.checked)})});var sessionKeys="asset_checked",checkedId=RKSession.getRawItem(sessionKeys);$(document).ajaxComplete(function(){$(".check-all").is(":checked")&&($("table").find("input:checkbox").attr("checked","checked"),$.each($("input[name='asset_id']:checked"),function(){checkedId.push($(this).val())}),RKSession.setRawItem(sessionKeys,checkedId)),$(".check-all").change(function(){$("table").find("input:checkbox").not(this).prop("checked",this.checked),$(this).is(":checked")?($.each($("input[name='asset_id']:checked"),function(){checkedId.push($(this).val())}),RKSession.setRawItem(sessionKeys,checkedId)):(RKSession.setRawItem(sessionKeys,null),checkedId=[])}),$("input[name='asset_id']").change(function(){if($(this).is(":checked"))checkedId.push($(this).val());else{var e=checkedId.indexOf($(this).val());e>-1&&checkedId.splice(e,1)}RKSession.setRawItem(sessionKeys,checkedId)});var e=$("input[name=export_all]").val();$("input[name=export_all]").change(function(){e=$(this).val()}),$("#form_asset_export").submit(function(s){s.preventDefault();var t=RKSession.getRawItem(sessionKeys),n=$(this),i=n.find(".error-mess");i.addClass("hidden");var c=n.find('[name="itemsChecked"]');c.val("");var a=n.find('button[type="submit"]');if(0===parseInt(e)){if(n.find(".check-item:checked").length<1)return i.text("None column checked!").removeClass("hidden"),a.prop("disabled",!1),!1;if(!t||t.length<1)return i.text("None item checked!").removeClass("hidden"),a.prop("disabled",!1),!1}var o=n.find(".icon-processing");return!!o.hasClass("hidden")&&(t&&t.length&&c.val(t.join(",")),o.removeClass("hidden"),$.ajax({method:"POST",url:n.attr("action"),data:n.serialize(),dataType:"json",success:function(e){var s=XLSX.utils.book_new(),t=e.sheetsData,n=e.colsHead;for(var c in t)if(t.hasOwnProperty(c)){for(var a=XLSX.utils.json_to_sheet(t[c]),o=XLSX.utils.decode_range(a["!ref"]),d=o.s.c;d<=o.e.c;++d){var h=XLSX.utils.encode_col(d)+"1";if("undefined"!=typeof a[h]){var r=a[h];r.v=n[r.v].tt,a[h]=r}}a["!ref"]=XLSX.utils.encode_range(o);var l=[];for(var p in n)n.hasOwnProperty(p)&&l.push({wch:n[p].wch});a["!cols"]=l,$.each(a,function(e,s){s.s={alignment:{wrapText:1}},a[e]=s}),XLSX.utils.book_append_sheet(s,a,c)}var u=e.fileName+".xlsx",f=XLSX.write(s,{bookType:"xlsx",bookSST:!0,type:"binary"});try{saveAs(new Blob([s2ab(f)],{type:"application/octet-stream"}),u)}catch(k){return void i.text("Error export file, please try again later!").removeClass("hidden")}},error:function(e){i.text(e.responseJSON).removeClass("hidden")},complete:function(){o.addClass("hidden"),a.prop("disabled",!1)}}),!1)})}),$(window).on("load",function(){RKSession.setRawItem(sessionKeys,null),checkedId=[]});