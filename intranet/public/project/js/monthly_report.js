function updateBusinessEffect(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=e.find('tr[data-row="'+rowBusinessEffective+'"]');n.find(".month-value span").each(function(){var t=$(this).data("month"),a=e.find('tr[data-row="'+rowCost+'"] input[data-month="'+t+'"]').val().trim(),n=e.find('tr[data-row="'+rowApprovedCost+'"] input[data-month="'+t+'"]').val().trim(),l=notAvailable;""!==a&&""!==n&&(l=parseFloat(n)>0?(parseFloat(a)/parseFloat(n)*100).toFixed(2):notAvailable),$(this).text(l),$.isArray(tempValues[o][t][rowBusinessEffective])||(tempValues[o][t][rowBusinessEffective]={}),tempValues[o][t][rowBusinessEffective].value=l})}function updateBillableComplete(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=e.find('tr[data-row="'+rowCompletedPlan+'"]');n.find(".month-value span").each(function(){var t=$(this).data("month"),a=e.find('tr[data-row="'+rowApprovedProdCost+'"] input[data-month="'+t+'"]').val().trim(),n=e.find('tr[data-row="'+rowActual+'"] .month-value span[data-month="'+t+'"]').text().trim(),l=notAvailable;""!==a&&""!==n&&(l=parseFloat(a)>0?(parseFloat(n)/parseFloat(a)*100).toFixed(2):notAvailable),$(this).text(l),$.isArray(tempValues[o][t][rowCompletedPlan])||(tempValues[o][t][rowCompletedPlan]={}),tempValues[o][t][rowCompletedPlan].value=l})}function updateBillStaffPlan(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=a.closest(".tab-content").find("#"+o+"_hr table"),l=e.find('tr[data-row="'+rowBillStaffPlan+'"]');l.find(".month-value span").each(function(){var t=$(this).data("month"),a=n.find('tr[data-row="'+rowHrPlan+'"] .month-value span[data-month="'+t+'"]').text().trim(),l=e.find('tr[data-row="'+rowCompletedPlan+'"] .month-value span[data-month="'+t+'"]').text().trim(),r=notAvailable;""!==a&&a!==notAvailable&&l!==notAvailable&&(r=parseFloat(a)>0?(parseFloat(l)/parseFloat(a)*100).toFixed(2):notAvailable),$(this).text(r),$.isArray(tempValues[o][t][rowBillStaffPlan])||(tempValues[o][t][rowBillStaffPlan]={}),tempValues[o][t][rowBillStaffPlan].value=r})}function updateAllocateStaff(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=a.closest(".tab-content").find("#"+o+"_hr table"),l=e.find('tr[data-row="'+rowAlloStaffActual+'"]');l.find(".month-value span").each(function(){var t=$(this).data("month"),a=n.find('tr[data-row="'+rowHrActual+'"] .month-value span[data-month="'+t+'"]').text().trim(),l=e.find('tr[data-row="'+rowActual+'"] .month-value span[data-month="'+t+'"]').text().trim(),r=notAvailable;""!==a&&a!==notAvailable&&l!==notAvailable&&(r=parseFloat(a)>0?(parseFloat(l)/parseFloat(a)*100).toFixed(2):notAvailable),$(this).text(r),$.isArray(tempValues[o][t][rowAlloStaffActual])||(tempValues[o][t][rowAlloStaffActual]={}),tempValues[o][t][rowAlloStaffActual].value=r})}function updateBillStaffActual(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=a.closest(".tab-content").find("#"+o+"_hr table"),l=e.find('tr[data-row="'+rowBillStaffActual+'"]');l.find(".month-value span").each(function(){var t=$(this).data("month"),a=n.find('tr[data-row="'+rowHrActual+'"] .month-value span[data-month="'+t+'"]').text().trim(),l=e.find('tr[data-row="'+rowCompletedPlan+'"] .month-value span[data-month="'+t+'"]').text().trim(),r=notAvailable;""!==a&&a!==notAvailable&&l!==notAvailable&&(r=parseFloat(a)>0?(parseFloat(l)/parseFloat(a)*100).toFixed(2):notAvailable),$(this).text(r),$.isArray(tempValues[o][t][rowBillStaffActual])||(tempValues[o][t][rowBillStaffActual]={}),tempValues[o][t][rowBillStaffActual].value=r})}function updateProductionCostStaff(t){var a=t,e=a.closest("table"),o=a.closest(".tab-pane").data("team"),n=a.closest(".tab-content").find("#"+o+"_hr table"),l=e.find('tr[data-row="'+rowProdStaffActual+'"]');l.find(".month-value span").each(function(){var t=$(this).data("month"),a=n.find('tr[data-row="'+rowHrActual+'"] .month-value span[data-month="'+t+'"]').text().trim(),l=e.find('tr[data-row="'+rowApprovedProdCost+'"] .month-value span[data-month="'+t+'"]').text().trim(),r=notAvailable;""!==a&&a!==notAvailable&&l!==notAvailable&&(r=parseFloat(a)>0?(parseFloat(l)/parseFloat(a)*100).toFixed(2):notAvailable),$(this).text(r),$.isArray(tempValues[o][t][rowProdStaffActual])||(tempValues[o][t][rowProdStaffActual]={}),tempValues[o][t][rowProdStaffActual].value=r})}function compareArray(t,a){var e=[rowBillEffort,rowApprovedCost,rowApprovedProdCost,rowCost,rowBusinessEffective,rowTraningPlan,rowApprovedProdCost,rowCompletedPlan,rowAlloStaffActual,rowProdStaffActual];$.each(t,function(o,n){for(var l=1;l<=12;l++)$.each(e,function(e,n){("undefined"==typeof t[o][l][n]&&"undefined"!=typeof a[o][l][n]&&""!==a[o][l][n].value||"undefined"!=typeof t[o][l][n]&&"undefined"!=typeof a[o][l][n]&&t[o][l][n].value!==a[o][l][n].value)&&("undefined"==typeof changeValues[o]&&(changeValues[o]={}),"undefined"==typeof changeValues[o][l]&&(changeValues[o][l]={}),"undefined"==typeof changeValues[o][l].value&&(changeValues[o][l][n]={}),changeValues[o][l][n].value=a[o][l][n].value)})})}function unique(t){var a=[];return $.each(t,function(t,e){$.inArray(e,a)==-1&&"undefined"!=typeof e&&a.push(e)}),a}function searchItemInArray(t,a){return result=[],$.each(t,function(t,e){e==a&&(result[t]=e)}),result}function showLoading(){$(".loader-container").removeClass("hidden")}function hideLoading(){$(".loader-container").addClass("hidden")}function htmlEntities(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function s2ab(t){if("undefined"!=typeof ArrayBuffer){for(var a=new ArrayBuffer(t.length),e=new Uint8Array(a),o=0;o!==t.length;++o)e[o]=255&t.charCodeAt(o);return a}for(var a=[],o=0;o!==t.length;++o)a[o]=255&t.charCodeAt(o);return a}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")}}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$(".btn-search").prop("disabled",!1)}),$(document).on("click","button.btn-submit",function(){var t=$(this);t.find("i").removeClass("hidden"),t.prop("disabled",!0),$.ajax({url:urlUpdate,type:"post",dataType:"html",data:{values:JSON.stringify(changeValues),year:$(".year-filter").val()},timeout:requestTimeOut,success:function(){$("#modal-success-notification .modal-body p.text-default").text(successText),$("#modal-success-notification").modal("show")},error:function(t,a,e){"timeout"===a?$("#modal-warning-notification .modal-body p.text-default").text(errorTimeoutText):$("#modal-warning-notification .modal-body p.text-default").text(errorText),$("#modal-warning-notification").modal("show")},complete:function(){t.find("i").addClass("hidden"),t.prop("disabled",!1)}})}),$(document).on("click",".btn-search",function(){var t=$(this);t.find("i").removeClass("hidden"),t.prop("disabled",!0);var a=$(".start-month").val(),e=$(".end-month").val(),o=$(".year-filter").val();showLoading(),$.ajax({url:urlSearch,type:"post",dataType:"json",data:{startMonthFilter:a,endMonthFilter:e,yearFilter:o},timeout:requestTimeOut,success:function(a){$(".data").html(a.html),values=a.values,t.find("i").addClass("hidden"),t.prop("disabled",!1),hideLoading(),mrHasPermissUpdate&&$('table tr[data-row="'+rowCost+'"] input').blur()},error:function(t,a,e){"timeout"===a?$("#modal-warning-notification .modal-body p.text-default").text(errorTimeoutText):$("#modal-warning-notification .modal-body p.text-default").text(errorText),$("#modal-warning-notification").modal("show")}})}),$(document).on("focusout","table input, table textarea",function(){var t=$(this).closest("table.dataTable").data("type"),a=$(this).val().trim(),e=$(this).data("month"),o=$(this).closest(".tab-pane"),n=o.data("team"),l=$(this).data("value-or-point"),r=$(this).closest("tr").data("row");$.isArray(tempValues[n][e][r])||(tempValues[n][e][r]={}),tempValues[n][e][r][l]=a,updateBusinessEffect($(this)),updateBillableComplete($(this)),updateAllocateStaff($(this)),updateProductionCostStaff($(this)),resetPoint(tempValues,e,rowBusinessEffective,t),resetPoint(tempValues,e,rowCompletedPlan,t),resetPoint(tempValues,e,rowAlloStaffActual,t),resetPoint(tempValues,e,rowProdStaffActual,t),isNaN(a)&&$(this).closest("tr").find("td span[data-month="+e+"][data-value-or-point=point]").text(0),compareArray(values,tempValues)}),function(t){jQuery.validator.addMethod("lessThan",function(a,e,o){if(a&&t(o).val()){var n=a.split("-"),l=t(o).val().split("-");return(n.length<2||l.length<2)&&(this.optional(e)||a<=t(o).val()),this.optional(e)||new Date(n[1],n[0])<=new Date(l[1],l[0])}return!0},startDateBefore),t("#form_import_billable").validate({rules:{team_id:{required:!0},from_month:{lessThan:"#im_to_month"},excel_file:{required:!0}}}),t("#form_export_billable").validate({rules:{team_id:{required:!0},from_month:{required:!0,lessThan:"#ex_to_month"},to_month:{required:!0}}}),t("#form_import_billable").submit(function(){var a=t(this);if(!a.valid())return!1;var e=a.find(".loading-block");e.removeClass("hidden")}),t("#form_export_billable").submit(function(){var a=t(this);if(!a.valid())return!1;var e=a.find('button[type="submit"]'),o=a.find(".loading-block"),n=a.find(".error-block");return n.addClass("hidden"),o.removeClass("hidden"),t.ajax({url:a.attr("action"),type:"POST",data:a.serialize(),success:function(a){var e=a.templates,o={SheetNames:[],Sheets:{}},n=[];for(var l in a.colFomulas){var r=a.colFomulas[l];if(Array.isArray(r))for(var i in r)r[i]=htmlEntities(r[i]);n.push({sqref:l,values:r})}for(var s in e){t("#tbl_template").append(e[s]);var d=t("#tbl_template table:last")[0],u=XLSX.utils.table_to_book(d,{cellStyles:!0,cellDates:!1,cellFormula:!0}).Sheets.Sheet1;if(s===a.sheetRunning||s===a.sheetOpportunity){var f=n.slice(0);s===a.sheetRunning?f.push({sqref:a.statusRange,values:a.listProjStatuses}):s===a.sheetOpportunity&&f.push({sqref:a.statusRange,values:a.listStatusLabels}),u["!dataValidation"]=f,u["!cols"]=[{hidden:!1,wch:5},{hidden:!1,wch:5},{hidden:!1,wch:10},{hidden:!1,wch:20},{hidden:!1,wch:15},{hidden:!1,wch:5},{hidden:!1,wch:5}]}"D_Config"===s&&(u["!cols"]=[{hidden:!1,wch:30}]),"Overview"===s&&(u["!cols"]=[{hidden:!1,wch:5},{hidden:!1,wch:30}]),t.each(u,function(t,e){var o=parseInt(t.replace(/\D+/g,"")),n=parseInt(a.offsetRow);o!==n-1&&o!==n-2||s!==a.sheetRunning&&s!==a.sheetOpportunity&&s!==a.sheetMember||(e.s={fill:{patternType:"solid",bgColor:{rgb:"f5f5f5",theme:"1",tint:"-0.25",indexed:64}},alignment:{vertical:"center",horizontal:"center"}}),e.v&&"="===e.v[0]&&(e.f=e.v,e.v=0,u[t]=e)}),o.SheetNames.push(s),o.Sheets[s]=u}var c=XLSX.write(o,{bookType:"xlsx",bookSST:!0,type:"binary"}),p=a.fileName+".xlsx";try{saveAs(new Blob([s2ab(c)],{type:"application/octet-stream"}),p)}catch(h){return}t("#tbl_template").html(""),t("#modal_export_billable").modal("hide")},error:function(t){var a=t.responseJSON||"Error!";n.removeClass("hidden").text(a)},complete:function(){e.prop("disabled",!1),o.addClass("hidden")}}),!1}),t("#modal_import_billable, #modal_export_billable").on("shown.bs.modal",function(){t(this).find(".select2-container").css("width","100%");var a=t(".tab-pane-team.active").attr("data-team");t(this).find('select[name="team_id"]').val(a).trigger("change")}),t("#modal_export_billable").on("hide.bs.modal",function(){var a=t(this).find("form .loading-block");return a.hasClass("hidden")}),t(document).ready(function(){mrHasPermissUpdate&&t('table tr[data-row="'+rowCost+'"] input').blur()})}(jQuery),$(".start-month").change(function(){for(var t=$(this).val(),a=1;a<=12;a++)a<t?$('.end-month option[value="'+a+'"]').prop("disabled",!0):$('.end-month option[value="'+a+'"]').prop("disabled",!1);$(".btn-search").trigger("click"),setTimeout(function(){selectSearchReload()},200)}),$(".end-month").change(function(){for(var t=$(this).val(),a=1;a<=12;a++)a>t?$('.start-month option[value="'+a+'"]').prop("disabled",!0):$('.start-month option[value="'+a+'"]').prop("disabled",!1);$(".btn-search").trigger("click"),setTimeout(function(){selectSearchReload()},200)}),$(".year-filter").change(function(){$(".btn-search").trigger("click")});