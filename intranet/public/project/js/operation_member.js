function getStringCalculatedMonth(e,t){var a=moment(e);return moment(a).add(t,"months").format("Y-MM")}function getDataMappingMonth(e,t,a){if(!globalEmployeePoints[e][t][a]&&a>"2012-01"){var o=Object.keys(globalEmployeePoints[e][t]);o=o.sort(),o=o.reverse();for(var l in o)if(a>o[l]){var n=globalEmployeePoints[e][t][o[l]];return n&&n.leave_date&&a>n.leave_date?null:n}}return globalEmployeePoints[e][t][a]}function checkValidContractDateEmployee(e,t){for(var a=Object.keys(t),o=!1,l=0;l<a.length;l++)e>=a[l]&&(o=!0);return o}function getPointForMaternity(e,t){if(!globalEmployeeMaternity.hasOwnProperty(t))return 0;var a=0;for(var o in globalEmployeeMaternity[t]){var l=globalEmployeeMaternity[t][o];if(e===l.leave_start)a+=l.percent_not_working_from_leave_start;else if(e===l.leave_end)a+=l.percent_not_working_until_leave_end;else if(e>l.leave_start&&e<l.leave_end)return 1}return a>1?1:a}function getData(){$("#messageBox").empty(),$(".message").html(""),$(".table-responsive").empty();for(var e="",t=globalMonthFrom,a="hidden";t<=globalMonthTo;){var o="",l="",n="";t===globalCurrentMonth&&(o='class="month-now"',l="table-now",n="text-now"),e='<table class="dataTable table-bordered table-hover table-grid-data not-padding-th dataTable-project table-members table '+l+'">',e+='<thead class="table-header">',e+="<tr "+o+">",e+='<th class="head-month-first" colspan="4" data-order="name">'+t,e+="</tr>",e+="<tr>",e+='<th class="head-month '+n+'" colspan="4">'+globalHeader["Reward Total"]+": $$totalPoint$$",e+="</tr>",e+="<tr>",e+='<th class="header__item col-no scrips-no '+n+'"><a class="order filter__link filter__link--number" href="#">'+globalHeader.No+"</a>",e+='<th class="header__item col-name scrips-name '+n+'"><a  class="employee_name filter__link" href="#">'+globalHeader.Member+"</a>",e+='<th class="header__item col-account-name scrips-account-name'+n+'"><a  class="account_name filter__link" href="#">'+globalHeader["Account Name"]+"</a>",e+='<th class="header__item col-point scrips-point '+n+'"><a class="point filter__link filter__link--number" href="#">'+globalHeader.Point+"</a>",e+='</tr></thead><tbody class="table-content">';var r=0,i=1;for(var s in globalEmployeePoints)if(globalEmployeePoints.hasOwnProperty(s))for(var c in globalEmployeePoints[s]){var m=globalEmployeePoints[s][c];if(checkValidContractDateEmployee(t,m)){var d=getDataMappingMonth(s,c,t);if(d){var p=d.point;if(d.join_date>t)continue;if(d.leave_date<t)continue;d.join_date===t&&(p=d.actual_point_first_month),d.leave_date===t&&(p=d.actual_point_last_month);var h=s.split("-")[1],g=s.split("-")[0],b=getPointForMaternity(t,h);p=Math.round(100*(p-b*p))/100,r+=parseFloat(p>=0?p:0),e+='<tr class="table-row operation_member_detail" data-toggle="tooltip" data-container="body" data-html="true"data-original-title="<ul class=\'operation_member_tooltip\'><li>'+gloabalLocale.employee_code+": "+d.employee_code+"</li><li>"+gloabalLocale.email+": "+d.email+"</li><li>"+gloabalLocale.team+": "+d.team_name+'</li></ul>">',e+='<td class="table-data col-no" >'+i++,e+='<td class="table-data col-name"data-member-id="'+h+'"data-team-id="'+g+'"data-month="'+t+'" >'+d.name,e+='<td class="table-data col-account-name" >'+d.account_name,e+='<td class="table-data col-point">'+p,e+="</tr>"}i>15&&(a="scroll")}}e=e.replace("$$totalPoint$$",parseFloat(r).toFixed(2)),e+="</tbody>",e+="</table>",$("#countResponsive").append(e),t=getStringCalculatedMonth(t,1)}var _=$(".tab-content").width(),v=parseInt($(".table-members").css("width").replace("px",""))+2,u=v*$(".table-members").length,f=$(window).scrollTop(),y=$(".total-responsive").offset().top,w=y-f;u>_?$(".total-responsive").css({width:_,"max-height":"calc(100vh - "+w+"px)","overflow-x":"scroll"}):$(".total-responsive").css({width:u+16,"max-height":"calc(100vh - "+w+"px)","overflow-x":"hidden"}),$("#countResponsive").css("width",u),loadingIcon(!1),loadingIconStart(!1),initActionSort()}function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=a.exec(t);return o?o[2]?decodeURIComponent(o[2].replace(/\+/g," ")):"":null}function loadData(){loadingIcon(!0);var e,t=getParameterByName("page")?getParameterByName("page"):1,a=[location.protocol,"//",location.host,location.pathname].join("");e=$(".input-select-team-member").length?$(".input-select-team-member").val():$("#selected-team").data("id");var o={monthFrom:globalMonthFrom,monthTo:globalMonthTo,page:t,url:a,teamId:e,typeViewMain:globalTypeViewMain};$.ajax({url:globalGetOperationUrl,type:"post",dataType:"json",data:o,success:function(e){e?(globalEmployeePoints=e.employee_points,globalEmployeeMaternity=e.maternity_data,getData(),$("#countResponsive table tbody").css({overflow:"auto",display:"block",height:$(".total-responsive").outerHeight()-$("thead").outerHeight()-20+"px"})):errorData(globalMessage["No results found"])}})}function errorData(e){$("#messageBox").empty();var t="";t+='<div class="alert alert-error alert-dismissible">',t+='<button type="button" class="close" data-dismiss="alert">×</button>',t+='<strong class="message"></strong>',t+="</div>",$("#messageBox").append(t),$(".message").html(e),$(".total-responsive").css({width:"0px","overflow-x":"hidden"}),$(".table-responsive").empty()}function loadingIcon(e){e?($(".loading-icon").removeClass("hidden"),$(".table-responsive").addClass("hidden"),$(".total-responsive").css({width:"100%","max-height":"700px","overflow-x":"hidden","overflow-y":"hidden"})):($(".loading-icon").addClass("hidden"),$(".table-responsive").removeClass("hidden"))}function loadingIconStart(e){e?$(".se-pre-con").show():$(".se-pre-con").hide()}function replaceTVKhongDau(e){var t=e;return t=t.toLowerCase(),t=t.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g,"a"),t=t.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g,"e"),t=t.replace(/ì|í|ị|ỉ|ĩ/g,"i"),t=t.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g,"o"),t=t.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g,"u"),t=t.replace(/ỳ|ý|ỵ|ỷ|ỹ/g,"y"),t=t.replace(/đ/g,"d"),t=t.replace(/!|@|%|\^|\*|\(|\)|\+|\=|\<|\>|\?|\/|,|\.|\:|\;|\'|\"|\&|\#|\[|\]|~|\$|_|`|-|{|}|\||\\/g," "),t=t.replace(/ + /g," "),t=t.trim()}function initActionSort(){var e=["order","employee_name","point","account_name"];$.each(e,function(e,t){var a="";$("body").on("click","."+t,function(e){e.preventDefault();var t=$(e.target).closest(".table");$(t).find(".filter__link.filter__link--active").not(this).removeClass("filter__link--active"),$(this).toggleClass("filter__link--active"),$(t).find(".filter__link").removeClass("asc desc"),"asc"===a||""===a?($(this).addClass("desc"),a="desc"):($(this).addClass("asc"),a="asc");var o=$(this).closest(".header__item"),l=$(t).find(".header__item").index(o),n=$(t).find(".table-content"),r=n.find(".table-row").get(),i=$(this).hasClass("filter__link--active"),s=$(this).hasClass("filter__link--number");return r.sort(function(e,t){var a=$(e).find(".table-data").eq(l).text().toLowerCase(),o=$(t).find(".table-data").eq(l).text().toLowerCase();return s?i?+o-+a:+a-+o:(a=replaceTVKhongDau(a),o=replaceTVKhongDau(o),i?a>o?-1:a<o?1:0:a<o?-1:a>o?1:0)}),$.each(r,function(e,t){n.append(t)}),!1})})}var globalEmployeePoints={},globalEmployeeMaternity={},globalMonthFrom=null,globalMonthTo=null;$(document).ready(function(){loadingIcon(!0),loadingIconStart(!0),$(".input-select-team-member").val(gloabalTeamId),$("#activity_month_to_members").trigger("change")}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")}}),$("#activity_month_from_members").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",autoclose:!0}),$("#activity_month_to_members").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",autoclose:!0}),$("#activity_month_from_members").datepicker("setDate",gloabalStartDateFilter),$("#activity_month_to_members").datepicker("setDate",gloabalEndDateFilter),$("#activity_month_from_members, #activity_month_to_members").change(function(){globalMonthFrom=$("#activity_month_from_members").val(),globalMonthTo=$("#activity_month_to_members").val(),globalMonthFrom>globalMonthTo?errorData(globalMessage.Montherror):loadData()}),$(".input-select-team-member").change(function(){loadData()});