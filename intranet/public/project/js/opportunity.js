function deleteWorkorderApproved(e,t){var a="risk",i=assignDefaultValue("risk");$("#modal-delete-confirm-new").modal("show"),$("#modal-delete-confirm-new .btn-ok").data("type",i),$("#modal-delete-confirm-new .btn-ok").data("className",a);var n=$(e).data("id");displayTextDeleteConfirm(e);var o=t;$(document).on("click","#modal-delete-confirm-new .btn-ok",function(){var e=$(this).data("type");if(a=$(this).data("className"),i==e){if($("#modal-delete-confirm-new").modal("hide"),$("#loading-item-"+e+"-"+n).removeClass("display-none"),$(".delete-"+a).addClass("display-none"),$(".edit-"+a).addClass("display-none"),$(this).data("requestRunning"))return;$(this).data("requestRunning",!0);var t=!0,r={_token:siteConfigGlobal.token,project_id:projectId,id:n,isDelete:t};$.ajax({url:o,type:"post",dataType:"json",data:r,success:function(t){if(t.status)$("#modal-delete-confirm-new .btn-ok").removeAttr("type"),$("#modal-delete-confirm-new .btn-ok").removeAttr("className"),$(".workorder-"+a).html(t.content),$('[data-toggle="tooltip"], .tooltip').tooltip("hide"),"risk"==e&&location.reload();else{if("undefined"!=typeof t.popuperror&&1==t.popuperror){if("undefined"!=typeof t.reload&&1==t.reload)return window.location.reload(),!0;$(".warning-action").attr("data-noti",t.message_error),$(".warning-action").trigger("click")}$("#modal-warning-notification .text-default").html(messageError),$("#modal-warning-notification").modal("show")}},error:function(){$("#modal-warning-notification .text-default").html(messageError),$("#modal-warning-notification").modal("show")},complete:function(){$("#modal-delete-confirm-new .btn-ok").data("requestRunning",!1)}})}})}function displayTextDeleteConfirm(e){modalConfirm=$("#modal-delete-confirm-new"),$(e).hasClass("fa-times")?(modalConfirm.find(".text-default").hide(),modalConfirm.find(".text-undo").hide(),modalConfirm.find(".text-change").show()):$(e).hasClass("fa-undo")?(modalConfirm.find(".text-default").hide(),modalConfirm.find(".text-undo").show(),modalConfirm.find(".text-change").hide()):(modalConfirm.find(".text-default").show(),modalConfirm.find(".text-undo").hide(),modalConfirm.find(".text-change").hide())}function assignDefaultValue(e,t){return"undefined"==typeof t&&(t=null),"undefined"==typeof e&&(e=t),e}function formatRepo(e){return e.loading?e.text:markup=e.avatar?"<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'><img style=\"margin-right:8px;max-width: 32px;max-height: 32px;border-radius: 50%;\" src=\""+e.avatar+'">'+e.text+"</div></div>":"<div class='select2-result-repository clearfix'><div class='select2-result-repository__title'><i style='margin-right:8px' class='fa fa-user-circle fa-2x' aria-hidden='true'></i>"+e.text+"</div></div>"}function formatRepoSelection(e){return e.text}!function(e){function t(t,a){if(!t.hasClass("loaded")){t.addClass("loaded");var i=e('<p><i class="fa fa-2x fa-refresh fa-spin"></i></p>').prependTo(t);e.ajax({url:urlGetContentTable,data:{projectId:projectId,type:a},success:function(i){return"team_allocation"===a?(rkWoAllocation.init(i.data,t.find(".inner-content")),!0):(t.find(".inner-content").html(i.content),void e(document).tooltip({selector:".is-tooltip",placement:"top",trigger:"hover",animation:!1}))},complete:function(){i.remove()}})}}var a={"proj[name]":{required:!0,rangelength:[1,255],remote:{url:urlCheckExists,type:"POST",data:{_token:siteConfigGlobal.token,name:"name",value:function(){return e("#name").val().trim()},table:TABLE_PROJECT,projectId:projectId}}},"team_id[]":{required:!0},"sale_id[]":{required:!0},"proj[start_at]":{required:!0,lessThan:'input[name="proj[end_at]"]'},"proj[end_at]":{required:!0},"quality[billable_effort]":{number:!0,greateThan:0},"quality[cost_approved_production]":{number:!0,greateThan:0},"quality[approved_cost]":{number:!0,greateThan:0}},i={"proj[name]":{required:textFieldRequired,rangelength:textFieldMax255,remote:textFieldUnique},"team_id[]":{required:textFieldRequired},"sale_id[]":{required:textFieldRequired},"proj[start_at]":{required:textFieldRequired},"proj[end_at]":{required:textFieldRequired},"quality[billable_effort]":{number:textFieldNumber},"quality[cost_approved_production]":{number:textFieldNumber},"quality[approved_cost]":{number:textFieldNumber}};if(jQuery.validator.addMethod("greateThan",function(e,t,a){return""===e||e>a},valueGreaterThanZero),jQuery.validator.addMethod("lessThan",function(t,a,i){return!t||!e(i).val()||(this.optional(a)||t<=e(i).val())},startDateBefore),e("#create-project-form").validate({rules:a,ignore:[],messages:i,errorPlacement:function(t,a){t.appendTo(e(a).closest(".form-group").find('div[class^="col-sm-"]'))}}),"undefined"!=typeof RKVarPassGlobal&&e("select.team-dev-tree").length){var n,o,r,l=RKfuncion.teamTree.init(RKVarPassGlobal.teamPath,RKVarPassGlobal.teamSelected,{});e.each(l,function(e,t){o=t.disabled?" disabled":"",r=t.selected?" selected":"",n+='<option value="'+t.id+'"'+o+r+">"+t.label+"</option>"}),e("select.team-dev-tree").append(n)}e(".multiselect2").multiselect({includeSelectAllOption:!1,numberDisplayed:2,nonSelectedText:RKVarPassGlobal.multiSelectTextNone,allSelectedText:RKVarPassGlobal.multiSelectTextAll,nSelectedText:RKVarPassGlobal.multiSelectTextSelected,enableFiltering:!0,enableCaseInsensitiveFiltering:!0,buttonText:function(t,a){if(0===t.length)return RKVarPassGlobal.multiSelectTextNone;if(t.length>2)return t.length+" "+RKVarPassGlobal.multiSelectTextSelected;var i=[];return t.each(function(){i.push(e(this).text().trim())}),i.join(", ")+""}}),e("#opportunity_tabs .load-ajax>a").click(function(a){var i=e(e(a.target).attr("href")),n=e(a.target).attr("href").replace(/(\#|\?|\=|\&|\:|\/)/g,"");t(i,n),e(".box-footer").addClass("hidden"),e("#current_tab").val("")}),e("#opportunity_tabs li:not(.load-ajax)>a").click("shown.bs.tab",function(t){e(".box-footer").removeClass("hidden"),e("#current_tab").val(e(this).attr("href"))});var s=window.location.hash;s||(s="#basic_info"),s&&e('#opportunity_tabs a[href="'+s+'"]').length>0&&e('a[href="'+s+'"]').click(),e(document).on("click",".add-risk",function(){var t=e(this),a=t.data("project-id");t.find("i.fa-plus").removeClass("fa-plus").addClass("fa-refresh").addClass("fa-spin"),e.ajax({url:urlEditRisk,type:"get",data:{projectId:a,redirectUrl:window.location.href},dataType:"text",success:function(t){BootstrapDialog.show({title:modalRiskTitle,cssClass:"risk-dialog",message:e("<div></div>").html(t),closable:!1,buttons:[{id:"btn-close",icon:"fa fa-close",label:"Close",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}},{id:"btn-save",icon:"glyphicon glyphicon-check",label:"Save",cssClass:"btn-primary",autospin:!1,action:function(t){e(".form-riks-detail").submit()}}]})},error:function(){alert("ajax fail to fetch data")},complete:function(){t.find("i.fa-refresh").addClass("fa-plus").removeClass("fa-refresh").removeClass("fa-spin")}})}),e("body").on("change",".select-same",function(){var t=e(this).val(),a=e(this).attr("data-same");e('.select-same[data-same="'+a+'"]').val(t),e(".select-same").select2({minimumResultsForSearch:-1})});var d="fa-pencil-square-o",c="fa-eye";e(document).on("click",".edit-risk",function(){var t=e(this),a=t.data("id"),i=!0;t.hasClass(d)?t.removeClass(d):(t.removeClass(c),i=!1),t.find("i.fa-refresh").removeClass("hidden"),e.ajax({url:urlEditRisk,type:"get",data:{riskId:a,redirectUrl:window.location.href},dataType:"text",success:function(t){BootstrapDialog.show({title:modalRiskTitle,cssClass:"risk-dialog",message:e("<div></div>").html(t),closable:!1,buttons:[{id:"btn-close",icon:"fa fa-close",label:"Close",cssClass:"btn-primary",autospin:!1,action:function(e){e.close()}},{id:"btn-save",icon:"glyphicon glyphicon-check",label:"Save",cssClass:"btn-primary",autospin:!1,action:function(t){e(".form-riks-detail").submit()}}]})},error:function(){alert("ajax fail to fetch data")},complete:function(){i?t.addClass(d):t.addClass(c),t.find("i.fa-refresh").addClass("hidden")}})}),e(document).on("click",".delete-risk",function(){deleteWorkorderApproved(this,urlAddRisk)}),e("body").on("click",".add-number-member-btn",function(t){t.preventDefault();var a=e(this).closest(".number-member-form"),i=a.find(".number-member").val(),n=a.find(".member-pl").val(),o=a.find(".member-pl option:selected").text();if(!i||!n)return void bootbox.alert({className:"modal-danger",message:"Please input valid data!"});var r=e(this).closest(".number-member-group").find(".list-members-pl"),l=e(memberPlTpl(e(this).data("name")));l.find(".num-member").text(i),l.find(".input-num-member").val(i),l.find(".pl-name").text(o),l.find(".input-pl").val(n),l.appendTo(r),a.find(".number-member").val(""),a.find(".member-pl").val("").trigger("change")}),e("body").on("click",".btn-del-member-pl",function(t){t.preventDefault(),e(this).closest("li").remove()})}(jQuery),$(function(){$(".select-search-employee").select2({minimumInputLength:2,ajax:{url:$(".select-search-employee").data("remote-url"),dataType:"json",delay:500,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:20*t.page<e.total_count}}},cache:!0},escapeMarkup:function(e){return e},templateResult:formatRepo,templateSelection:formatRepoSelection})});

