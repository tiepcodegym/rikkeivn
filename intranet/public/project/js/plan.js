function saveComment(){$(".mentiony-link").each(function(){var e={},t=$(this);e.id=t.attr("data-item-id"),e.email=t.attr("href"),e.name=t.text(),membersList.push(e)});var e=$("#proj-plan-comment").val();return""===e.trim()?($planCommentError.show(),!1):($planCommentError.hide(),void $.ajax({type:"POST",url:urlSaveComment,dataType:"json",data:{membersList:membersList,comment:e,projectId:projId,_token:token,limit:$projectPlanComments.find(":selected").text()},success:function(e){e.success&&""!==e.data&&($commentList.html(e.data),$("#proj-plan-comment").val(""),$btnAddComment.prop("disabled",!1)),e.error&&($modalWarning.find(".text-default").text(e.message),$modalWarning.modal("show")),membersList=[],$(".mentiony-content").html("")},error:function(e){e.error&&($modalWarning.find(".text-default").text(e.message),$modalWarning.modal("show")),membersList=[],$("#proj-plan-comment").val(""),$btnAddComment.prop("disabled",!1),$(".mentiony-content").html("")}}))}function showModalError(e){$modalError.find(".text-default").html(e||"Error occurred, please try again later!"),$modalError.modal("show")}var $projectPlanComments=$("#project-plan-comments"),$planCommentError=$projectPlanComments.find("#plan-comment-error"),$commentList=$projectPlanComments.find(".grid-data-query-table"),$btnAddComment=$projectPlanComments.find("#add-comment-feedback"),$modalWarning=$("#modal-warning-notification"),$modalSuccess=$modalWarning.next(),$btnUpload=$("#upload"),$inputFiles=$("#files"),$listInputFiles=$("#file-list"),$errorProjectFile=$("#project-file-error"),$fileContainer=$(".grid-data-file-list"),membersOfProject=[],membersList=[];$(document).ready(function(){$.ajax({url:urlGetMembers,type:"POST",dataType:"json",data:{projectId:projId,_token:token},success:function(e){membersOfProject=e.data}}),$("#proj-plan-comment").mentiony({onDataRequest:function(e,t,a){for(var o,n=[],r=0,l=membersOfProject.length,i=JSON.parse(JSON.stringify(membersOfProject));r<l;r++)i[r].name.toLowerCase().indexOf(t.toLowerCase())>-1&&(o=i[r],o.name=htmlEntities(o.name),o.info=htmlEntities(o.info),o.email=htmlEntities(o.email),n.push(o));a.call(this,n)}})});var tempFiles=[],formData=new FormData,totalSize=0;$inputFiles.change(function(e){e.preventDefault();for(var t=$(this),a=t[0].files,o=0;o<a.length;o++){if($errorProjectFile.hide(),a[o].size>1024*maxFileSize)return showModalError(maxFileSizeMsg+" ("+a[o].name+" - "+Math.floor(a[o].size/1024)+" KB)"),!1;if(totalSize+=a[o].size,totalSize>1024*maxFileSize)return showModalError(maxTotalFileSizeMsg),totalSize-=a[o].size,!1;$listInputFiles.append("<p>"+a[o].name+"</p>"),formData.append("files[]",a[o]),tempFiles.push(a[o])}}),$btnUpload.click(function(){return 0===tempFiles.length?($errorProjectFile.show(),!1):($errorProjectFile.hide(),$btnUpload.prop("disabled",!0),formData.append("_token",token),formData.append("projectId",projId),void $.ajax({url:urlUpload,type:"POST",dataType:"json",data:formData,cache:!1,contentType:!1,processData:!1,success:function(e){e.success?(e.data.forEach(function(e){var t=e.file_url,a=e.created_at,o=urlDownload.replace(":file",t)+"?projectId="+projId,n='<div class="item"><p><span>'+e.file_name+" ( created at: "+a+')</span><a class="margin-left-10" title="'+titleDownload+'" href="'+o+'" ><span style="font-size: 20px"><i class="fa fa-download"></i></span></a><span class="btn-delete-file" data-remote-url="'+(urlDeleteFile+t)+'"><i class="fa fa-trash"></i></span></p></div>';$fileContainer.children("p").remove(),$fileContainer.prepend(n)}),$modalSuccess.find(".text-default").text(e.message),$modalSuccess.modal("show")):($modalWarning.find(".text-default").text(e.message),$modalWarning.modal("show")),formData["delete"]("files[]"),tempFiles=[],$inputFiles.val(""),$btnUpload.prop("disabled",!1),$listInputFiles.html(""),totalSize=0},error:function(e){formData["delete"]("files[]"),tempFiles=[],$inputFiles.val(""),$btnUpload.prop("disabled",!1),$listInputFiles.html(""),totalSize=0,e.error&&($modalWarning.find(".text-default").text(e.message),$modalWarning.modal("show"))}}))}),$fileContainer.on("click",".btn-delete-file",function(){if(!confirm(txtConfirmDeleteFile))return!1;var e=$(this),t=e.attr("data-remote-url");$.ajax({method:"delete",url:t,dataType:"json",data:{projectId:projId,_token:token},success:function(t){t.success&&($modalSuccess.find(".text-default").text(t.message),$modalSuccess.modal("show"),e.closest(".item").remove(),$fileContainer.children(".item").length||$fileContainer.html('<p style="font-size: 18px">'+txtNoFiles+"</p>")),t.error&&($modalWarning.find(".text-default").text(t.message),$modalWarning.modal("show"))},error:function(e){$modalWarning.find(".text-default").text(e.message),$modalWarning.modal("show")}})});