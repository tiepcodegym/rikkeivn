function statusHover(e){$(document).on({mouseenter:function(){var e=$(this);return e.find("i").length>0||e.find("select").length>0||void e.append("<i class='fa fa-pencil-square-o pull-right' aria-hidden='true'></i>")},mouseleave:function(){var e=$(this);e.find("i").remove()}},e)}function bonusMoneyOnclick(e){$(e).is(":checked")?bonus_money=1:bonus_money=0;var t={_token:token,bonus_money:bonus_money};$.ajax({url:urlBonusMoney,type:"post",data:t,dataType:"json",success:function(e){$("#modal-success-notification").find(".text-default").html(e.message),$("#modal-success-notification").modal("show")}})}function generateHtml(e){e===typeIssueCSS&&$.ajax({url:urlGenerateHtml,type:"post",data:{type:typeCustomerFeedback,_token:token},dataType:"json",success:function(e){$('.grid-data-query[data-type="'+typeCustomerFeedback+'"] .grid-data-query-table').html(e)}})}jQuery(document).ready(function(e){function t(t,a,r){if(!e(".task-tooltip").length)return!1;if("undefined"==typeof globalPassModule||"undefined"==typeof globalPassModule.urlTaskTitle||!globalPassModule.urlTaskTitle)return!1;"undefined"==typeof t&&(t=globalPassModule.weekSlug),"undefined"==typeof a&&(a=null);var n=globalPassModule.urlTaskTitle,o={position:{my:"top center",at:"center",viewport:e(window),adjust:{y:10}},hide:{fixed:!0,delay:100},style:{classes:"custom-tooltip"},content:{text:null}},i={},d={};if(a){var s=e('.task-tooltip[data-hasqtip="'+a+'"]').data("id");i[s]=s}else e(".task-tooltip").each(function(){var t=e(this).data("id");t&&(i[t]=t)});return!Object.keys(i).length||void e.ajax({url:n,type:"post",dataType:"json",data:{_token:siteConfigGlobal.token,ids:i,weekSlug:t,noBaseline:globalPassModule.noBaseline},success:function(t){if(!t||!t.success||!t.data){if(a){var n=e("#qtip-"+a+"-content .btn-load-note");n.remove()}return!0}var i=t.prev_weeks||null;e.each(t.data,function(n,s){if(!s||!Object.keys(s).length)return!0;if(a){var l="<p><b>"+t.curr_week+"</b></p>",c=s[r].trim();l+=c?c:"<p>"+globalText.noComment+"</p>";var u=e("#qtip-"+a+"-content"),m=u.find(".btn-load-note");m.find("i").addClass("hidden"),u.append(l),i&&i[n]?(m.attr("data-week",i[n]),m.detach().appendTo(u)):m.remove()}else e.each(s,function(a,r){r=r.trim(),r||(r="<p>"+globalText.noComment+"</p>"),r="<p><b>"+t.curr_week+"</b></p>"+r,i&&i[n]&&(r+='<a href="#" class="btn-load-note" data-week="'+i[n]+'" data-type="'+a+'">'+globalText.loadMore+' <i class="fa fa-spin fa-refresh hidden"></i></a>'),d=e.extend(o,{content:{text:r}}),e(".task-tooltip[data-id="+n+"][data-type="+a+"]").length&&e(".task-tooltip[data-id="+n+"][data-type="+a+"]").qtip(d)})})},complete:function(){if(a){var t=e("#qtip-"+a+"-content"),r=t.find(".btn-load-note");r.find("i").addClass("hidden")}}})}function a(){var t={position:{my:"top center",at:"center",viewport:e(window),adjust:{y:10}},hide:{fixed:!0,delay:100},style:{classes:"custom-tooltip"},content:{text:null}};e(".raise-content-tooltip").each(function(){var a,r=e(this),n=r.data("raise-note");return!(n=String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\n/g,"<br />"))||(a=e.extend(t,{content:{text:n}}),void r.qtip(a))})}function r(){if(!e(".col-hover-tooltip").length)return!1;var t={position:{my:"top center",at:"center",viewport:e(window),adjust:{y:10}},hide:{fixed:!0,delay:100},style:{classes:"custom-tooltip"},content:{text:null}};e(".col-hover-tooltip").each(function(){var a,r=e(this);return!r.find(".tooltip-content").length||(text=r.find(".tooltip-content").html().trim(),!text||(a=e.extend(t,{content:{text:text}}),void r.qtip(a)))})}function n(){if(e(".task-tooltip").length&&e(".task-list-modal").length){var t=e(".task-list-modal"),a={};e(".task-tooltip").click(function(r){r.preventDefault();var n=e(this).data("id"),o=e(this).data("type");if(!o||!n)return!0;if(e(".task-list-modal[data-id="+n+"][data-type="+o+"]").length)return e(".task-list-modal[data-id="+n+"][data-type="+o+"]").modal("show"),!0;var i=t.clone();i.attr("data-id",n),i.attr("data-type",o);var d=i.find(".grid-data-query").data("url"),s=i.find(".btn-add-task").data("url");return d=d.replace(/\/0\//,"/"+n+"/"),d+="?type="+o,s=s.replace(/\/0\//,"/"+n+"/"),s+="?type="+o,i.find(".grid-data-query").attr("data-url",d),"undefined"!=typeof a[n]&&"undefined"!=typeof a[n][o]&&1==a[n][o]||(a[n]={},a[n][o]=!0,e.ajax({url:d,type:"get",dataType:"json",success:function(t){if("undefined"!=typeof t.html){i.find(".grid-data-query-table").html(t.html),"undefined"!=typeof t.is_open&&t.is_open?i.find(".btn-add-task").attr("href",s):i.find(".btn-add-task").remove();var a=i.find(".task-list-title .task-list-title-text[data-type="+o+"]");a.length&&(i.find(".task-list-title .task-list-title-text").addClass("hidden"),a.removeClass("hidden")),e(".task-list-popup-wraper").append(i),e(".task-list-modal[data-id="+n+"][data-type="+o+"]").modal("show")}i.find(".fa-refresh").addClass("hidden")}}),void 0)})}}function o(){"undefined"!=typeof globalPassModule&&"undefined"!=typeof globalPassModule.urlInitPoint&&globalPassModule.urlInitPoint&&e.ajax({url:globalPassModule.urlInitPoint,type:"GET",dataType:"json",success:function(t){"undefined"!=typeof t.success&&1==t.success&&("undefined"!=typeof t.html_task&&t.html_task&&e.each(t.html_task,function(t,a){e(t).length&&(e(t).find(".grid-data-query-table").html(a),e(t).find(".fa-refresh").addClass("hidden"))}),"undefined"!=typeof t.html&&t.html&&e.each(t.html,function(t,a){e(t).length&&(null===a?e(t).html("&nbsp;"):e(t).text(a))}),"undefined"!=typeof t.input&&t.input&&e.each(t.input,function(t,a){e("input.pp-input[name="+t+"]").length&&e("input.pp-input[name="+t+"]").val(a).attr("data-value",a)}),"undefined"!=typeof t.color&&t.color&&e.each(t.color,function(t,a){e(t+" img").length&&e(t+" img").attr("src",a)}),"undefined"!=typeof t.dom&&"undefined"!=typeof t.dom.hover&&t.dom.hover&&e.each(t.dom.hover,function(t,a){e(t).length&&(e(t).attr("title",RKfuncion.general.parseHtml(a)),e(t).tooltip())}))}})}function i(){if("undefined"!=typeof globalPassModule&&"undefined"!=typeof globalPassModule.teamProject&&globalPassModule.teamProject){var t=e(".content-wrapper .content-header h1");t.length&&(t.attr("title",RKfuncion.general.parseHtml(globalPassModule.teamProject)),t.tooltip())}}function d(){if(e("#modal-reward-feedback").length&&e("#form-project-reward").length&&e("#modal-reward-feedback").appendTo("#form-project-reward"),"undefined"!=typeof RKProjectReward){var t={dev:RKProjectReward.point_employee.dev.total?RKProjectReward.reward.dev/RKProjectReward.point_employee.dev.total:0,sqa:RKProjectReward.point_employee.sqa.total?RKProjectReward.reward.sqa/RKProjectReward.point_employee.sqa.total:0,pqa:RKProjectReward.point_employee.pqa.total?RKProjectReward.reward.pqa/RKProjectReward.point_employee.pqa.total:0},a={dev:0,sqa:0,pqa:0},r=["dev","sqa","pqa","add"],n=0,o=0,i={dev:0,sqa:0,pqa:0};e(".reward-employee-row").each(function(){var d=e(this),s=d.data("type"),l=d.data("id");if(!s||!l||r.indexOf(s)<0)return!0;a[s]++,a[s]>=RKProjectReward.count_employee[s]?n=Math.round(RKProjectReward.reward[s]-i[s]):(n=Math.round(t[s]*RKProjectReward.point_employee[s][l]),i[s]+=n),d.find(".reward-norm").html(e.number(n));var c=d.find("input.input-reward.input-reward-submit");c.length&&RKProjectReward.pm_null&&c.val(e.number(n)),o+=n,RKProjectReward.is_submitted&&RKProjectReward.leader_null?d.find("input.input-reward-confirm").val(d.find('[data-reward-fill="pm"]').text().trim().replace(/,/g,"")):RKProjectReward.is_reviewed&&RKProjectReward.coo_null&&d.find("input.input-reward-approve").val(d.find('[data-reward-fill="leader"]').text().trim().replace(/,/g,""))}),e('.reward-total-report [data-reward-total="norm"]').html(e.number(o)),e('[data-flag-load="reward"]').remove(),e('[data-loading="reward"]').removeClass("hidden"),e(".bonus-money .toggle.btn.btn-sm").width("78")}}function s(){if(!e(".form-reward-budget").length)return!1;var t="Giá trị budget của level cao hơn không thể thấp hơn giá trị budget của level nhỏ hơn nó";e(".form-reward-budget input.input-reward-budget").change(function(){var a=!0;e(".form-reward-budget input.input-reward-budget").each(function(){e(this).next(".error").remove();var r=parseFloat(e(this).val().trim().replace(/,/g,""));if(r<0&&(e(this).next(".error").remove(),e('<label class="error">'+varGlobalPassModule.messageValidateRewardMin+"</label>").insertAfter(e(this)),a=!1),!a)return!0;var n=parseInt(e(this).data("reward-level")),o=e('.form-reward-budget input.input-reward-budget[data-reward-level="'+(n+1)+'"]');if(!o.length)return!0;var i=parseFloat(o.val().trim().replace(/,/g,""));r>i&&(e('<label class="error">'+t+"</label>").insertAfter(o),a=!1)}),a?e('.form-reward-budget [data-block-form-submit="1"]').removeAttr("disabled"):e('.form-reward-budget [data-block-form-submit="1"]').attr("disabled","disabled")}),e(".form-reward-budget input.input-reward-budget-long").change(function(){var a=!0;e(this).next(".error").remove();var r=parseFloat(e(this).val().trim().replace(/,/g,""));r<0&&(e("input").find(".error").remove(),e('<label class="error">'+varGlobalPassModule.messageValidateRewardMin+"</label>").insertAfter(e(this)),a=!1);var n=parseInt(e(this).data("reward-level")),o=e('input[data-reward-level="'+(n+1)+'"]'),i=0;e('input[data-reward-level="'+n+'"]').each(function(){i+=parseFloat(e(this).val().trim().replace(/,/g,""))});var d=n+1,s=0;return e('input[data-reward-level="'+d+'"]').each(function(){s+=parseFloat(e(this).val().trim().replace(/,/g,""))}),e('td[sum-level="'+n+'"]').text(e.number(i)),!a||(!o.length||(i>s&&(e('<label class="error">'+t+"</label>").insertAfter(e(this)),a=!1),void(a?e('.form-reward-budget [data-block-form-submit="1"]').removeAttr("disabled"):e('.form-reward-budget [data-block-form-submit="1"]').attr("disabled","disabled"))))})}e("body").on("click",".btn-load-note",function(a){a.preventDefault();var r=e(this).find("i");r.removeClass("hidden");var n=e(this).attr("data-week"),o=e(this).closest(".qtip").attr("data-qtip-id"),i=e(this).attr("data-type");t(n,o,i)}),e(window).load(function(){t(),r(),a(),o(),i()}),n(),e(".view-highlight").click(function(t){id=e(this).attr("data-id"),e(".content-highlight").html(e(".highlight-hidden-"+id).html()),e("#show-highlight").modal("show")}),e(".export").click(function(){var t=(e(this).data("url"),e(".export-project-dashboard:checked"));if(t.length){var a="";e(t).each(function(){a+=parseInt(e(this).val())+"-"}),e("#export-member").append('<input type="hidden" name="projectIds" value="'+a+'">'),e("#export-member").submit()}}),e(".export-employees").click(function(){var t=e(this).data("url"),a=e(".export-project-dashboard:checked");if(a.length){var r="";e(a).each(function(){r+=parseInt(e(this).val())+"-"}),t=encodeURI(t+"/"+r),window.open(t)}}),e(".export-project").click(function(){var t=e(".export-project-dashboard:checked"),a=e(".checkAll:checked");if(t.length){var r="";e(t).each(function(){var t=r.indexOf(e(this).val());t!==-1&&0===a.length?"undefined"!=typeof r[t]&&delete r[t]:r+=parseInt(e(this).val())+"-"}),e("#export-project").append('<input type="hidden" name="projectIds" value="'+r+'">')}else e("#export-project").append('<input type="hidden" name="projectIds" value="">');e("#export-project").submit()}),e(".raise-submit").click(function(){var t=e(".export-project-dashboard:checked"),a="";t.length&&e(t).each(function(){a+=e(this).next().attr("data-raise-note")?e(this).next().attr("data-raise-note").trim():"",t.length>1&&a.trim()?(e(".warning-action").attr("data-noti",globalMsg.raiseTwoProject),e(".warning-action").trigger("click")):(e("#modal-raise-note textarea[name=raise-note]").val(a.trim()),e("#title-error").addClass("hidden"),e("#modal-raise-note").modal("show"))})}),e(".export-employees").click(function(){var t=e(".export-project-dashboard:checked");t.length&&e(t).each(function(){t.length>1?(e(".warning-action").attr("data-noti",globalMsg.raiseTwoProject),e(".warning-action").trigger("click")):(e("#title-error").addClass("hidden"),e("#modal-raise-note").modal("show"))})}),e(".submit-raise-note").click(function(){var t=e(".export-project-dashboard:checked"),a=e(this);if(t.length){var r,n={},o={},i=e(".raise-submit").attr("data-url"),d=e("#modal-raise-note textarea[name=raise-note]").val(),s=a.find(".submit-ajax-refresh-btn");if(!d.trim())return void e("#title-error").removeClass("hidden");e(t).each(function(){r=parseInt(e(this).val()),n[r]=r}),s.removeClass("hidden"),o={ids:n,raiseNote:d,_token:siteConfigGlobal.token},e.ajax({url:i,type:"post",dataType:"json",data:o,success:function(t){"undefined"!=typeof t.success&&1==t.success?"undefined"!=typeof t.refresh&&t.refresh&&window.location.reload():("undefined"!=typeof t.message&&t.message&&e(".warning-action").attr("data-noti",t.message),e(".warning-action").trigger("click")),s.addClass("hidden"),a.removeAttr("disabled")},error:function(){s.addClass("hidden"),a.removeAttr("disabled"),e(".warning-action").trigger("click")}})}}),e(".export-project-dashboard").click(function(){e(".export-project-dashboard:checked").length?(e(".export, .raise-submit").removeAttr("disabled"),e(".export, .export-employees").removeAttr("disabled")):(e(".export, .raise-submit").attr("disabled","true"),e(".export, .export-employees").attr("disabled","true"))}),e(document).on("click","#modal-submit-report-warn-confirm .modal-footer .btn-ok",function(){e("#modal-submit-report-warn-confirm").modal("hide"),e("#submit-report").click(),e(".is-report").find(".submit-ajax-refresh-btn").removeClass("hidden")}),e(document).on("click touchstart",".is-report",function(){var t={_token:token,cost_plan_effort_current:e('#cost input[name="cost_plan_effort_current"]').val(),cost_actual_effort:e('#cost input[name="cost_actual_effort"]').val(),qua_leakage_errors:e('#quality input[name="qua_leakage_errors"]').val(),qua_defect_errors:e('#quality input[name="qua_defect_errors"]').val(),tl_schedule:e('#timeliness input[name="tl_schedule"]').val(),css_css:e('#css input[name="css_css"]').val()};e.ajax({url:urlCheckNoteReport,type:"post",dataType:"json",data:t,success:function(t){if(1===t.success)e("#modal-submit-report-warn-confirm").modal("show");else{var a=t.message;e(".warning-action").attr("data-noti",a),e(".warning-action").trigger("click")}},error:function(){var t=globalMessage.errorSystemMsg;e(".warning-action").attr("data-noti",t),e(".warning-action").trigger("click")}})}),e("#modal-submit-report-warn-confirm").on("show.bs.modal",function(){var t,a=e(".is-report");if(a&&a.length&&(t=a.attr("data-noti")),t){e(this).find(".modal-header .modal-title-change").show().html(a.attr("data-title")),e(this).find(".modal-header .modal-title").hide(),e(this).find(".modal-body .text-default").hide().html(t);var r="";e("#form-dashboard-point .pp-input").each(function(){var t=e(this).val(),a=e(this).attr("oldValue"),n=e(this).attr("text-data");t==a&&n&&(r+="<li>"+n+"</li>")}),r?(e(this).find(".modal-body .text-change").show().html(t),e(this).find(".modal-body .ul-wraning").html(r)):e(this).find(".modal-body").hide(),e(this).find(".modal-footer .btn-ok").addClass("submit-report")}});var l={cost_plan_effort_total:parseFloat(e(".cost_plan_effort_total").text().trim()),cost_resource_allocation_total:parseFloat(e(".cost_resource_allocation_total").text().trim())};e(".pp-inputs").change(function(t){return!e("#form-dashboard-point").valid()||(value=e(this).val(),name=e(this).attr("name"),type=e(this).parents(".tab-pane").attr("id"),data={data:{}},data.data[name]=value,data._token=siteConfigGlobal.token,type&&e(".fa-refresh."+type).length&&e(".fa-refresh."+type).removeClass("hidden"),void e.ajax({url:globalPassModule.urlSavePoint,dataType:"json",type:"post",data:data,success:function(t){"undefined"!=typeof t.success&&1==t.success?("undefined"!=typeof t.data&&t.data&&e.each(t.data,function(t,a){e(t).length&&(null===a?e(t).html("&nbsp;"):e(t).text(a))}),"undefined"!=typeof t.input&&t.input&&e.each(t.input,function(t,a){e("input.pp-input[name="+t+"]").length&&e("input.pp-input[name="+t+"]").val(a).attr("data-value",a)}),"undefined"!=typeof t.color&&t.color&&e.each(t.color,function(t,a){e(t+" img").length&&e(t+" img").attr("src",a)}),"undefined"!=typeof t.content_color&&t.content_color&&e.each(t.content_color,function(t,a){if(e(t).length){var r=e(t).closest("tr");r.removeClass("pp-bg-red"),r.removeClass("pp-bg-yellow"),a&&r.addClass(a)}})):("undefined"!=typeof t.message&&t.message&&e(".warning-action").attr("data-noti",t.message),e(".warning-action").trigger("click")),e(".fa-refresh."+type).addClass("hidden")},error:function(){e(".warning-action").trigger("click"),e(".fa-refresh."+type).addClass("hidden")}}))}),e(".note-input").change(function(t){var a=e(this).parents(".tab-pane").attr("id"),r=e(this).attr("name"),n=e(this).val(),o={data:{},baselineId:globalPassModule.baselineId},i=e(this).parent().find(".input-loading");o.data[r]=n,o._token=siteConfigGlobal.token,a&&e(".fa-refresh."+a).length&&e(".fa-refresh."+a).removeClass("hidden"),i.removeClass("hidden"),e.ajax({url:globalPassModule.urlSaveNote,dataType:"json",type:"post",data:o,success:function(t){"undefined"!=typeof t.success&&1==t.success?(e(".fa-refresh."+a).addClass("hidden"),e(".highlight-td").load(location.href+" .highlight-td"),"undefined"!=typeof t.data&&t.data&&e.each(t.data,function(a,r){var n=e(".note-input[name="+a+"]"),o=n.closest(".text-tooltip-wrapper");n.length&&(n.val(RKfuncion.general.parseHtml(r)),o.length&&(t.disableTooltip&&"undefined"!=typeof t.disableTooltip[a]&&t.disableTooltip[a]?o.addClass("tooltip-disable"):o.removeClass("tooltip-disable")))})):(e(".fa-refresh."+a).addClass("hidden"),e(".warning-action").attr("data-noti",t.message),e(".warning-action").trigger("click")),i.addClass("hidden")},error:function(){e(".warning-action").attr("data-noti",o.message),e(".warning-action").trigger("click"),e(".fa-refresh."+a).addClass("hidden"),i.addClass("hidden")}})}),e("form.submit-disable").submit(function(e){e.preventDefault()}),e("#form-dashboard-point").length&&e("#form-dashboard-point").validate({rules:{cost_plan_effort_current:{number:!0,min:0,max:l.cost_plan_effort_total},cost_resource_allocation_current:{number:!0,min:0,max:l.cost_resource_allocation_total},cost_actual_effort:{number:!0,min:0},proc_compliance:{digits:!0,min:0},proc_report_yes:{digits:!0,min:0},proc_report_no:{digits:!0,min:0},proc_report_delayed:{digits:!0,min:0},tl_schedule:{number:!0,min:0},qua_leakage_errors:{digits:!0,min:0},qua_defect_errors:{digits:!0,min:0},qua_defect_reward_errors:{digits:!0,min:0}}}),RKfuncion.formValidateTask(),e("#form-task-comment").length&&(formTaskValid=e("#form-task-comment").validate({rules:{"tc[content]":"required"},messages:{"tc[content]":requiredCmt}})),RKfuncion.keepStatusTab.init(),e(document).on("mouseenter",".text-tooltip-wrapper:not(.tooltip-disable)",function(){var t=e(this).find(".text-display").width();t&&e(this).find(".text-tooltip").width(t),e(this).addClass("open"),e(this).closest(".table-responsive").addClass("disable-responsive")}).on("mouseleave",".text-tooltip-wrapper:not(.tooltip-disable)",function(){e(this).removeClass("open"),e(this).closest(".table-responsive").removeClass("disable-responsive")}),e(document).on("click",".btn-sync-source-server",function(){event.preventDefault();var t=e(this),a=t.data("type"),r=t.data("reload"),n=t.data("process");return!(!n&&a&&"undefined"!=typeof globalPassModule.urlSyncSource)||(t.data("process",1),t.find(".sync-loading").removeClass("hidden"),void e.ajax({url:globalPassModule.urlSyncSource,type:"post",data:{_token:siteConfigGlobal.token,type:a,reload:r},dataType:"json",success:function(a){"undefined"!=typeof a.success&&1==a.success?"undefined"==typeof a.popup||1!=a.popup?("undefined"!=typeof a.message&&a.message&&e(".success-action").attr("data-noti",a.message),e(".success-action").trigger("click"),t.hasClass("sync-parent")&&t.siblings(".sync-child").length&&(t.addClass("hidden"),t.siblings(".sync-child").removeClass("hidden"))):"undefined"!=typeof a.refresh&&a.refresh?window.location.href=a.refresh:window.location.reload():("undefined"!=typeof a.message&&a.message&&e(".warning-action").attr("data-noti",a.message),e(".warning-action").trigger("click")),t.find(".sync-loading").addClass("hidden")},error:function(){e(".warning-action").length||e("body").append('<button class="warning-action hidden"></button>'),e(".warning-action").trigger("click"),t.find(".sync-loading").addClass("hidden")},complete:function(){t.data("process",0)}}))}),RKfuncion.radioToggleClickShow.init(),e(window).load(function(){RKfuncion.select2.elementRemote(e(".select-search-remote-reviewer"))}),e(document).on("click",".btn-change-approver",function(){var t=e(this),a=(t.data("type"),t.closest(".assign-item"));RKfuncion.select2.elementRemote(a.find(".assign-name-select .select-search-remote")),a.find(".assign-name-select").removeClass("hidden"),a.find(".assign-name-old").addClass("hidden"),a.find(".assign-name-save").removeClass("hidden"),t.addClass("hidden"),a.find(".btn-remove").removeClass("hidden")}),e(document).on("click",".btn-remove-approver",function(){var t=e(this),a=t.closest(".assign-item");t.addClass("hidden"),a.find(".assign-name-select").addClass("hidden"),a.find(".assign-name-old").removeClass("hidden"),a.find(".assign-name-save").addClass("hidden"),a.find(".btn-remove").addClass("hidden"),a.find(".btn-change-approver").removeClass("hidden")}),RKfuncion.formSubmitAjax.woChangeApproverSuccess=function(t,a){return"undefined"==typeof a.data||"undefined"==typeof a.data.id||"undefined"==typeof a.data.account||!a.data.id||!a.data.account||(t.find(".assign-name .assign-name-old").text(a.data.name+" ("+a.data.account+")"),void e(".btn-remove-approver").trigger("click"))},RKfuncion.formSubmitAjax.woDeleteReviewerSuccess=function(t,a){"undefined"!=typeof a.data&&("undefined"!=typeof a.data.reviewer_only&&1==a.data.reviewer_only&&t.closest(".wa-item").find(".btn-remove").addClass("hidden"),"undefined"!=typeof a.data.self_remove&&1==a.data.self_remove&&e(".btn-submit-reviewer").remove()),t.closest(".assign-item").remove()},e("body").on("focus",".datepicker",function(t){e(this).datepicker({format:"yyyy-mm-dd",weekStart:1,todayHighlight:!0,autoclose:!0})}),e(".form-control.save-on-changed").on("change",function(t){var a=e(this),r=a.closest(".form-group"),n=a.parent().hasClass("input-group"),o="select"==a.prop("tagName").toLowerCase();a.prop("disabled",!0),a.tooltip("hide");var i=e('<i class="fa fa-refresh fa-spin form-control-feedback"></i>');if(o)i.css("right","25px");else if(n){var d=a.parent().find(".form-control + .input-group-addon");if(d.length>0){var s=d.outerWidth()+15;i.css("right",s+"px")}}r.addClass("has-feedback"),n?i.insertAfter(a.parent()):i.insertAfter(a),setTimeout(function(){a.prop("disabled",!1),i.remove(),r.removeClass("has-feedback"),a.hasClass("no-need-approvement")||a.addClass("changed")},500)}),e(".wo-action-btns-href").length&&e(".wo-action-btns").length&&e(".wo-action-btns").html(e(".wo-action-btns-href").html()),e("#feedback-modal").on("shown.bs.modal",function(){e("#feedback-modal textarea").focus()}),e("#form-wo-change-reviewer").length&&(e("#form-wo-change-reviewer").validate({rules:{"assign[id]":{required:!0}}}),RKfuncion.general.btnSubmitHref()),e("#form-wo-approve-feedback").length&&e("#form-wo-approve-feedback").validate({rules:{"fb[comment]":{required:!0}}}),e("#form-wo-review-feedback").length&&e("#form-wo-review-feedback").validate({rules:{"fb[comment]":{required:!0}}}),d(),e(".btn-submit-reward").click(function(){var t=e(this).data("save");if(e('#form-project-reward input[name="save"] ').val(t),e(".rw-new-employee").length>0){var a=!1;if(e(".rw-new-employee").each(function(){e(this).val()||(a=!0)}),a)return bootbox.alert({className:"modal-danger",message:textTrans.messageRequireEmployee}),!1}}),e(".btn-reward-fill-feeback-confirm").click(function(){e(this).addClass("hidden"),e(".btn-feedback-confirm").removeClass("hidden"),e(".btn-reward-save").removeClass("hidden"),e(".input-reward.input-reward-confirm").removeClass("hidden"),e(".text-reward-confirm").addClass("hidden")}),e(".btn-reward-fill-feeback-approve").click(function(){e(this).addClass("hidden"),e(".btn-feedback-approve").removeClass("hidden"),e(".btn-reward-save").removeClass("hidden"),e(".input-reward.input-reward-approve").removeClass("hidden"),e(".text-reward-approve").addClass("hidden")}),e(".input-number-format").change(function(){try{var t=e.number(e(this).val()),a=e(this).val().trim().replace(/,/g,"");e(this).data("type");a&&e(this).val(t)}catch(r){}}),e("body").on("change","input.input-reward",function(){var t=e.number(e(this).val()),a=e(this).val().trim().replace(/,/g,""),r=e(this).data("type");if(a&&e(this).val(t),r){var n=0;e('input.input-reward[data-type="'+r+'"]').each(function(){var t=(e.number(e(this).val()),e(this).val().trim().replace(/,/g,""));t&&(n+=parseFloat(t))}),e('.reward-total-cal[data-type="'+r+'"]').html(e.number(n)),e('input[name="total['+r+']"]').val(n)}var o=!0;e("#form-project-reward input.input-reward").each(function(){var t=parseFloat(e(this).val().trim().replace(/,/g,""));t<0?(e(this).next(".error").remove(),e('<span class="error">'+varGlobalPassModule.messageValidateRewardMin+"</span>").insertAfter(e(this)),o=!1):e(this).next(".error").remove()}),e("#form-project-reward").valid(),o?e('#form-project-reward [type="submit"]').removeAttr("disabled"):e('#form-project-reward [type="submit"]').attr("disabled","disabled")});var c={};if(e("input.input-reward").each(function(){var t=e(this).data("type"),a=0;return!!c[t]||(c[t]=!0,e('input.input-reward[data-type="'+t+'"]').each(function(){e(this).val()&&(a+=parseFloat(e(this).val().trim().replace(/,/g,"")))}),void e('.reward-total-cal[data-type="'+t+'"]').html(e.number(a)))}),e("#form-project-reward").length){var u={"total[submit]":{required:!0,min:0,max:RKProjectReward.reward.total},"total[confirm]":{required:!0,min:0,max:RKProjectReward.reward.total},"total[approve]":{required:!0,min:0,max:RKProjectReward.reward.total},"fb[comment]":{required:!0}};e("#form-project-reward").validate({rules:u,messages:{"total[submit]":{max:varGlobalPassModule.messageValidateRewardFillTotal,min:varGlobalPassModule.messageValidateRewardMin},"total[confirm]":{max:varGlobalPassModule.messageValidateRewardFillTotal,min:varGlobalPassModule.messageValidateRewardMin},"total[approve]":{max:varGlobalPassModule.messageValidateRewardFillTotal,min:varGlobalPassModule.messageValidateRewardMin}}})}if(s(),RKfuncion.formSubmitAjax.myTaskCallBack=function(t,a){a.taskObject&&(e("#myTask-index .title-myTask-"+a.taskObject.id+" .post-ajax .title-myTask").html(a.taskObject.title),a.taskObject.setColor?e("#myTask-index .title-myTask-"+a.taskObject.id+" .post-ajax .title-myTask").addClass("text-color-red"):e("#myTask-index .title-myTask-"+a.taskObject.id+" .post-ajax .title-myTask").removeClass("text-color-red"),e("#myTask-index .type-myTask-"+a.taskObject.id).html(a.taskObject.type),e("#myTask-index .status-myTask-"+a.taskObject.id).html(a.taskObject.status),e("#myTask-index .priority-myTask-"+a.taskObject.id).html(a.taskObject.priority),e("#myTask-index .duedate-myTask-"+a.taskObject.id).html(a.taskObject.due_date),e("#myTask-index .created-myTask-"+a.taskObject.id).html(a.taskObject.created))},RKfuncion.formSubmitAjax.workoderErrorDate=function(t,a){return a.updateTime?(e("#modal-update-time-confirm .text-default").html(a.messageUpdateTime),void e("#modal-update-time-confirm").modal("show")):("undefined"!=typeof a.message&&a.message&&("undefined"!=typeof a.reload&&1==a.reload?window.location.reload():(e(".warning-action").attr("data-noti",a.message),e(".warning-action").trigger("click"))),!0)},"undefined"!=typeof globalPassModule&&e('select[data-team="dev"]').length){var m,p,f,h=RKfuncion.teamTree.init(globalPassModule.teamPath,globalPassModule.teamSelected);e.each(h,function(e,t){f=t.selected?" selected":"",t.id!=globalPassModule.teamSelected&&(f=""),m+='<option value="'+t.id+'"'+p+f+">"+t.label+"</option>"}),e('select[data-team="dev"]').append(m)}e("body").on("click","#btn-add-reward",function(t){t.preventDefault();var a=e("#table_reward_employees");if(!(a.length<1)){var r=a.find("tbody tr:first").clone(),n=a.find("tbody .reward-total-report").prev("tr"),o=n.attr("data-id");if(e.isNumeric(o))var i=1;else var i=parseInt(n.attr("data-new"))+1;r.attr("data-id","new_"+i).attr("data-new",i);var d=["reward_submit","reward_confirm","reward_approve"];r.find("td").each(function(t,a){var r=e(a).attr("data-col")||null;r&&d.indexOf(r)>-1?(e(a).find("input").val(""),e(a).find(".data-reward-fill").text("")):e(a).text("")}),r.find('[data-col="reward_submit"] input').attr("name","reward[new]["+i+"][submit]").attr("data-id","new_"+i),r.find('[data-col="employee"]').html('<button type="button" class="btn btn-danger btn-sm btn-del-member"><i class="fa fa-trash"></i></button><select class="form-control select-search rw-new-employee" name="reward[new]['+i+'][employee_id]"data-remote-url="'+urlSearchEmployee+'" style="min-width: 150px;"></select>').addClass("col-action"),r.insertAfter(a.find("tbody tr.reward-employee-row:last")),RKfuncion.select2.init({},r.find('[data-col="employee"] .select-search'))}}),e("body").on("click","#table_reward_employees .btn-del-member",function(t){t.preventDefault();var a=e(this);if(!a.is(":disabled")){var r=e(this).closest("tr"),n=r.attr("data-id");e.isNumeric(n)?bootbox.confirm({className:"modal-warning",message:textTrans.messageConfirmDelete,callback:function(t){t&&(a.prop("disabled",!0),r.addClass("bg-warning"),e.ajax({url:urlDelEmpRW,type:"delete",data:{_token:siteConfigGlobal.token,id:n},success:function(t){r.remove(),e(".input-reward:first").trigger("change")},error:function(e){bootbox.alert({className:"modal-danger",message:e.responseJSON})},complete:function(){a.prop("disabled",!1),r.removeClass("bg-warning")}}))}}):r.remove()}})}),function(e){RKfuncion.formSubmitAjax.raiseDestroyAfterSuccess=function(e,t){e.remove()},RKfuncion.formSubmitAjax.loadModalFormSuccess=function(t,a){return e("#modal-ncm-editor .modal-ncm-editor-main").length?(e("#modal-ncm-editor .modal-ncm-editor-main").html(a.htmlModal),a.modalTitle||(a.modalTitle="None Compliance"),e("#modal-ncm-editor .modal-header .modal-title").html(a.modalTitle),void e("#modal-ncm-editor").modal("show")):null},RKfuncion.formValidateTask=function(){return!e("#form-task-edit").length||("undefined"!=typeof e.validator&&"undefined"!=typeof e.validator.addMethod&&(e.validator.addMethod("le",function(t,a,r){return this.optional(a)||t<=e(r).val()},"Please enter a value less than or equal Created date."),e.validator.addMethod("ge",function(t,a,r){return this.optional(a)||t>=e(r).val()},"Please enter a value greater than or equal Created date")),void e("#form-task-edit").validate({rules:{"task[type]":{required:!0},"task_assign[]":{required:!0},"task[title]":{required:!0},"task[duedate]":{required:!0,ge:'input[name^="task[created_at]"'},"task[status]":{required:!0},"task[priority]":{required:!0},"task[content]":{required:!0},"task[created_at]":{required:!0},"task[actual_date]":{ge:'input[name^="task[created_at]"'}},messages:{"task[type]":requiredText,"task_assign[]":requiredText,"task[title]":requiredText,"task[duedate]":{required:requiredText,ge:textGreater},"task[status]":requiredText,"task[priority]":requiredText,"task[content]":requiredText,"task[created_at]":requiredText,"task[actual_date]":{ge:textGreater}}}))}}(jQuery),jQuery(document).ready(function(e){statusHover(".priority-index, .status-index"),e(document).on("click",".priority-index, .status-index",function(){var t=e(this);t.find("i").remove();var a=parseInt(e(this).data("select"));if(a)return!0;var r=t.data("id"),n=!1;if(void 0!=t.attr("data-priority")){var n=!0,o=varGlobalPassModule.routePriority,i=t.data("priority"),d="<select name=task[priority]>";e.each(varGlobalPassModule.priorities,function(e,t){d+='<option value="'+e+'"',e==i&&(d+=" selected"),d+=">"+t+"</option>"}),d+="</select>"}if(void 0!=t.attr("data-status")){
var o=varGlobalPassModule.routeStatus,s=t.data("status"),d="<select name=task[status]>";e.each(varGlobalPassModule.status,function(e,t){d+='<option value="'+e+'"',e==s&&(d+=" selected"),d+=">"+t+"</option>"}),d+="</select>"}t.html(d),t.data("select",1);var r=t.data("id");t.find("select").change(function(){n?(prioritySelect=e(this).val(),statusSelect=null):(statusSelect=e(this).val(),prioritySelect=null),e.ajax({url:o,type:"post",dataType:"json",data:{_token:siteConfigGlobal.token,id:r,priority:prioritySelect,status:statusSelect},success:function(e){1==e.success&&(n?(t.html(e.priority),t.data("priority",e.priority_value)):(t.html(e.status),t.data("status",e.status_value)),t.data("select",0),statusHover(t))}})})});var t=function(t,a){var r=a.attr("data-id");if(!r||e('#reward-comment-box[data-id="'+r+'"]').length||!e(".reward-comment").length)return!0;e("#reward-comment-box .close").trigger("click");var n,o=t.pageX,i=t.pageY,d=e("#reward-comment-box").outerWidth(),s=e(window).width();n=e(".reward-comment #reward-comment-box").clone(),n.attr("data-id",r),n.find("#reward-comments-list").addClass("reward-comments-list-"+r),n.find("#reward-comment-text").addClass("reward-comment-text-"+r),d+o>s&&(o=s-d-10),n.css({left:o+"px",top:i+"px"});var l={_token:siteConfigGlobal.token,id:r};e.ajax({url:urlGetCommentRW,type:"post",data:l,dataType:"json",success:function(e){e=e.trim(),e?(n.find(".cmt-box-list .comments_list").text(e),n.find(".cmt-input").val(e)):n.find(".cmt-btn-edit").trigger("click")}}),e("body").append(n)};e(document).on("click",".cmt-btn-edit",function(t){t.preventDefault();var a=e(this).closest(".cmt-box-wrapper");a.find(".cmt-box-list").addClass("hidden"),a.find(".cmt-box-edit").removeClass("hidden")}),e("body").on("mousedown",".reward-employee-row",function(a){if(window.oncontextmenu=function(){return!1},3===a.which)return t(a,e(this)),!1}),e("body").on("click",".reward_comment_submit",function(t){t.preventDefault();var a=e(this),r=a.closest(".cmt-box-wrapper"),n=r.attr("data-id"),o=r.find(".cmt-input").val().trim(),i={_token:siteConfigGlobal.token,value:o,id:n};a.prop("disabled",!0),e.ajax({url:urlAddCommentRW,type:"post",data:i,dataType:"json",success:function(t){var a=e('.reward-employee-row[data-id="'+n+'"] > td.flag-parent-cmt');a.length&&(o?a.prepend('<span class="flag-has-cmt"></span>'):a.children(".flag-has-cmt").remove()),r.find(".cmt-box-list .comments_list").text(o),r.find(".cmt-box-list").removeClass("hidden"),r.find(".cmt-box-edit").addClass("hidden")},complete:function(){a.prop("disabled",!1)}})}),e('[d-btn-reward="hide-me"]').click(function(t){t.preventDefault(),e(".col-mee").hasClass("hidden")?(e(".col-mee").removeClass("hidden"),e("[data-cel-total-span]").attr("colspan",e("[data-cel-total-span]").data("cel-total-span"))):(e(".col-mee").addClass("hidden"),e("[data-cel-total-span]").attr("colspan",1))});var a={init:function(){if(!e("#modal-reward-number").length)return!0;var t=this;t.initNumber(),t.validate(),t.formatNumber()},initNumber:function(){e("[data-ra-number]").each(function(){var t=e(this).data("ra-number");e('[name="i['+t+']"]').val(e(this).text().trim())})},validate:function(){e("#form-rae").validate({rules:{"i[reward_budget]":{numberFormat:!0,minFormat:0},"i[count_defect]":{numberFormat:!0,minFormat:0},"i[count_defect_pqa]":{numberFormat:!0,minFormat:0},"i[count_leakage]":{numberFormat:!0,minFormat:0}}})},formatNumber:function(){e('[data-input-number="format"]').change(function(t){e(this).val(e.number(e(this).val().replace(/\,/gi,"")))})}};a.init(),e("body").on("click",".close",function(t){e(this).closest("div[data-id]").remove()}),e(document).on("change",".input-cost-productivity-proglang",function(t){var a=e(this),r=a.val(),n=a.attr("id"),o=a.attr("data-id");e.isNumeric(r)||""==r?e("#"+n+"-"+o+"-error").addClass("hidden"):(e("#"+n+"-"+o+"-error").html("input field must be numeric!").show(),e("#"+n+"-"+o+"-error").css("color","red"),e("#"+n+"-"+o+"-error").css("font-size","12px"),e("#"+n+"-"+o+"-error").removeClass("hidden"))}),e(".link-dw-convert").click(function(t){if(t.preventDefault(),!e("#modal-dw-convert").length){var a='<div class="modal fade" id="modal-dw-convert" role="dialog"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button><h4 class="modal-title">Working days</h4></div><div class="modal-body"><div class="row form-group-select2"><div class="col-md-4 margin-bottom-10"><select class="select-search has-search" name="dw[year]" data-dw="year"></select></div><div class="col-md-4 margin-bottom-10"><select class="select-search has-search" name="dw[month]" data-dw="month"></select></div><div class="col-md-4 margin-bottom-10"><p class="form-control-static">Result: <span data-dw="result"></span></p></div></div></div></div></div></div>';e("body").append(a);var n,o,i=new Date,d=i.getFullYear(),s=i.getMonth()+1,l="";for(n=2016;n<d+11;n++)l+='<option value="'+n+'"',n===d&&(l+=" selected"),l+=">"+n+"</option>";for(e('select[data-dw="year"]').append(l),l="",n=1;n<13;n++)o=n<10?"0"+n:n,l+='<option value="'+o+'"',n===s&&(l+=" selected"),l+=">"+o+"</option>";e('select[data-dw="month"]').append(l),RKfuncion.select2.init(),e('select[data-dw="month"], select[data-dw="year"]').change(function(){r()})}e("#modal-dw-convert").modal("show"),r()});var r=function(){var t=e('select[data-dw="year"]').val(),a=e('select[data-dw="month"]').val(),r=e('[data-dw="result"]'),n=0;return r.html(""),!!(!t||!a||isNaN(t)||isNaN(a)||a<1||a>12||4!==t.length)||((n=e.cookie("ck-dw"+t+"-"+a))?(r.html(n),!0):"undefined"==typeof globalPassModule||"undefined"==typeof globalPassModule.urlWorkingDays||void e.ajax({url:globalPassModule.urlWorkingDays,type:"GET",data:{year:t,month:a},dataType:"json",success:function(e){e.days?r.html(e.days):r.html("")}}))},n=function(t){if(!t.id)return t.text;var a=t.element,r=e(a).attr("value");return"undefined"==typeof globalPassModule.reportColorAll[r]?t.text:'<div class="text-center"><img src="'+globalPassModule.reportColorAll[r]+'"/></div>'},o=function(){var t=0;e('[name^="color"]').each(function(a,r){var n=e(r).val();return!!isNaN(n)||(n=parseInt(n),void(n>t&&(t=n)))}),e('[data-report-color="summary"] img').attr("src",globalPassModule.reportColorAll[t])};e('[data-s2-init="report-color"]').length&&(e('[data-s2-init="report-color"]').select2({templateResult:n,templateSelection:n,escapeMarkup:function(e){return e},minimumResultsForSearch:1/0}),e('[data-s2-init="report-color"]').on("select2:select",function(t){var a=e(this),r=t.params.data.id,n=a.closest(".report-color-select");if(n.addClass("hidden"),n.siblings("[data-report-color]").removeClass("hidden"),!globalPassModule.reportColorAll[r])return!0;n.siblings("[data-report-color]").children("img").attr("src",globalPassModule.reportColorAll[r]);var i=a.data("name"),d=e('[name="'+i+'"]');d.val(r),o()}),e("[data-report-color]").dblclick(function(t){if(t.preventDefault(),!globalPassModule.isReportColor||!globalPassModule.isReportSubmitAvai)return!0;var a=e(this).data("report-color"),r=e(this),n=["cost","quality","tl","proc","css","summary"];return n.indexOf(a)<0||(e("[data-report-color]").removeClass("hidden"),e(".report-color-select").addClass("hidden"),void("summary"!==a&&(r.addClass("hidden"),r.siblings(".report-color-select").removeClass("hidden"))))}))}),$(document).on("click",".feedbackchildren_btn, .riskChild_btn",function(){var e=$(this).data("id");$('input[name="parent_id"]').val(e),$('input[name="risk_id"]').val(e)}),$(document).on("click",".edit-comment",function(){var e=/<br\s*[\/]?>/gi,t=$(this).attr("data-content").replace(e,"\n"),a=$(this).data("id");$("#comment").val(t),$("input[name=comment_id]").val(a),$(".text-esc").removeClass("hidden"),$("textarea#comment").focus().css("box-shadow","0px 1px 1px 1px"),$("#button-comment-add").text("Save")}),$(document).on("keyup","#comment",function(e){27===e.keyCode&&($(this).val(""),$("input[name=comment_id]").attr("value",""),$("#button-comment-add").text("Add"),$("#comment").css("box-shadow","none"),$(".text-esc").addClass("hidden"))}),$("#comment").keypress(function(e){10!==e.keyCode&&13!==e.keyCode||""!=$(this).val()||e.preventDefault()}),$(document).on("click",".delete-comment",function(e){e.preventDefault();var t=$(this).data("id"),a=$(this).data("token"),r=$(this).data("url");bootbox.confirm({message:"Are you sure delete comment?",className:"modal-default",buttons:{cancel:{label:"Cancel",className:"pull-left"}},callback:function(e){e&&$.ajax({method:"POST",url:r,data:{id:t,_token:a},success:function(e){var t=jQuery.Event("keypress");t.keyCode=$.ui.keyCode.ENTER,$('input[name="page"]').val(1).trigger(t),$("input[name=comment_id]").attr("value",""),$("#comment").val(""),$("#button-comment-add").text("Add"),$("#comment").css("box-shadow","none"),$(".text-esc").addClass("hidden")}})}})}),$("#form-task-comment").submit(function(e){if(""===$.trim($("#comment").val()))return $("#button-comment-add").removeAttr("disabled"),!1});