function showCalendars(e){e&&(newWindow=window.open("","_blank","width=500,height=500"));var a=$("#modal-calendar-create");a.find(".loader-container").removeClass("hidden"),a.find(".form-calendar").addClass("hidden"),a.find(".error").addClass("hidden"),$(".btn-create-calendar").addClass("hidden"),$(".btn-cancel-create_calendar").addClass("hidden"),$.ajax({url:urlGetFormCalendar,type:"GET",data:{interviewerIds:$("#interviewer").val(),calendarId:calendarId,eventId:eventId,candidateId:$("input[name=candidate_id]").val()},dataType:"json",success:function(n){if(1===parseInt(n.success)){if(a.find(".loader-container").addClass("hidden"),!n.isCreator)return getCalendarErrorHandle(a,errorNotCreatorText),!1;a.find(".form-calendar").removeClass("hidden"),$(".start-date").data("DateTimePicker").date(n.minDate),$(".end-date").data("DateTimePicker").date(n.maxDate),$("#calendar-title").val(n.title),$("#calendar-description").val(n.description),roomSelected=n.roomId,closeWindow(newWindow);var t="";null!==n.interviewers&&n.interviewers.length>0&&$.each(n.interviewers,function(e,a){t+='<option value="'+a.id+'" selected>'+a.email.substring(0,a.email.lastIndexOf("@"))+"</option>"}),$("#calendar-interviewer").html(t),select2Interviewers("#calendar-interviewer"),n.notFound&&($("#modal-calendar-create .alert-warning").removeClass("hidden"),$("#modal-calendar-create .alert-warning .content").html(notFoundEventText)),$(".btn-create-calendar").removeClass("hidden"),$(".btn-cancel-create_calendar").removeClass("hidden"),setTimeout(function(){$("#modal-calendar-create .alert-warning").hasClass("hidden")||$("#modal-calendar-create .alert-warning").addClass("hidden")},3e3)}else e?(newWindow.location.href=n.auth_url,run=!0):getCalendarErrorHandle(a,errorOccurText)},error:function(){getCalendarErrorHandle(a,errorOccurText)}})}function checkRoomAvailable(){var e=$("#modal-calendar-create"),a=e.find(".start-date").val(),n=e.find(".end-date").val(),t=e.find("#calendar-room");return t.html('<option value="0">'+selectMeetingRoomText+"</option>"),!(!a||!n)&&(t.prop("disabled",!0),t.select2(),$(".loading-room").removeClass("hidden"),void(xhr=$.ajax({url:urlCheckRoomAvailable,type:"POST",data:{minDate:a,maxDate:n},dataType:"html",beforeSend:function(){null!==xhr&&xhr.abort()},success:function(e){t.html(e),t.prop("disabled",!1),$(".loading-room").addClass("hidden"),null!=roomSelected&&(t.find('option[value="'+roomSelected+'"]').prop("disabled",!1),t.val(roomSelected)),t.select2({minimumResultsForSearch:-1})},error:function(){}})))}function getCalendarErrorHandle(e,a){e.find(".loader-container").addClass("hidden"),e.find(".error").removeClass("hidden"),e.find(".error h4").html(a),e.find(".btn-cancel-create_calendar").removeClass("hidden"),closeWindow(newWindow)}function closeWindow(e){null!==e&&(e.close(),e=null)}function saveCalendar(e){var a=$(".form-calendar"),n=$(e),t=$(".btn-create-calendar-fake");n.addClass("hidden"),t.removeClass("hidden"),$.ajax({url:urlsaveCalendars,type:"POST",data:{title:a.find("#calendar-title").val(),description:a.find("#calendar-description").val(),startDate:a.find(".start-date").val(),endDate:a.find(".end-date").val(),roomId:a.find("#calendar-room").val(),location:a.find("#calendar-room option:selected").text(),attendeesId:a.find("#calendar-interviewer").val(),candidateId:$("input[name=candidate_id]").val(),calendarId:calendarId,eventId:eventId},dataType:"json",success:function(e){if(1===parseInt(e.success)){var a="";e.interviewers.length>0&&$.each(e.interviewers,function(e,n){a+='<option value="'+n.id+'" selected>'+n.email.substring(0,n.email.lastIndexOf("@"))+"</option>"}),$("#interviewer").html(a),select2Interviewers("#interviewer"),$("#form-interview-candidate").submit()}else $("#modal-calendar-create .alert-warning").removeClass("hidden"),$("#modal-calendar-create .alert-warning .content").html(errorOccurText)},error:function(){},complete:function(){n.removeClass("hidden"),t.addClass("hidden")}})}function isInvalidCalendarForm(){var e=$(".form-calendar"),a=e.find("#calendar-title"),n=e.find(".start-date"),t=e.find(".end-date"),r=e.find("#calendar-room"),d=e.find("#calendar-interviewer"),l=a.val().trim(),i=n.val().trim(),o=t.val().trim(),s=r.val(),c=d.val();return l?removeClassRequired(a):addClassRequired(a),i?removeClassRequired(n):addClassRequired(n),o?removeClassRequired(t):addClassRequired(t),0===parseInt(s)?addClassRequired(r.next(".select2-container")):removeClassRequired(r.next(".select2-container")),c?removeClassRequired(d.next(".select2-container")):addClassRequired(d.next(".select2-container")),!(l&&i&&o&&0!==parseInt(s)&&c)}function addClassRequired(e){e.addClass("input-required")}function removeClassRequired(e){e.removeClass("input-required")}function select2Interviewers(e){$(e).select2({ajax:{url:$(e).data("remote-url"),dataType:"json",delay:250,data:function(e){return{q:e.term,page:e.page}},processResults:function(e,a){return a.page=a.page||1,{results:e.items,pagination:{more:5*a.page<e.total_count}}},cache:!0},placeholder:"Chọn nhân viên",escapeMarkup:function(e){return e},minimumInputLength:3,templateResult:formatRepo,templateSelection:formatRepoSelection,maximumSelectionSize:5})}function formatRepo(e){if(e.loading)return e.text;var a="<div class='select2-result-repository clearfix'><div class='select2-result-repository__avatar' style='float: left;'><img style='border-radius: 50px;width: 50px; height: 50px;' src='"+e.avatar+"' /></div><div class='select2-result-repository__meta select2_text' style='float: left; padding: 17px 10px 17px 10px; font-size: 13px;'><div class='select2-result-repository__title'>"+e.text+"</div></div></div>";return a}function formatRepoSelection(e){return e.text}$("#modal-calendar-create .start-date").datetimepicker({format:"YYYY-MM-DD H:mm"}).on("dp.change",function(){jQuery(this).val()?$(".end-date").data("DateTimePicker").minDate(jQuery(this).val()):$(".end-date").data("DateTimePicker").minDate("2000-01-01"),checkRoomAvailable()}),$("#modal-calendar-create .end-date").datetimepicker({format:"YYYY-MM-DD H:mm"}).on("dp.change",function(){jQuery(this).val()?$(".start-date").data("DateTimePicker").maxDate(jQuery(this).val()):$(".start-date").data("DateTimePicker").maxDate("2099-01-01"),checkRoomAvailable()});var newWindow=null,auth_url=null,run=!1,roomSelected=null;$("#modal-calendar-create .start-date, #modal-calendar-create .end-date");var xhr=null;setInterval(function(){run&&null!=newWindow&&newWindow.closed&&(showCalendars(),newWindow=null,run=!1)},1e3),setInterval(function(){$(".btn-create-calendar").prop("disabled",isInvalidCalendarForm())},200);