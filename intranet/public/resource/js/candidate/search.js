function exportSearchCandidates(e){var t=XLSX.utils.book_new(),a=e.sheetsData,n=e.colsHead;for(var i in a){for(var r=a[i],o=XLSX.utils.json_to_sheet(r),l=XLSX.utils.decode_range(o["!ref"]),d=l.s.c;d<=l.e.c;++d){var c=XLSX.utils.encode_col(d)+"1";if("undefined"!=typeof o[c]){var s=o[c];s.v=n[s.v].tt,o[c]=s}}o["!ref"]=XLSX.utils.encode_range(l);var h=[];for(var f in n)h.push({wch:n[f].wch});o["!cols"]=h,$.each(o,function(e,t){t.s={alignment:{wrapText:1}},o[e]=t}),XLSX.utils.book_append_sheet(t,o,i)}var u=e.fileName+".xlsx",m=XLSX.write(t,{bookType:"xlsx",bookSST:!0,type:"binary"});try{saveAs(new Blob([s2ab(m)],{type:"application/octet-stream"}),u)}catch(p){return void console.log(p)}}function s2ab(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),n=0;n!==e.length;++n)a[n]=255&e.charCodeAt(n);return t}for(var t=[],n=0;n!==e.length;++n)t[n]=255&e.charCodeAt(n);return t}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")}});var table=null;jQuery(document).ready(function(){$(".date").datepicker({todayBtn:"linked",language:"it",autoclose:!0,todayHighlight:!0,format:"yyyy-mm-dd"}),selectSearchReload(),$(".filter-choice").select2(),$(".column-choice").select2(),$(".column-choice").parent().find(".select2-container li[title=Id] .select2-selection__choice__remove").remove(),$(".column-choice").on("change",function(){$(".column-choice").parent().find(".select2-container li[title=Id] .select2-selection__choice__remove").remove()}),RKfuncion.select2.elementRemote($("#request")),RKfuncion.select2.elementRemote($("#created_by")),RKfuncion.select2.elementRemote($("#interviewer")),RKfuncion.select2.elementRemote($("#presenter_id")),RKfuncion.select2.elementRemote($("#found_by")),$("button.filter").on("click",function(){var e=$(this),t=e.attr("data-type"),a="undefined"!=typeof t&&"export"==t;if(!a){null!=table&&(table.destroy(),$("#search-advance tbody").empty());var n=$("#test_mark").val();if(n.indexOf("/")==-1)""==n&&$("#test_mark").val(0);else{var i=n.split("/");""!=i[0]&&"undefined"!=typeof i[1]&&""!=i[1]||$("#test_mark").val(0)}}var r={};$(".filter-box .form-group ").not(".hidden").find(".filter-item").each(function(){var e=null==$(this).val()?"":$(this).val(),t=$(this).data("field"),a=$('.compare-item[data-field="'+t+'"] .compare-list').val(),n=$(this).data("jointable"),i=$(this).data("joinfield"),o=$(this).data("jointofield"),l=$(this).data("except"),d=$('.extra-item[data-field="'+t+'"]').val(),c=$('.extra-item[data-field="'+t+'"]').data("field-extra");r[t]={value:e.trim(),compare:a,joinTable:n,joinField:i,joinToField:o,except:l,extra:d,fieldExtra:c}});var o=$(".column-choice").val(),l=[{data:"id",name:"id"}],d=["candidates.id"],c="<th>Id</th>";if($.each(o,function(e,t){l.push({data:t,name:t});var a=$(".column-choice option[value="+t+"]").text();c+="<th>"+a+"</th>";var n=$(".column-choice option[value="+t+"]").data("field");d.push(n)}),a){if(e.is(":disabled"))return;$("button.filter").prop("disabled",!0),e.find(".fa-refresh").removeClass("hidden");var s=$("#search-advance thead tr th.sorting_asc"),h=$("#search-advance thead tr th.sorting_desc"),f=s.length>0?s:h.length>0?h:null,u=f?f.attr("aria-sort"):"asc";return $.ajax({type:"POST",url:urlAdvanceSearch,data:{filter:r,columnsField:d,type:t,order:[f?f.index():0,"ascending"==u?"asc":"desc"]},success:function(e){return exportSearchCandidates(e)},error:function(){alert("Something went wrong!")},complete:function(){$("button.filter").prop("disabled",!1),e.find(".fa-refresh").addClass("hidden")}}),!0}c+="<th></th>",$("#search-advance thead tr").html(c),l.push({data:"",name:"",orderable:!1,searchable:!1}),table=$("#search-advance").DataTable({processing:!0,lengthChange:!1,bFilter:!1,serverSide:!0,pageLength:20,oLanguage:dataLang,ajax:{url:urlAdvanceSearch,data:{filter:r,columnsField:d,type:t},type:"post"},order:[[0,"desc"]],columns:l,preDrawCallback:function(){$("button.filter").prop("disabled",!0),e.find(".fa-refresh").removeClass("hidden")},drawCallback:function(t){$("button.filter").prop("disabled",!1),e.find(".fa-refresh").addClass("hidden")}})}),$(".filter-item").on("keyup",function(e){13==e.keyCode&&$("button.filter").trigger("click")}),$(document).on("change","#language",function(){var e=$(this).val(),t=$(".lang-level");t.addClass("hidden"),t.find("option:gt(0)").remove(),"undefined"!=typeof langArray[e]&&(t.removeClass("hidden"),$.each(langArray[e],function(e,a){t.append("<option value='"+e+"'>"+a+"</option>")}))}),$(document).on("change",".filter-choice",function(){var e=$(this).val();$(".filter-box .form-group").not(".select-columns").addClass("hidden"),$.each(e,function(e,t){$(".filter-box .form-group").has($("#"+t)).removeClass("hidden")}),$(".filter-box .form-group.hidden").each(function(){$(this).find("input").val(""),$(this).find("select").find("option:eq(0)").prop("selected",!0),$(this).find("select").trigger("change"),$(this).find("#request").html(""),$(this).find("#created_by").html(""),$(this).find("#interviewer").html(""),$(this).find("#presenter_id").html(""),$(this).find("#found_by").html("")})}),$(document).on("change",'.compare-item[data-field="test_mark"] .compare-list',function(){var e=$(this).val();e==nullCompareValue||e==notNullCompareValue?$("#test_mark").hide():$("#test_mark").show()}),$(document).on("change",".compare-item .compare-list",function(){var e=$(this).val(),t=$(this).closest(".form-group").find(".filter-item"),a=$(this).closest(".compare-item").data("field");e==nullCompareValue||e==notNullCompareValue?(t.hide(),t.parent().find(".select2-container").hide(),"language"==a&&$(".lang-level").hide()):(t.show(),t.parent().find(".select2-container").show(),"language"==a&&$(".lang-level").show())})});