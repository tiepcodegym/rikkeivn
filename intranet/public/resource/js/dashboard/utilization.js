function showDetail(t,e,a,o){var n=$(a).data("empid"),i=$(a).data("empname"),r=$(a).data("leave"),s=$(a).data("join");$(".apply-click-modal").show(),$.ajax({url:urlDetail,type:"post",dataType:"HTML",data:{week:t,year:e,empId:n,empName:i,leaveDate:r,joinDate:s,viewMode:o},success:function(t){$("#modal-days").modal("show"),$("#modal-days .modal-body").html(t),fixLeftColWeekDetail()},error:function(){alert("ajax fail to fetch data")},complete:function(){$(".apply-click-modal").hide()}})}function setEffort(){$("table.effortTable td.effort-container ").each(function(){var t=0;$(this).find(".effort").each(function(){var e=$.trim($(this).text());e=e.substring(0,e.length-1),t+=parseFloat(e)}),isNaN(t)||$(this).prepend("<div><span class='total-effort'>"+rounding(t,2)+"</span>%</div>"),setBg($(this),t),0==t||isNaN(t)?(0==t&&$(this).html("<div><span class='total-effort'>0</span>%</div>"),$(this).removeAttr("onclick"),$(this).css("cursor","auto")):$(this).find(".effort").each(function(){var t=$.trim($(this).text());t=t.substring(0,t.length-1)});var e=0,a=[],o=[];$(this).find(".pj-info").each(function(){$(this).attr("row",e);var t=$(this).attr("data-id");if($.inArray(t,a)==-1)a.push(t),o[t]=e;else{var n=$(this).find(".effort").text();n=n.substring(0,n.length-1);var i=o[t],r=$(this).parent(".effort-container").find(".pj-info[data-id="+t+"][row="+i+"] .effort"),s=r.text();s=s.substring(0,s.length-1),s=parseFloat(s)+parseFloat(n),r.text(rounding(s)+"%",2),$(this).next("br").remove(),$(this).remove()}e++}),$(this).find(".pj-info").each(function(){$(this).closest("td").find(".tooltip").append("<p>"+$(this).find(".effort").text()+" "+$(this).find(".pj-name").text()+"</p>")})})}function setAverage(){$("tr.result td.average-effort").each(function(){var t=0,e=$(this).data("child"),a=0;$("td[data-child="+e+"]").each(function(){$(this).find(".total-effort").each(function(){a++;var e=$.trim($(this).text());t+=parseFloat(e)})});var o=$("tr.result td[data-child="+e+"]"),n=$("tr.result-total td[data-child="+e+"]"),i=rounding(t/a,2),t=rounding(t,2);o.html(i+"%"),n.html(t+"%"),setBg(o,i)})}function setBg(t,e){0==e?t.css("background",bgWhite):e<=effortGreenMin&&e>0?t.css("background",bgYellow):e>effortGreenMin&&e<=effortGreenMax?t.css("background",bgGreen):e>effortGreenMax&&t.css("background",bgRed)}function fixLeftCol(){var t=$(".effortTable thead").height();$(".accountTable thead tr").height(t),$(".accountTable tbody tr").each(function(){var t=$(this).attr("row"),e=$(this).height(),a=$(".effortTable tbody tr[row="+t+"]").height();a>e?($(this).height(rounding(a,0)),$(".effortTable tbody tr[row="+t+"]").height(rounding(a,0))):($(this).height(rounding(e,0)),$(".effortTable tbody tr[row="+t+"]").height(rounding(e,0)))})}function fixLeftColWeekDetail(){var t=$(".tbl-effort thead").height();$(".tbl-proj-name thead tr").height(t),$(".tbl-effort tbody tr").each(function(){var t=$(this).attr("row"),e=$(this).height(),a=$(".tbl-proj-name tbody tr[row="+t+"]").height();a>e?($(this).height(rounding(a,0)),$(".tbl-proj-name tbody tr[row="+t+"]").height(rounding(a,0))):($(this).height(rounding(e,0)),$(".tbl-proj-name tbody tr[row="+t+"]").height(rounding(e,0)))})}function loadData(t){null!=xhr&&xhr.abort();var e=$("#proj_filter").val(),a=$("#status_filter").val(),o=$("#program").val();$("#team_id").length>0?teamId=$("#team_id").val():teamId="",$("#emp_id").val()?(empId=$("#emp_id").val(),empText=$("#employee-autocomplete").val().trim()):(empId="",empText="");var n=$("#start-month").val(),i=$("#end-month").val(),r=$("select[name=limit] option:selected").data("value"),s=$buttonFilter.find(".fa-refresh");s.removeClass("hidden");var d=$(".table-data-container"),l=$(".loader-container"),c=$(".loader");l.removeClass("hidden"),c.removeClass("hidden"),$("html, body").animate({scrollTop:$("body").offset().top},"slow"),xhr=$.ajax({url:urlFilter,type:"post",dataType:"html",timeout:3e4,data:{_token:token,projId:e,projStatus:a,programs:o,teamId:teamId,startDate:n,endDate:i,empId:empId,empText:empText,limit:r,page:t,viewMode:$(".btn-viewmode").find(".btn[data-selected=true]").data("value"),effort:$("#effort_filter").val()},beforeSend:function(){},success:function(e){d.html(e),setEffort(),setAverage(),fixLeftCol(),$buttonLast.find("a").attr("data-page",totalPage),$inputPager.val(t);var a=parseInt(t)+1,o=parseInt(t)-1;$buttonPrev.removeClass("disabled"),$buttonNext.removeClass("disabled"),$buttonLast.removeClass("disabled"),$buttonFirst.removeClass("disabled"),$buttonNext.find("a").attr("data-page",a),$buttonPrev.find("a").attr("data-page",o),totalPage<a&&$buttonNext.addClass("disabled"),0==o&&$buttonPrev.addClass("disabled"),1==t&&$buttonFirst.addClass("disabled"),t==totalPage&&$buttonLast.addClass("disabled"),$(".data-pager-info span").html(pagerInfo),setHeightBody(".content-wrapper",50)},error:function(t,e,a){"timeout"==e&&alert("got timeout")},complete:function(){s.addClass("hidden"),l.addClass("hidden"),c.addClass("hidden")}})}function setHeightBody(t,e){$(t).css("min-height",$(window).height()-$(".main-footer").outerHeight()-e)}function over(t){var e=$(t).offset(),a=$(".bottom-height").offset().top,o=a-e.top,n=$(t).find(".tooltip"),i=n.height();i>o?n.css({bottom:o-120,left:e.left,display:"block"}):n.css({left:e.left,display:"block"})}function out(t){$(t).find(".tooltip").css({display:"none"})}function changeLabelSelected(){var t=$(".team-select-box option:selected");if(1===t.length){var e=$.trim(t.text());$(".team-select-box .multiselect-selected-text").text(e)}}function changeTitle(){var t="";$(".team-select-box option:selected").each(function(){t+=", "+$.trim($(this).text())}),","===t.charAt(0)&&(t=t.slice(2)),$(".team-select-box .multiselect").prop("title",t)}$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="_token"]').attr("content")}});var token=$('meta[name="csrf-token"]').attr("content"),$startMonth=$("#start-month"),$endMonth=$("#end-month"),$buttonNext=$(".paginate_button.next"),$buttonPrev=$(".paginate_button.previous"),$buttonLast=$(".paginate_button.lastpage-page"),$buttonFirst=$(".paginate_button.first-page"),$inputPager=$("input[name=page]"),$buttonReset=$(".btn-reset"),$buttonFilter=$(".btn-filter");$(document).ready(function(){$buttonNext.find("a").attr("href","javascript:void(0)"),$buttonPrev.find("a").attr("href","javascript:void(0)"),$buttonLast.find("a").attr("href","javascript:void(0)"),$buttonFirst.find("a").attr("href","javascript:void(0)"),$inputPager.parent().removeClass("form-pager"),$startMonth.datepicker({format:"yyyy-mm-dd",autoclose:!0,endDate:$endMonth.val(),weekStart:1,calendarWeeks:!0}).on("changeDate",function(){$endMonth.datepicker("setStartDate",$startMonth.val()),loadData(1)}),$endMonth.datepicker({format:"yyyy-mm-dd",autoclose:!0,startDate:$startMonth.val(),weekStart:1,calendarWeeks:!0}).on("changeDate",function(){$startMonth.datepicker("setEndDate",$endMonth.val()),loadData(1)}),setEffort(),setAverage(),fixLeftCol(),$("#program").multiselect(),selectSearchReload(),$("#proj_filter").select2()}),jQuery(window).resize(function(){fixLeftCol()}),$(window).load(function(){$(".se-pre-con").fadeOut("slow")});var xhr=null;$buttonFilter.on("click",function(t){loadData(1)}),$("select[name=limit]").on("change",function(t){t.stopPropagation(),$buttonFilter.trigger("click")}),$buttonNext.on("click",function(t){t.stopPropagation();var e=$(this).find("a").attr("data-page");parseInt(e)<=parseInt(totalPage)&&loadData(e)}),$buttonPrev.on("click",function(t){t.stopPropagation();var e=$(this).find("a").attr("data-page");parseInt(e)>0&&loadData(e)}),$buttonLast.on("click",function(t){t.stopPropagation();var e=$(this).find("a").attr("data-page"),a=$buttonNext.find("a").attr("data-page");parseInt(e)>=parseInt(a)&&loadData(e)}),$buttonFirst.on("click",function(t){t.stopPropagation();var e=$(this).find("a").attr("data-page"),a=$buttonPrev.find("a").attr("data-page");parseInt(e)<=parseInt(a)&&loadData(e)}),$inputPager.on("keyup",function(t){if(t.stopPropagation(),13==t.keyCode){var e=$(this).val().trim();(parseInt(e)>parseInt(totalPage)||parseInt(e)<1)&&(e=1),loadData(e)}}),$buttonReset.on("click",function(t){t.stopPropagation(),$("#proj_filter").select2("val","0"),$("#status_filter").select2("val","0"),$("#emp_id").val(""),$("#employee-autocomplete").val(""),$("#program option:selected").prop("selected",!1),$("#program").multiselect("refresh"),$("#team_id option:selected").prop("selected",!1),$("#team_id").multiselect("refresh"),$("#start-month").datepicker("setDate",new Date(startDefault)),$("#end-month").datepicker("setDate",new Date(endDefault)),$(".btn-viewmode .btn").attr("data-selected","false").removeClass("bg-aqua"),$(".btn-viewmode .btn[data-value=week]").attr("data-selected","true").addClass("bg-aqua"),$("#effort_filter").select2("val","0");var e=1;loadData(e)}),$("#proj_filter, #status_filter, #effort_filter").change(function(){loadData(1)}),$("#employee-autocomplete").autocomplete({source:function(t,e){$.ajax({url:urlSearchEmp,dataType:"json",data:{email:$("#employee-autocomplete").val()},success:function(t){e(t)}})},minLength:3,select:function(t,e){$("#emp_id").val(parseInt(e.item.data)),$("#employee-autocomplete").val(e.item.value),loadData(1)},focus:function(t,e){$("#emp_id").val(e.item.data)}}),$("#employee-autocomplete").bind("keyup",function(t){var e=t.keyCode||t.which;38!=e&&40!=e&&13!=e&&$("#emp_id").val($(this).val().trim()),13==e&&($(this).blur(),loadData(1))}),$(".btn-viewmode .btn").on("click",function(){$(this).parent().find(".btn").removeClass("bg-aqua"),$(this).parent().find(".btn").attr("data-selected","false"),$(this).addClass("bg-aqua"),$(this).attr("data-selected","true"),loadData(1)}),$(document).on("mouseup","li.checkbox-item",function(){var t=$(this).find("input"),e=t.val(),a=!t.is(":checked");if(teamPath[e]&&"undefined"!=typeof teamPath[e].child){var o=teamPath[e].child;$("li.checkbox-item input").map(function(t,e){o.indexOf(parseInt($(e).val()))!==-1&&$(e).is(":checked")===!a&&$(e).click()})}setTimeout(function(){changeLabelSelected(),changeTitle()},0)}),$(document).ready(function(){changeLabelSelected()});