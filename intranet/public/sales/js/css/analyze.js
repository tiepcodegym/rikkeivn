function filterAnalyze(t){$(".ketquaapply").hide(),$("#danhsachduan tbody").html(""),$("#duoi3sao tbody").html("");var e=$("input[name=tieuchi]:checked").attr("id"),a="";$("input[type=checkbox][name=project_type]:checked").each(function(){""==a?a=$(this).val():a+=","+$(this).val()});var i="";if($("input[class=team-tree-checkbox]:checked").each(function(){""==i?i=$(this).attr("data-id"):i+=","+$(this).attr("data-id")}),""==a)return""==i?($("#modal-warning").modal("show"),$("#modal-warning .modal-body").html(reProjectAndTeam)):($("#modal-warning").modal("show"),$("#modal-warning .modal-body").html(reTypeProject)),!1;if(""==i)return $("#modal-warning").modal("show"),$("#modal-warning .modal-body").html(reTeam),!1;var s=$("#start_date").val(),o=$("#end_date").val();$(".apply-click-modal").show(),$.ajax({url:baseUrl+"/css/filter_analyze",type:"post",data:{_token:t,startDate:s,endDate:o,projectTypeIds:a,teamIds:i,criteriaType:e}}).done(function(t){$(".btn-apply").show(),$(".apply-click-modal").hide(),$("div.theotieuchi").html(t),$(".tbl-criteria").hide(),$(".no-result").hide(),$(".no-result-"+e).show(),$(document).trigger("icheck"),$("#startDate_val").val(s),$("#endDate_val").val(o),$("#teamIds_val").val(i),$("#projectTypeIds_val").val(a);var n=$("table[data-id="+e+"] tbody");n.parent().show(),fixScroll(n)}).fail(function(){alert("Ajax failed to fetch data")})}function fixScroll(t){if("undefined"!=typeof t.get(0)){var e=t.height(),a=t.get(0).scrollHeight;msieversion()&&(a-=1),a>e?(t.parent().find("thead tr th:nth-child(3)").css("margin-left","-10px"),isMobile()?t.parent().find("thead tr th:last-child").css("margin-left","10px"):msieversion()&&"tcQuestion"==t.parent().data("id")?t.parent().find("thead tr th:last-child").css("margin-left","-7px"):t.parent().find("thead tr th:last-child").css("margin-left","-4px")):(t.parent().find("thead tr th:nth-child(3)").css("margin-left","0"),t.parent().find("thead tr th:last-child").css("margin-left","0"))}}function msieversion(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");return!!(e>0||navigator.userAgent.match(/Trident.*rv\:11\./))}function apply(t){var e=$("input[name=tieuchi]:checked").attr("id"),a="",i=getCriteriaChecked();if($("input[class="+i+"]:checked").each(function(){""==a?"checkQuestionItem"==i?$(this).attr("data-questionid")&&(a=$(this).attr("data-questionid")):a=$(this).attr("data-id"):"checkQuestionItem"==i?$(this).attr("data-questionid")&&(a+=","+$(this).attr("data-questionid")):a+=","+$(this).attr("data-id")}),""==a)return $("#modal-warning").modal("show"),$("#modal-warning .modal-body").html(reCriteria),!1;var s=$("#teamIds_val").val(),o=$("#projectTypeIds_val").val(),n=$("#startDate_val").val(),c=$("#endDate_val").val();$(".apply-click-modal").show(),$.ajax({url:baseUrl+"/css/apply_analyze",type:"post",data:{_token:t,startDate:n,endDate:c,criteriaIds:a,teamIds:s,projectTypeIds:o,criteriaType:e}}).done(function(t){$("#criteriaIds_val").val(a),$("#criteriaType_val").val(e),$(".apply-click-modal").hide(),$(".ketquaapply").show(),"tcQuestion"==e?($(".box-select-question").show(),$(".box-select-question #question-choose").html(t.htmlQuestionList),removeEmptyCate()):("tcTeam"==e?$("#danhsachduan .filter-input-grid input[name=name]").hide():$("#danhsachduan .filter-input-grid input[name=name]").show(),$(".box-select-question").hide(),$(".box-select-question #question-choose").html("")),$("html, body").animate({scrollTop:$(".ketquaapply").offset().top},100);for(var i=t.cssResultPaginate.cssResultdata.data.length,s="",o=0;o<i;o++)s+="<tr>",s+="<td class='text-align-center'>"+t.cssResultPaginate.cssResultdata.data[o].id+"</td>",s+='<td class="font-japan">'+t.cssResultPaginate.cssResultdata.data[o].project_name+"</td>",s+="<td>"+t.cssResultPaginate.cssResultdata.data[o].teamName+"</td>",s+="<td>"+t.cssResultPaginate.cssResultdata.data[o].pmName+"</td>",s+="<td class='text-align-center'>"+t.cssResultPaginate.cssResultdata.data[o].css_end_date+"</td>",s+="<td class='text-align-center'>"+t.cssResultPaginate.cssResultdata.data[o].css_result_created_at+"</td>",s+="<td class='text-align-center'>"+t.cssResultPaginate.cssResultdata.data[o].point+"</td>",s+="</tr>";$("#danhsachduan tbody").html(s),$("#danhsachduan").parent().find(".pagination").html(t.cssResultPaginate.paginationRender);var n=[],c=[];$.each(t.allResultChart,function(t,e){c.push([new Date(e.date),e.point])}),n.push({label:"Điểm CSS",lines:{show:!0},points:{show:!0},data:c});var d,r;d={legend:{container:$("#legend-container-all")},grid:{hoverable:!0,borderColor:"#ccc"},xaxis:{mode:"time",timeformat:"%d/%m/%y"}},r=$.plot($("#chartAll"),n,d),$("#chartAll").bind("plothover",function(t,e,a){if($("#tooltip").remove(),a){var i=a.datapoint[0],s=a.datapoint[1].toFixed(2),o=$.datepicker.formatDate("dd/mm/yy",new Date(i));showTooltip(a.pageX,a.pageY,o+" : "+s+" điểm")}});var l=[];$.each(t.compareChart,function(t,e){var a=[];$.each(e.data,function(t,e){a.push([new Date(e.date).getTime(),e.point])}),l.push({label:e.name,lines:{show:!0},points:{show:!0},data:a})});var h=5;if($(window).width()<500&&(h=3),d={legend:{position:"ne",container:$("#legend-container"),noColumns:h},grid:{hoverable:!0,borderColor:"#ccc"},xaxis:{mode:"time",timeformat:"%d/%m/%y"}},r=$.plot("#chartFilter",l,d),$("#chartFilter").bind("plothover",function(t,e,a){if($("#tooltip").remove(),a){var i=a.datapoint[0],s=a.datapoint[1].toFixed(2),o=$.datepicker.formatDate("dd/mm/yy",new Date(i));showTooltip(a.pageX,a.pageY,o+" : "+s+" điểm")}}),$("#chartPoint").remove(),$(".chartPoint").append('<canvas id="chartPoint"></canvas>'),newChart($("#chartPoint"),t.piechartPoint,t.piechartLabel,"doughnut"),"tcQuestion"!=e){var i=t.lessThreeStar.cssResultdata.length;if(s="",i>0){for(var o=0;o<i;o++)s+="<tr>",s+="<td class='text-align-center'>"+t.lessThreeStar.cssResultdata[o].no+"</td>",s+='<td class="font-japan">'+t.lessThreeStar.cssResultdata[o].projectName+"</td>",s+='<td class="font-japan">'+t.lessThreeStar.cssResultdata[o].questionName+"</td>",s+="<td class='text-align-center'>"+t.lessThreeStar.cssResultdata[o].stars+"</td>",s+="<td>"+t.lessThreeStar.cssResultdata[o].comment+"</td>",s+="<td class='text-align-center'>"+t.lessThreeStar.cssResultdata[o].makeDateCss+"</td>",s+="<td class='text-align-center'>"+t.lessThreeStar.cssResultdata[o].cssPoint+"</td>",s+="</tr>";$("#duoi3sao tbody").html(s),$("#duoi3sao").parent().find(".pagination").html(t.lessThreeStar.paginationRender)}else $("#duoi3sao tbody").html(noResult),$("#duoi3sao").parent().find(".pagination").html("");if(i=t.proposes.cssResultdata.length,s="",i>0){for(var o=0;o<i;o++)s+="<tr>",s+="<td class='text-align-center'>"+t.proposes.cssResultdata[o].no+"</td>",s+='<td class="font-japan">'+t.proposes.cssResultdata[o].projectName+"</td>",s+='<td class="font-japan">'+t.proposes.cssResultdata[o].customerComment+"</td>",s+="<td class='text-align-center'>"+t.proposes.cssResultdata[o].makeDateCss+"</td>",s+="<td class='text-align-center'>"+t.proposes.cssResultdata[o].cssPoint+"</td>",s+="</tr>";$("#danhsachdexuat tbody").html(s),$("#danhsachdexuat").parent().find(".pagination").html(t.proposes.paginationRender)}else $("#danhsachdexuat").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(noResult);$("#duoi3sao thead th").attr("data-type","all"),$("#danhsachdexuat thead th").attr("data-type","all")}else $("#duoi3sao tbody").html(""),$("#duoi3sao").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(""),$("#danhsachdexuat").parent().find(".pagination").html(""),$("#duoi3sao thead th").attr("data-type","question"),$("#danhsachdexuat thead th").attr("data-type","question");$("#cssResultIds").val(t.strResultIds)}).fail(function(){alert("Ajax failed to fetch data")})}function showTooltip(t,e,a){$('<div id="tooltip">'+a+"</div>").css({position:"absolute",display:"none",top:e-25,left:t-60,border:"1px solid #fdd",padding:"2px","background-color":"#fee",opacity:.8}).appendTo("body").fadeIn(200)}function isMobile(){var t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(t=!0),t}function getCriteriaChecked(){var t=$("input[name=tieuchi]:checked").attr("id");return"tcProjectType"==t?"checkProjectTypeItem":"tcProjectName"==t?"checkProjectNameItem":"tcTeam"==t?"checkTeamItem":"tcPm"==t?"checkPmItem":"tcBrse"==t?"checkBrseItem":"tcCustomer"==t?"checkCustomerItem":"tcSale"==t?"checkSaleItem":"tcQuestion"==t?"checkQuestionItem":void 0}function getListLessThreeStarByQuestion(t,e,a,i,s,o){$("#duoi3sao tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_list_less_three_star_question/"+t+"/"+i+"/"+e+"/"+s+"/"+o,type:"post",data:{_token:a}}).done(function(t){var e=t.cssResultdata.length;if(html="",e>0){for(var a=0;a<e;a++)html+="<tr>",html+="<td class='text-align-center'>"+t.cssResultdata[a].no+"</td>",html+='<td class="font-japan">'+t.cssResultdata[a].projectName+"</td>",html+='<td class="font-japan">'+t.cssResultdata[a].questionName+"</td>",html+="<td class='text-align-center'>"+t.cssResultdata[a].stars+"</td>",html+="<td>"+t.cssResultdata[a].comment+"</td>",html+="<td class='text-align-center'>"+t.cssResultdata[a].makeDateCss+"</td>",html+="<td class='text-align-center'>"+t.cssResultdata[a].cssPoint+"</td>",html+="</tr>";$("#duoi3sao tbody").html(html),$("#duoi3sao").parent().find(".pagination").html(t.paginationRender)}else $("#duoi3sao tbody").html(noResult),$("#duoi3sao").parent().find(".pagination").html("")}).fail(function(){alert("Ajax failed to fetch data")})}function getProposesQuestion(t,e,a,i,s,o){$("#danhsachdexuat tbody").html(strLoading),$.ajax({url:baseUrl+"css/get_proposes_question/"+t+"/"+i+"/"+e+"/"+s+"/"+o,type:"post",data:{_token:a}}).done(function(t){var e=t.cssResultdata.length;if(html="",e>0){for(var a=0;a<e;a++)html+="<tr>",html+="<td class='text-align-center'>"+t.cssResultdata[a].no+"</td>",html+='<td class="font-japan">'+t.cssResultdata[a].projectName+"</td>",html+='<td class="font-japan">'+t.cssResultdata[a].customerComment+"</td>",html+="<td class='text-align-center'>"+t.cssResultdata[a].makeDateCss+"</td>",html+="<td class='text-align-center'>"+t.cssResultdata[a].cssPoint+"</td>",html+="</tr>";$("#danhsachdexuat tbody").html(html),$("#danhsachdexuat").parent().find(".pagination").html(t.paginationRender)}else $("#danhsachdexuat tbody").html(noResult),$("#danhsachdexuat").parent().find(".pagination").html("")}).fail(function(){alert("Ajax failed to fetch data")})}function removeEmptyCate(){var t=[],e=[];$("#question-choose option[data-type=question]").each(function(){t.push($(this).attr("parent-id"))}),$("#question-choose option[class=parent]").each(function(){if(jQuery.inArray($(this).attr("data-id"),t)!==-1){e.push($(this).attr("data-id"));var a=$(this).attr("parent-id");if($("#question-choose option[class=parent][data-id="+a+"]").length>0){e.push($(this).attr("parent-id"));var i=$("#question-choose option[class=parent][data-id="+a+"]"),s=i.attr("parent-id");$("#question-choose option[class=parent][data-id="+s+"]").length>0&&e.push(i.attr("parent-id"))}}}),$("#question-choose option[class=parent]").each(function(){jQuery.inArray($(this).attr("data-id"),e)==-1&&"overview"!==$(this).attr("data-type")&&$(this).remove()})}function getCriteriaType(t){switch(t){case"tcProjectType":criteriaType="projectType";break;case"tcTeam":criteriaType="team";break;case"tcPm":criteriaType="pm";break;case"tcBrse":criteriaType="brse";break;case"tcCustomer":criteriaType="customer";break;case"tcSale":criteriaType="sale";break;case"tcQuestion":criteriaType="question"}return criteriaType}function getDateDiff(t,e){var t=new Date(t),e=new Date(e),a=Math.abs(e.getTime()-t.getTime()),i=Math.ceil(a/864e5);return i}function newChart(t,e,a,i){new Chart(t,{type:i,data:{labels:Object.values(a),datasets:[{data:Object.values(e),backgroundColor:["rgba(255, 99, 132, 0.5)","rgba(255, 159, 64, 0.5)"],borderColor:["rgba(255, 99, 132, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{responsive:!0,legend:{display:!0,position:"top",align:"center",labels:{fontSize:18,padding:50}}}})}$("input").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"}),$(".date").datepicker({todayBtn:"linked",language:"it",autoclose:!0,todayHighlight:!0,dateFormat:"yy-mm-dd"});var currentDate=new Date,currentYear=(new Date).getFullYear();strLoading='<tr class="loading"><td colspan="7"><img class="loading-img" src="'+baseUrl+'sales/images/loading.gif" /></td></tr>',noResult='<tr><td colspan="7" style="text-align:center;">Không có kết quả nào được tìm thấy</td></tr>',$(document).on("icheck",function(){$("input").iCheck({checkboxClass:"icheckbox_minimal-blue",radioClass:"iradio_minimal-blue"});for(var t=["ProjectType","ProjectName","Team","Pm","Brse","Customer","Sale"],e=0;e<t.length;e++)$("#check"+t[e]).on("ifChecked",function(t){var e="."+$(this).attr("id")+"Item:visible";$(e).iCheck("check"),triggeredByChild=!1}),$("#check"+t[e]).on("ifUnchecked",function(t){var e="."+$(this).attr("id")+"Item:visible";triggeredByChild||$(e).iCheck("uncheck"),triggeredByChild=!1}),$(".check"+t[e]+"Item").on("ifUnchecked",function(t){triggeredByChild=!0;var e="#"+$(this).attr("class");e=e.replace("Item",""),$(e).iCheck("uncheck")}),$(".check"+t[e]+"Item").on("ifChecked",function(t){var e="#"+$(this).attr("class");e=e.replace("Item",""),$("."+$(this).attr("class")).filter(":checked").length==$("."+$(this).attr("class")).length&&$(e).iCheck("check")});$(".checkQuestionItem").on("ifChecked",function(t){var e=$(this).attr("data-id");$(".checkQuestionItem[parent-id="+e+"]").iCheck("check"),triggeredByChild=!1}),$(".checkQuestionItem").on("ifUnchecked",function(t){var e=$(this).attr("data-id");$(".checkQuestionItem[parent-id="+e+"]").iCheck("uncheck"),triggeredByChild=!1}),$(".team-tree-checkbox").on("ifChecked",function(t){var e=$(this).attr("data-id");$(".team-tree-checkbox[parent-id="+e+"]").iCheck("check"),triggeredByChild=!1}),$(".team-tree-checkbox").on("ifUnchecked",function(t){var e=$(this).attr("data-id");$(".team-tree-checkbox[parent-id="+e+"]").iCheck("uncheck"),triggeredByChild=!1}),$("#tcProjectType").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcProjectType]").show(),$(".no-result").hide(),$(".no-result-tcProjectType").show(),fixScroll($("table[data-id=tcProjectType] tbody"))}),$("#tcProjectName").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcProjectName]").show(),$(".no-result").hide(),$(".no-result-tcProjectName").show(),fixScroll($("table[data-id=tcProjectName] tbody"))}),$("#tcTeam").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcTeam]").show(),$(".no-result").hide(),$(".no-result-tcTeam").show(),fixScroll($("table[data-id=tcTeam] tbody"))}),$("#tcPm").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcPm]").show(),$(".no-result").hide(),$(".no-result-tcPm").show(),fixScroll($("table[data-id=tcPm] tbody"))}),$("#tcBrse").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcBrse]").show(),$(".no-result").hide(),$(".no-result-tcBrse").show(),fixScroll($("table[data-id=tcBrse] tbody"))}),$("#tcCustomer").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcCustomer]").show(),$(".no-result").hide(),$(".no-result-tcCustomer").show(),fixScroll($("table[data-id=tcCustomer] tbody"))}),$("#tcSale").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcSale]").show(),$(".no-result").hide(),$(".no-result-tcSale").show(),fixScroll($("table[data-id=tcSale] tbody"))}),$("#tcQuestion").on("ifChecked",function(t){$(".tbl-criteria").hide(),$("table[data-id=tcQuestion]").show(),$(".no-result").hide(),$(".no-result-tcQuestion").show(),fixScroll($("table[data-id=tcQuestion] tbody"))})}).trigger("icheck"),$(document).ready(function(){$(".box-select-question #question-choose").change(function(){$(".box-select-question #question-choose option[value=0]").remove();var t=$(this).val();if(0==t)$("#duoi3sao tbody").html(""),$("#duoi3sao").parent().find(".pagination").html(""),$("#danhsachdexuat tbody").html(""),$("#danhsachdexuat").parent().find(".pagination").html("");else{var e=1,a=$("#question-choose option:selected").data("cssresult"),i=$("#question-choose option:selected").data("token");getListLessThreeStarByQuestion(t,e,i,a,"result_make","desc"),getProposesQuestion(t,e,i,a,"result_make","desc")}})});