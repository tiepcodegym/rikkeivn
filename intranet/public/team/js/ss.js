function getStringli(e){for(var t=e.split("<br>"),a="",n=0;n<t.length;n++)a=a+"<li>"+t[n]+"</li>";return a}!function(e,t,a,n){var r="object"==typeof globalPassModule?globalPassModule:{},l="object"==typeof globalTrans?globalTrans:{},i="object"==typeof globalDbTrans?globalDbTrans:{},o="object"==typeof globalDataFixSelect?globalDataFixSelect:{},d="object"==typeof globalTagData?globalTagData:{},s="object"==typeof globalValueTrans?globalValueTrans:{},c="object"==typeof globalValidMess?globalValidMess:{},p={},f=e('[name="cv_view_lang"]'),m=e("[data-btn-submit]");p.lang={cookieKey:"cv_lang",init:function(){var t=this,a="en"===e.cookie(t.cookieKey)?"en":"ja";f.filter('[value="'+a+'"]').prop("checked",!0).parent().trigger("click"),t.exec(!1),f.change(function(){t.exec(!0),p.edit.calProjPeriodAll()})},getLangCur:function(){return"en"===f.filter(":checked").val()?"en":"ja"},exec:function(a){var n=this,r=n.getLangCur();e.cookie(n.cookieKey,r,{expires:7}),e('[data-lang-show]:not([data-lang-show="'+r+'"])').addClass("hidden"),e('[data-lang-show="'+r+'"]').removeClass("hidden"),e('[data-lang-readonly]:not([data-lang-readonly="'+r+'"])').removeAttr("readonly"),e('[data-lang-readonly="'+r+'"]').attr("readonly","readonly"),e("[data-lang-r]").each(function(t,a){var n=e(a).data("lang-r");"undefined"!=typeof l[r][n]?e(a).html(l[r][n]):e(a).html("")}),e("[data-lang-placeholder]").each(function(t,a){var n=e(a).data("lang-placeholder");"undefined"!=typeof l[r][n]?e(a).attr("placeholder",l[r][n]):e(a).attr("placeholder","")}),e("[data-input-cv].error").removeClass("error"),e('[data-fg-dom="mes-error"].error').html("").removeClass("error"),e("[data-db-lang]").each(function(t,a){n.viewFromDb(e(a),"db-lang","val")}),e("[data-db-lang-view]").each(function(t,a){n.viewFromDb(e(a),"db-lang-view","text")}),e("[data-db-select]").each(function(t,a){n.viewFromDb(e(a),"db-select","val")}),e("[data-db-select-view]").each(function(t,a){n.viewFromDb(e(a),"db-select-view","text")}),e(".tbl-proj-exper tbody tr.row-proj").addClass("hidden"),e('.tbl-proj-exper tbody tr[data-lang="'+r+'"]').removeClass("hidden"),a&&(p.edit.renderProjRole(),p.edit.renderProjRes(),p.edit.viewMode(),t.simple.textShort())},viewFromDb:function(t,a,n){var r,l=this,o=l.getLangCur(),d=t.data(a);"undefined"!=typeof i[d+"_"+o]&&(r=i[d+"_"+o]),r||(r=""),"address"!==d||"undefined"!=typeof i["address_"+o]&&""!==i["address_"+o]||(r=t.attr("value")),"db-select"===a?r=r.split("-"):"db-select-view"===a&&(r="",e('[data-db-select="'+d+'"]').find("option:selected").each(function(){r+=e(this).text()+", "}),r=r.slice(0,-2)),t[n](r)}},p.edit={messagesValid:{},htmlRow:{checkTr:'<i class="fa fa-circle"></i>',iconLoading:'<i class="fa fa-spin fa-refresh form-control-feedback margin-right-20 hidden" d-dom-loading></i>',overlayDom:'<div class="overlay-dom"></div>'},form:e("#form-employee-cv"),deleteData:{},newId:1,inited:!1,init:function(){var e=this;return e.setHtmlRowAdd(),e.activeTab(),e.calProjPeriodAll(),e.renderProjRole(),e.renderProjRes(),e.actionInitPage(),r.isAccess||r.isAccessTeamEdit?(e.reloadPlugin(),e.validatorInit(),e.submit(),e.actionAdd(),e.actionEdit(),e.actionDelete(),e.actionAutoAdd(),e.inputChange(),e.actionGeneral(),e.changeApprover(),void(e.inited=!0)):(e.viewMode(),!0)},renderProjRole:function(){var t=p.lang.getLangCur();e(".role-select").map(function(a,n){var r=e(n),l=r.closest('tr[data-id][data-type="proj"]').data("id"),i=s.role[l]?s.role[l].id:null;r.parent().siblings("span").text(i?o.role[t][i]:"")})},renderProjRes:function(){var t=p.lang.getLangCur();e('ul[data-dom-tagui="res"]').each(function(a,n){var r=e(this),l=r.closest('tr[data-id][data-type="proj"]'),i=l.data("id");if(r.html(""),r.data("ui-tagit")&&r.data("ui-tagit").destroy(),!i||isNaN(i)||!s.res[i]||"object"!=typeof o.res[t])return!0;var d="",c="";l.find('[data-input-cv="1"]').length&&(c=' <input type="hidden" value="{val}" name="'+r.attr("name")+'" data-input-cv="1" /> '),e.each(s.res[i],function(e,a){if(a.lang!==t)return!0;var n;a.id?o.res[t][a.id]&&(n=o.res[t][a.id],c=c.replace(/\{val\}/gi,a.id)):a.text&&(n=a.text,c=c.replace(/\{val\}/gi,n)),n&&(d+="<li>"+n+c+"</li>")}),r.html(d)})},actionGeneral:function(){e(a).on("click","td.editable",function(){var t=e(this),a=t.find("[data-dom-tagui]");return!(a.length&&a.data("ui-tagit")&&a.data("ui-tagit").tagInput.is(":visible")&&!a.data("ui-tagit").tagInput.is(":focus"))||void a.data("ui-tagit").tagInput.focus()})},validatorInit:function(){var t=this;t.messagesValid.en=e.extend({},e.validator.messages,l.more.en),e.validator.methods.optional=function(){return!1},e.validator.methods.getLength=function(e){return e.length},e.validator.methods.depend=function(){return!0},e.validator.methods.checkable=function(t){e.validator.prototype.checkable(t)},e.validator.addMethod("isChecked",function(t,a,n){return!!e(a).closest("tr[data-id][data-type]").find('input[type="checkbox"]').filter(":checked").length},"Must checked.")},submit:function(){var a=this;a.form.submit(function(e){e.preventDefault()}),m.click(function(){if(a.form.data("running"))return!0;var r=a.form.find("[data-input-cv].error:first");if(r.length)return e('[data-toggle="tab"][href="#'+r.closest(".tab-pane").attr("id")+'"]').trigger("click"),e("html, body").animate({scrollTop:r.offset().top-20}),!0;var l=e(this),i=l.data("btn-submit"),o="";if(m.prop("disabled",!0),a.form.data("running",!0),o+="_token="+siteConfigGlobal.token+"&save_type="+i,e(".overlay-par").removeClass("hidden"),2==i){var d=e("button[data-btn-action=save]"),s="";e.each(d,function(t,n){if(s=e(n).attr("class"),s.search("hidden")<0){var r=e(this).closest("tr[data-id][data-type]");if(!r.length)return!0;a.domInputChanged(r,2)}})}e.ajax({url:a.form.attr("action"),type:"POST",dataType:"json",data:o,success:function(a){return"undefined"!=typeof a.reload&&""+a.reload=="1"?(e(n).unbind("beforeunload"),n.location.reload(),!1):(e(".overlay-par").addClass("hidden"),"undefined"!=typeof a.status&&a.status?void 0:(t.notify(a.message,!1),!0))},error:function(a){"object"==typeof a&&"object"==typeof a.responseJSON&&a.responseJSON.message?t.notify(a.responseJSON.message,!1):t.notify("System error",!1),e(".overlay-par").addClass("hidden")},complete:function(t){return!("undefined"!=typeof t.reload&&""+t.reload=="1"||"undefined"!=typeof t.redirect&&t.redirect||"object"==typeof t.responseJSON&&t.responseJSON.reload)&&(a.form.data("running",!1),m.prop("disabled",!1),void e(".overlay-par").addClass("hidden"))}})})},inputChange:function(){var n=this;e(a).on("change","[data-input-cv]",function(){n.domInputChanged(e(this))});var r=e('[data-fg-dom="old"]');e('[name="employee[birthday]"]').datepicker().on("changeDate",function(e){if(!e.date)return r.text("0"),!0;var a=t.simple.diffTimeYM(moment(e.date));r.text(a.Y)}),n.calProjPeriod()},calProjPeriod:function(t){var a,n=this;a=t?t.find('[data-fg-dom="proj-date-start"], [data-fg-dom="proj-date-end"]'):e('[data-fg-dom="proj-date-start"], [data-fg-dom="proj-date-end"]'),a.on("change",function(t){var a=e(t.currentTarget).closest("tr[data-id][data-type]");n.calProjPeriodItem(a)})},calProjPeriodAll:function(){var t=this,a=p.lang.getLangCur();e('tr[data-id][data-type="proj"]').each(function(n,r){t.calProjPeriodItem(e(r),a)})},calProjPeriodItem:function(e,a){var n=this,r=e.find('[data-fg-dom="proj-period-y"]'),l=e.find('[data-fg-dom="proj-period-m"]'),i=e.find('[data-fg-dom="proj-date-start"]').val(),o=e.find('[data-fg-dom="proj-date-end"]').val();if(a||(a=p.lang.getLangCur()),!i||!o)return n.calProjPeriodItemLabel(e,a,0,0),r.text(0),l.text(0),!0;var d=t.simple.diffTimeYM(moment(i),moment(o).add(1,"M"));r.text(d.Y),l.text(d.M),n.calProjPeriodItemLabel(e,a,d.Y,d.M)},calProjPeriodItemLabel:function(e,t,a,n){if("en"!==t)return!0;var r=e.find('[d-dom-proj="period_y_label"]'),l=r.text(),i=e.find('[d-dom-proj="period_m_label"]'),o=i.text();l=l.replace(/s$/,""),o=o.replace(/s$/,""),(a>1||0===a)&&(l+="s"),(n>1||0===n)&&(o+="s"),r.text(l),i.text(o)},domInputChanged:function(a,n){var r,l=this,d=a.data("db-lang"),c=a.closest("tr[data-id][data-type]"),f=a.val();if(null===a.val())a.val("");else if(Array.isArray(a.val())){for(var m=a.val(),u=0;u<m.length;u++)m[u]||m.splice(u,1);a.val(m);var v=a.parent().find(".select2-container");v.length>0&&v.find(".select2-selection__rendered li").each(function(){var t=e(this).attr("title");"undefined"!=typeof t&&""==t.trim()&&e(this).remove()})}if("undefined"!=typeof n&&n||(n=1),!l.validate(a,f))return!1;if(2===n&&(c=a,!l.validateMulti(c)||"proj"===c.data("type")&&!l.validateMulti(c.next())))return!1;if(c.length&&1===n)return!0;d||(d=a.data("db-select")),Array.isArray(f)&&(f=f.join("-"));var g="",h="",y={remove:l.deleteData};if(2===n){if(r=a.closest("tr[data-id][data-type]"),h=c.find("[data-input-cv]").serialize(),"proj"===c.data("type")){var b=c.find(".role-select"),x=b.val();h+="&"+b.attr("name")+"="+x,h+="&"+c.next().find("[data-input-cv]").serialize()}}else r=a,h=a.serialize();return g+="_token="+siteConfigGlobal.token+"&"+e('[name="cv_view_lang"]').serialize()+"&"+e.param(y)+"&"+h,!!r.data("running")||(r.data("running",!0),c.length?(l.showHideBtn(r,"load"),r.find(".overlay-dom").removeClass("hidden"),r.find(".overlay-dom").parent().attr("style","position: unset;")):(a.nextAll("[d-dom-loading]").length||a.after(l.htmlRow.iconLoading),a.nextAll(".overlay-dom").length||a.after(l.htmlRow.overlayDom),a.nextAll("[d-dom-loading]").removeClass("hidden"),a.nextAll(".overlay-dom").removeClass("hidden")),e.ajax({url:l.form.attr("action"),type:"POST",dataType:"json",data:g,success:function(a){if("undefined"==typeof a.status||!a.status)return t.notify(a.message,!1),!0;if("string"==typeof a.message&&a.message&&t.notify(a.message),l.changeSaveType(a.save),d&&(i[d+"_"+p.lang.getLangCur()]=f),l.showHideBtn(r,"view"),2===n&&a.item_id){var c,m=r.data("id"),u=r.data("type"),v="proj"===u;if(l.viewMode(r),v&&(c=r.next(),l.viewMode(c)),isNaN(m)){r.find(".tagit").each(function(t,a){"object"==typeof e(a).data("ui-tagit")&&e(a).data("ui-tagit").destroy()}),r.find("select").each(function(t,a){"object"==typeof e(a).data("select2")&&e(a).data("select2").destroy()});var g={};r.find('input:not([type="radio"]), select, textarea').each(function(t,a){"undefined"!=typeof e(a).attr("name")&&(g[e(a).attr("name")]=e(a).val())}),v&&c.find('input[type="number"], textarea').each(function(t,a){"undefined"!=typeof e(a).attr("name")&&(g[e(a).attr("name")]=e(a).val())}),r.find('input[type="radio"], input[type="checkbox"]').each(function(t,a){e(a).is(":checked")&&e(a).attr("checked","checked")});var h=r[0].outerHTML,y=v?c[0].outerHTML:"",b=new RegExp("("+m+")","gi");r.replaceWith(h.replace(b,a.item_id)),v&&c.replaceWith(y.replace(b,a.item_id));var _=e('[data-id="'+a.item_id+'"][data-type="'+u+'"]');r=_.first(),c=v?_.last():null,r.find('input:not([type="radio"]), select, textarea').each(function(t,n){var r=e(n).attr("name");return!r||(b=new RegExp("("+a.item_id+")","gi"),r=r.replace(b,m),void("undefined"!=typeof g[r]&&e(n).val(g[r])))}),v&&c.find('input[type="number"], textarea').each(function(t,n){var r=e(n).attr("name");return!r||(b=new RegExp("("+a.item_id+")","gi"),r=r.replace(b,m),void("undefined"!=typeof g[r]&&e(n).val(g[r])))}),l.reloadPlugin(),l.calProjPeriod(r)}l.updateValueMultirow(r,a.item_id);var D,j,C,k;v&&(C=r.find('input[data-fg-dom="proj-date-start"]').val(),k=r.find('input[data-fg-dom="proj-date-end"]').val(),D=c.find('input[data-dom-input="total_member"]').val(),j=c.find('input[data-dom-input="total_mm"]').val(),l.updateValueMultirow(c,0),s.role[a.item_id]={id:x},s.role[a.projnewId]={id:x},r.find('[d-dom-proj="role"]').text(o.role[p.lang.getLangCur()][x]));var w="";if("undefined"!=typeof a.res)for(var S=0;S<a.res.length;S++){var M=a.res[S];w=""===w?'{"id":"'+M+'","text":null,"lang":"'+a.lang+'"}':Number.isInteger(M)?w+', {"id":"'+M+'","text":null,"lang":"'+a.lang+'"}':w+', {"id":null,"text":"'+M+'","lang":"'+a.lang+'"}'}var I="<script> globalValueTrans.res["+a.projnewId+"] = ["+w+"]; </script>";if("create"==a.action){var Y=r.find('[d-dom-proj="proj_number"]').text(),T="proj_"+a.projnewId+"_number_"+a.lang;if(i[T]=Y,"undefined"!=typeof a.projnewId){var A=r.clone(),E=r.next().clone();A.attr({"data-lang":a.lang,"data-id":a.projnewId,"data-input-cv":""}).addClass("hidden"),A.find("td:last-child").removeAttr("style"),A.find("td:last-child").find("div").addClass("hidden"),A.find('[data-fg-dom="proj-date-start"]').attr("value",C),A.find('[data-fg-dom="proj-date-end"]').attr("value",k),A.find("[data-view-type='tagit']").append(I),E.attr({"data-lang":a.lang,"data-id":a.projnewId,"data-input-cv":""}).addClass("hidden"),E.find('input[data-dom-input="total_member"]').attr("value",D),E.find('input[data-dom-input="total_mm"]').attr("value",j);var P=new RegExp("\\["+a.item_id+"\\]","gi"),R=new RegExp("_"+a.item_id+"_","gi"),N=A[0].outerHTML.replace(P,"["+a.projnewId+"]");N=N.replace(R,"_"+a.projnewId+"_"),N+=E[0].outerHTML.replace(P,"["+a.projnewId+"]"),e("tr[data-id][data-type=proj]:last").after(N)}}else{if("proj"!==u)return;var A=r.clone(),O=A.find('[d-dom-proj="lang"]').html(),L=A.find('[d-dom-proj="other"]').html();A.find(".tagit-close").remove(),e('table tbody [data-id="'+a.projnewId+'"] [data-dom-tagui="language"]').html(getStringli(O)),e('table tbody [data-id="'+a.projnewId+'"] [data-dom-tagui="dev_env"]').html(getStringli(L)),e('table tbody [data-id="'+a.projnewId+'"] [data-view-type="tagit"]').append(I);var V=e('tr[data-type="proj"][data-id="'+a.projnewId+'"]'),$=V.first(),F=V.last();$.find('[data-fg-dom="proj-date-start"]').val(C),$.find('[data-fg-dom="proj-date-end"]').val(k),F.find('input[data-dom-input="total_member"]').val(D),F.find('input[data-dom-input="total_mm"]').val(j)}}},error:function(e){"object"==typeof e&&"object"==typeof e.responseJSON&&e.responseJSON.message?t.notify(e.responseJSON.message,!1):t.notify("System error",!1),l.showHideBtn(r,"edit")},complete:function(e){return!("undefined"!=typeof e.reload&&""+e.reload=="1"||"undefined"!=typeof e.redirect&&e.redirect||"object"==typeof e.responseJSON&&e.responseJSON.reload)&&(c.length?(r.find(".overlay-dom").addClass("hidden"),r.find(".overlay-dom").parent().removeAttr("style")):(a.nextAll("[d-dom-loading]").addClass("hidden"),a.nextAll(".overlay-dom").addClass("hidden")),void r.data("running",!1))}}),c.length&&c.find("[data-input-cv]").attr("data-input-cv",1),void a.attr("data-input-cv",1))},changeSaveType:function(t){return 1!=t||(e(".steps-ui .current").removeClass("current"),m.filter('[data-btn-submit="3"]').remove(),void e('[d-dom-fg="box-approve"]').remove())},updateValueMultirow:function(t,a){var n=p.lang.getLangCur();if(t.find("[data-db-lang]").each(function(){var t=e(this),a=t.data("db-lang");if(!a)return!0;var r=t.val();Array.isArray(r)&&(r=r.join("-")),i[a+"_"+n]=r}),0!==a){if("object"==typeof s.res[a]){var r=[];e.each(s.res[a],function(e,t){t.lang!==n&&r.push(t)}),s.res[a]=r}else s.res[a]=[];t.find('[data-dom-tagui="res"] li').each(function(t,r){var l=e(r);l.find("span.tagit-label").length>0&&(l=l.find("span.tagit-label"));var i=l.text().trim();return!i||(isNaN(i)||s.res[a].push({id:i,text:null,lang:n}),void s.res[a].push({id:null,text:i.replace(/^n-/,""),lang:n}))})}},validateMulti:function(t){var a=this,n=!0;return t.find("[data-valid-type]").each(function(){a.validate(e(this),e(this).val())||(n=!1)}),n},validate:function(t,a){var n=this,r=t.data("valid-type"),l=t.parent().parent().find("label.error");if(l.length||(t.parent().parent().append('<label class="error hidden" data-fg-dom="mes-error"></label>'),l=t.parent().parent().find("label.error")),!r)return l.html("").addClass("hidden"),t.removeClass("error"),!0;try{"string"==typeof r&&(r=JSON.parse(r))}catch(i){return l.html("").addClass("hidden"),t.removeClass("error"),!0}var o;e.each(r,function(r,l){return"function"!=typeof e.validator.methods[r]||("required"!==r&&""===a||(!!e.validator.methods[r](a,t[0],l)||(o="undefined"==typeof n.messagesValid.en||"undefined"==typeof n.messagesValid.en[r]?"error":n.messagesValid.en[r],"function"==typeof o&&(o=o.call(this,l)),!1)))});var d=t.closest("td");return d.children(".proj-edit-date").length>0&&d.css("height",o&&d[0].scrollHeight<=205?"205px":""),o?(l.html(o).removeClass("hidden"),t.addClass("error"),!1):(l.html("").addClass("hidden"),t.removeClass("error"),!0)},setHtmlRowAdd:function(){var t=this;e("[data-row-edit]").each(function(a,n){var r=e(n).data("row-edit");t.htmlRow[r]=e(n).children("table").children("tbody").html(),e(n).remove()})},actionAdd:function(){var t=this;e(a).on("click","[data-btn-row-add]",function(a){a.preventDefault(),t.actionAddItem(e(this));var n=p.lang.getLangCur(),r="count"+n,l=e("."+r),i=l.length;e(".count").last().addClass(r).text(i+1)})},actionAddItem:function(t,a){var n=this,r=t.data("btn-row-add"),i=p.lang.getLangCur();if("undefined"==typeof n.htmlRow[r]||!n.htmlRow[r])return!0;var o,d=e(n.htmlRow[r].replace(/(\-9999)/g,"new_item_fg_"+n.newId).replace(/(data-input-cv)/g,"data-input-cv-flag")),s=t.closest("tr"),c=s.data("btn-last");c&&["before","after"].indexOf(c)!==-1||(c="before"),"proj"===r&&d.removeClass("hidden").attr("data-lang",p.lang.getLangCur()),o=e('tr[data-id][data-type="'+r+'"]:last'),o.length?o.after(d):s[c](d),n.newId++,"undefined"!=typeof a&&a!==!1||(n.editMode(d),n.reloadPlugin(),n.calProjPeriod(d),d.find("[data-lang-r]").each(function(t,a){var n=e(a).data("lang-r"),r="undefined"!=typeof l[i][n]?l[i][n]:"";e(a).html(r)}),n.calProjPeriodItem(d)),setTimeout(function(){d.find("[data-input-cv-flag]").attr("data-input-cv","0").removeAttr("data-input-cv-flag")},100)},actionDelete:function(){var n=this;e(a).on("click",'[data-btn-action="delete"]',function(){var a=e(this).closest("[data-id][data-type]"),r=a.attr("data-id"),l=a.attr("data-type"),i=a.attr("data-group"),o=i?i:l;r&&l&&!isNaN(r)&&parseInt(r)>0?t.confirm(c.confirm_delete,function(e){e.result&&n.deleteRowItem(a,r,o)},{btnOkColor:"btn-danger"}):a.remove()})},deleteRowItem:function(a,n,r){var l=this;a.data("running",!0);var i="",o={remove:{}};o.remove[r]=[n],i+="_token="+siteConfigGlobal.token+"&"+e('[name="cv_view_lang"]').serialize()+"&"+e.param(o),a.find('[d-dom-loading="tr"]').removeClass("btn-primary").addClass("btn-danger"),l.showHideBtn(a,"load"),e.ajax({url:l.form.attr("action"),type:"POST",dataType:"json",data:i,success:function(n){return"undefined"!=typeof n.status&&n.status?(t.notify(c.success_delete),a.remove(),void(e.isArray(n["delete"])&&l.deleteTrTable(n["delete"]))):(t.notify(n.message,!1),!0)},error:function(e){"object"==typeof e&&"object"==typeof e.responseJSON&&e.responseJSON.message?t.notify(e.responseJSON.message,!1):t.notify("System error",!1),a.find('[d-dom-loading="tr"]').addClass("btn-primary").removeClass("btn-danger")},complete:function(e){return!("undefined"!=typeof e.reload&&""+e.reload=="1"||"undefined"!=typeof e.redirect&&e.redirect||"object"==typeof e.responseJSON&&e.responseJSON.reload)&&(a.data("running",!1),void l.showHideBtn(a,"view"))}})},deleteTrTable:function(t){for(var a=t.length-1;a>=0;a--)e('table tr[data-id="'+t[a]+'"]').remove()},reloadPlugin:function(){var t=this;e('tr[data-type="proj"] input[data-flag-type="date"]').datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months"}),e('input[name = "employee[birthday]"]').datepicker({format:"yyyy-mm-dd",useCurrent:!1,todayHighlight:!0,weekStart:1,autoclose:!0,clearBtn:!0}),e('input[data-flag-type="date"]').on("change",function(a){t.domInputChanged(e(this))}),t.reloadSelect2()},reloadSelect2:function(){t.select2.init({templateResult:function(e){return e.loading?e.text:e.element&&parseInt(e.id)===-1?null:e.text}})},tagitPlugin:function(t){var a,n=this;a=t&&t.length?t.find("[data-dom-tagui]"):e("[data-dom-tagui]"),a.each(function(t,a){var r=e(a),l=r.data("dom-tagui"),i=r.attr("name");return!!r.data("ui-tagit")||void r.tagit({itemName:"item",fieldName:"tag",allowSpaces:!0,caseSensitive:!1,showAutocompleteOnFocus:!0,tagSource:function(t,a){if("res"===l)var n=p.lang.getLangCur(),r=o.res[n];else r=d[l];if(!r)return a([]),!0;var i=t.term.toLowerCase(),s=[];e.each(r,function(e,a){a.substr(0,t.term.length).toLowerCase()===i&&s.push(a)}),a(s)},beforeTagAdded:function(t,a){if("res"===l)var r=p.lang.getLangCur(),s=o.res[r];else s=d[l];var c,f=n.findTagByLabel(s,a.tagLabel),m=a.tag.find('input[type="hidden"][name="tag"]'),u="data-input-cv",v=0;if(c=f?f:"n-"+m.val(),a.duringInitialization?e(t.target).closest('tr[data-type="proj"]').find('[data-input-cv="1"]').length&&(v=1):(v=1,e('input[name="'+i+'"]').attr(u,v),e(t.target).closest('tr[data-type="proj"]').find("["+u+"]").attr(u,v)),a.tag.find("["+u+"]").length)a.tag.find("["+u+"]").attr(u,v);else{var g='<input type="hidden" value="'+c+'" name="'+i+'" '+u+'="'+v+'" />';a.tag.append(g)}return!0},beforeTagRemoved:function(t){e(t.target).closest('tr[data-type="proj"]').find("[data-input-cv]").attr("data-input-cv",1)}})})},findTagByLabel:function(t,a){var n=null;return t?(e.each(t,function(e,t){if(t.toLowerCase()===a.toLowerCase())return n=e,!1}),n):n},showHideBtn:function(e,t){var a,n,r;switch(t){case"edit":a="addClass",n="removeClass",r="addClass";break;case"load":a="addClass",n="addClass",r="removeClass";break;default:a="removeClass",n="addClass",r="addClass"}e.find('[d-dom-loading="tr"]')[r]("hidden"),e.find('[data-btn-action="save"]')[n]("hidden"),e.find('[data-btn-action="cancel"]')[n]("hidden"),e.find('[data-btn-action="edit"]')[a]("hidden"),e.find('[data-btn-action="delete"]')[a]("hidden")},viewMode:function(a){var n,r=this,i=p.lang.getLangCur();"undefined"!=typeof a&&a||(a=e("body")),r.showHideBtn(a,"view"),a.find('[data-mode-dom="view"]').each(function(){n=e(this);var t=n.nextAll('[data-mode-dom="edit"]:first'),a=t.children("[data-input-cv]"),o=a.val(),d=n.closest("tr");if(t.addClass("hidden"),n.removeClass("hidden"),d.removeClass("editting"),a.is("select")){var s="";return a.find("option:selected").each(function(){s+=e(this).text()+", "}),n.text(s.slice(0,-2)),!0}if(a.is('input[type="radio"]')){var c=n.data("html-val");return a.is(":checked")?r.htmlRow[c]?n.html(r.htmlRow[c]):n.text(o):n.text(""),!0}if("tagit"===t.data("view-type")){var s="",p=t.find("ul.tagit li.tagit-choice .tagit-label");return p.length||(p=t.find("ul > li")),p.each(function(){s+=htmlEntities(e(this).text().trim())+"<br>"}),n.html(s.slice(0,-4)),!0}if("total_member"===a.data("dom-input")){var f=parseInt(o)<=1&&"en"===i?l[i].member:l[i].members;return n.text(o?l[i].team+": "+o+" "+f:""),!0}return"total_mm"===a.data("dom-input")?(n.text(o?l[i].total+": "+o+" "+l[i].MM:""),!0):void n.text(o)}),a.find('[data-show-mode="view"]').removeClass("hidden"),a.removeClass("editting"),t.simple.textShort(a)},actionEdit:function(){var t=this;e(a).on("click",'[data-btn-action="edit"]',function(){var a=e(this).closest("tr[data-id][data-type]");return!a.length||(t.editMode(a),void("proj"===a.data("type")&&t.editMode(a.next())))}),e(a).on("click",'[data-btn-action="save"]',function(){var a=e(this).closest("tr[data-id][data-type]");return!a.length||void t.domInputChanged(a,2)}),e(a).on("click",'[data-btn-action="cancel"]',function(){var a=e(this).closest("tr[data-id][data-type]");return!a.length||void t.viewMode(a)})},editMode:function(t){var a=this,n=p.lang.getLangCur(),r="",l=t.attr("data-id"),i="undefined"!=typeof s.role[l]?s.role[l].id:"";a.showHideBtn(t,"edit"),Object.keys(o.role[n]).map(function(e){r+='<option value="'+e+'"'+(e===i?"selected":"")+">"+o.role[n][e]+"</option>"}),t.addClass("editting").find(".role-select").html(r),t.find('[data-show-mode="view"]').addClass("hidden"),a.tagitPlugin(t),t.find('[data-mode-dom="view"]').each(function(){var t=e(this),a=t.nextAll('[data-mode-dom="edit"]:first');t.addClass("hidden"),a.removeClass("hidden")})},actionAutoAdd:function(){var t=this,a=[];e("[data-btn-row-add]").each(function(){var t=e(this).data("btn-row-add");return!t||a.indexOf(t)>-1||void a.push(t)}),t.reloadPlugin(),t.viewMode()},activeTab:function(){var t=this;e('a[data-toggle="tab"][data-tab-title="cv-proj"]').on("shown.bs.tab",function(e){t.activeTabMain()}),setTimeout(function(){e(".tbl-proj-exper").is(":visible")&&t.activeTabMain()},200),e(n).load(function(){e(".tbl-proj-exper").is(":visible")&&t.activeTabMain()})},activeTabMain:function(){return t.tblWidth.init(),!0},changeApprover:function(){var t=this;e('[d-ss-btn="approver"]').click(function(a){a.preventDefault(),t.changeApproverSubmit(e(this))})},changeApproverSubmit:function(a){var r=this;if(a.data("process"))return!0;var l=e('[d-ss-dom="select-assign"]').val(),i=e('[d-ss-dom="select-assign"]').data("old-value");return l?l==i?r.inputImportError(c.assign_same):(r.inputImportError(""),a.data("process",!0),a.find(".loading-submit").removeClass("hidden"),a.find(".loading-hidden-submit").addClass("hidden"),a.prop("disabled",!0),e(".overlay-par").removeClass("hidden"),void e.ajax({url:a.data("action"),type:"POST",dataType:"json",data:{approverId:l,_token:siteConfigGlobal.token},success:function(a){return"undefined"!=typeof a.reload&&""+a.reload=="1"?(n.location.reload(),!0):"undefined"!=typeof a.status&&a.status?(t.notify(a.message),void e('[d-ss-dom="select-assign"]').data("old-value",l)):t.notify(a.message,!1)},error:function(e){"object"==typeof e&&e.message?t.notify(e.message,!1):"object"==typeof e&&"object"==typeof e.responseJSON&&e.responseJSON.message?t.notify(e.responseJSON.message,!1):t.notify("System error",!1)},complete:function(){a.prop("disabled",!1),a.data("process",!1),a.find(".loading-submit").addClass("hidden"),a.find(".loading-hidden-submit").removeClass("hidden"),e(".overlay-par").addClass("hidden")}})):r.inputImportError(c.field_required)},inputImportError:function(t){var a=e('[d-ss-error="select-assign"]');return!a.length||(a.html(t),void(t?a.removeClass("hidden"):a.addClass("hidden")))},actionInitPage:function(){e('[data-flag-dom="employee-left-menu"] > li').click(function(){if(e(this).hasClass("disabled"))return!1}),r.accessApprover&&e('[data-flag-dom="employee-left-menu"] > li:not(.active)').addClass("disabled")}},p["export"]={init:function(){var a=this;new Date;a.xml={ja:null,en:null},a.nameUser=e('[data-excel-render="user-name"]').text(),a.fileName="Rikkeisoft_Skillsheet_"+e('[data-excel-render="user-name"]').text().trim()+"_"+t.simple.formatDate("Ymd"),a.xmlElement=null,e('[data-fg-dom="btn-export-cv"]').click(function(){var n=e(this);if(n.data("process"))return!0;n.data("process",1),n.prop("disabled",!0),p.edit.viewMode();var l=p.lang.getLangCur();return a.xml[l]?void a.exportDataCv(a.xml[l].cloneNode(!0),n):(t.excel.getXmlFile(r.cvXmlFile[l],function(e){a.xml[l]=e,a.exportDataCv(e.cloneNode(!0),n)}),!0)})},initXmlElement:function(e){var t=this,a=e.find('Cell[d-dom="dot"] Data').text();e.find('Cell[d-dom="dot"]').removeAttr("d-dom").children().text(""),t.xmlElement={Data:e.find("Data:first").clone().text(""),textDot:a,CellSkill:{title:e.find("Cell[d-skill-title]:first").clone(),exper:e.find('Cell[d-skill="exper"]').clone(),name:e.find('Cell[d-skill="name"]').clone()},CellProj:{},tail:{proj:{},skill:{}},CellMore:{statement:{label:e.find('Cell[d-cell-label="statement"]').clone(),val:e.find('Cell[d-cell-val="statement"]').clone()},spaceProj:e.find('Row[d-row-space="proj-more"]').clone()},RowMulti:{},RowTitle:e.find('Row[d-row-multi="title"]'),StyleId:{tail:{proj:{},skill:{}}}},t.cloneDomsXml(e,t.xmlElement.CellSkill,"d-skill",["level-1","level-2","level-3","level-4","level-5"]),t.cloneDomsXml(e,t.xmlElement.CellProj,"d-proj",["name","desc","os","lang","other","responsible","start_at","period_y","end_at","period_m"]),t.cloneDomsXml(e,t.xmlElement.tail.proj,"d-proj-tail",["name","desc","os","lang","other","responsible","start_at","period_y","end_at","period_m"]),t.cloneDomsXml(e,t.xmlElement.tail.skill,"d-skill-tail",["name","level","exper"]),t.getStyleIdDomsXml(e,t.xmlElement.StyleId.tail.proj,"d-proj-tail",["name","desc","os","lang","other","responsible","start_at","period_y","end_at","period_m"]),t.getStyleIdDomsXml(e,t.xmlElement.StyleId.tail.skill,"d-skill-tail",["name","level","exper"]),t.xmlElement.RowMulti={1:e.find('Row[d-row-multi="1"]').text("").clone(),2:e.find('Row[d-row-multi="2"]').text("").clone()},t.xmlElement.RowTitle.nextAll().remove()},exportDataCv:function(a,n){var r=this,l=e(a);r.initXmlElement(l),l.find("Worksheet").attr("ss:Name",r.nameUser),r.renderBasicInfo(l),r.renderProj(l),r.renderInfoMore(l),r.renderSkillGroup(l),t.excel.saveFile(a,r.fileName,!0),n.data("process",0),n.prop("disabled",!1)},renderBasicInfo:function(t){var a=this;t.find("[d-cell-text]").each(function(t,n){var r=e(n).attr("d-cell-text");r=e('[data-excel-render="'+r+'"]').text(),r&&(r=r.trim()),a.setValForCell(e(n),r)}),t.find("[d-cell-val]").each(function(t,n){var r=e(n).attr("d-cell-val");r=e('[name="'+r+'"]').val(),r&&(r=r.trim()),a.setValForCell(e(n),r)}),t.find("[d-cell-select]").each(function(t,n){var r=e(n).attr("d-cell-select"),l="";e('select[name="'+r+'"] option:selected').each(function(){l+=e(this).text().trim()+", "}),a.setValForCell(e(n),l.slice(0,-2))})},renderProj:function(t){var a=this,n=e('[data-tbl-cv="proj"] tbody tr[data-id][data-type="proj"][data-lang="'+p.lang.getLangCur()+'"]'),r=n.length;return n.each(function(n,r){a.renderProjItem(t,e(r))}),a.changeStyleIdTailProj(t),!!r||void a.renderProjItemDemo(t)},renderProjItem:function(a,n){var r=this,l={};if(r.getValOfDomHtml(n,l,"d-dom-proj",["name","os","lang","other","responsible","start_at","end_at","period_y","period_y_label","period_m","period_m_label"]),r.getValOfDomHtml(n,l,"d-dom-proj",["desc"],"val"),l.period_y+=" "+l.period_y_label,l.period_m+=" "+l.period_m_label,!(l.name||l.os||l.lang||l.other||l.responsible||l.start_at||l.end_at))return!0;if(("0 Month"===l.period_m&&"0 Year"===l.period_y||" Month"===l.period_m&&" Year"===l.period_y||"0 月"===l.period_m&&"0 年"===l.period_y||" 月"===l.period_m&&" 年"===l.period_y)&&(!l.start_at||!l.end_at))return!1;l.desc&&(l.desc=t.excel.replaceEnterToBr(l.desc));var i=r.cloneArrayDomsXml(r.xmlElement.CellProj),o=r.cloneArrayDomsXml(r.xmlElement.RowMulti);e.each(["name","desc","os","lang","other","responsible","start_at","period_y"],function(e,t){r.setValForCell(i[t],l[t]),o[1].append(i[t])}),e.each(["end_at","period_m"],function(e,t){r.setValForCell(i[t],l[t]),o[2].append(i[t])}),a.find("Table").append(o[1]),a.find("Table").append(o[2])},changeStyleIdTailProj:function(t){var a=this,n=t.find('[d-proj="name"]:last').parent(),r=t.find('[d-proj="end_at"]:last').parent();n.children("Cell").each(function(t,n){var r=e(n).attr("d-proj");return!r||("string"!=typeof a.xmlElement.StyleId.tail.proj[r]||void e(n).attr("ss:StyleID",a.xmlElement.StyleId.tail.proj[r]))}),r.children("Cell").each(function(t,n){var r=e(n).attr("d-proj");return!r||("string"!=typeof a.xmlElement.StyleId.tail.proj[r]||void e(n).attr("ss:StyleID",a.xmlElement.StyleId.tail.proj[r]))})},renderProjItemDemo:function(t){var a=this,n=a.cloneArrayDomsXml(a.xmlElement.tail.proj),r=a.cloneArrayDomsXml(a.xmlElement.RowMulti);e.each(["name","desc","os","lang","other","responsible","start_at","period_y"],function(e,t){r[1].append(n[t])}),e.each(["end_at","period_m"],function(e,t){r[2].append(n[t])}),t.find("Table").append(r[1]),t.find("Table").append(r[2])},renderInfoMore:function(a){var n=this;a.find("Table").append(n.xmlElement.CellMore.spaceProj.clone());var r=n.xmlElement.RowMulti[1].clone(),l=n.xmlElement.CellMore.statement.label.clone(),i=n.xmlElement.CellMore.statement.val.clone(),o=e('[d-excel-br="statement"]').val();o&&(o=o.trim()),n.setValForCell(l,e('[d-excel-text="statement"]').text().trim()),n.setValForCell(i,t.excel.replaceEnterToBr(o)),r.append(l),r.append(i),a.find("Table").append(r)},renderSkillGroup:function(t){var a,n=this,r=e('[data-skill-dom="head"]').nextAll(),l=n.xmlElement.RowTitle.nextAll(),i=!1;n.RowIndexSkill=0,n.countSkillType={},n.skillTypeCur=null,r.each(function(a,r){n.renderSkill(t,l,e(r))}),n.countSkillType[n.skillTypeCur]||("object"==typeof l[n.RowIndexSkill]?a=e(l[n.RowIndexSkill]):(a=n.xmlElement.RowMulti[n.RowIndexSkill%2+1].clone(),
i=!0),n.renderSkillItemDemo(t,a,i)),n.changeStyleIdTailSkill(t)},renderSkill:function(t,a,n){var r,l=this,i=!1;if("object"==typeof a[l.RowIndexSkill]?r=e(a[l.RowIndexSkill]):(r=l.xmlElement.RowMulti[l.RowIndexSkill%2+1].clone(),i=!0),"undefined"!=typeof n.attr("d-skill-title")){null===l.skillTypeCur||l.skillTypeCur==n.attr("d-skill-title")||l.countSkillType[l.skillTypeCur]||(l.renderSkillItemDemo(t,r,i),l.RowIndexSkill++,"object"==typeof a[l.RowIndexSkill]?(r=e(a[l.RowIndexSkill]),i=!1):(r=l.xmlElement.RowMulti[l.RowIndexSkill%2+1].clone(),i=!0));var o=l.xmlElement.CellSkill.title.clone();return l.setValForCell(o,n.children('[d-skill-title="text"]').text().trim()),r.append(o),i&&t.find("Table").append(r),l.skillTypeCur=n.attr("d-skill-title"),l.countSkillType[l.skillTypeCur]=0,l.RowIndexSkill++,!0}"undefined"!=typeof n.attr("data-id")&&"undefined"!=typeof n.attr("data-type")&&l.renderSkillItem(t,r,n)&&(i&&t.find("Table").append(r),l.countSkillType[l.skillTypeCur]++,l.RowIndexSkill++)},renderSkillItem:function(t,a,n){var r=this,l={};if(r.getValOfDomHtml(n,l,"d-dom-skill",["name","exper_y","exper_y_label","exper_m","exper_m_label"]),l.exper=l.exper_y+" "+l.exper_y_label+" - "+l.exper_m+" "+l.exper_m_label,l.level=n.find('[d-dom-skill="level"]:checked').val(),!parseInt(l.exper_y)&&!parseInt(l.exper_m))return!1;if(!(l.name||l.exper_y||l.exper_m||l.level))return!1;var i=r.cloneArrayDomsXml(r.xmlElement.CellSkill);return e.each(["name","level-1","level-2","level-3","level-4","level-5","exper"],function(e,t){r.setValForCell(i[t],l[t]),a.append(i[t])}),l.level&&r.setValForCell(a.find('[d-skill="level-'+l.level+'"]'),r.xmlElement.textDot),!0},changeStyleIdTailSkill:function(t){var a=this,n=t.find('[d-skill="name"]:last').parent();n.children("Cell").each(function(t,n){var r=e(n).attr("d-skill");return!r||(r.indexOf("-")>-1&&(r=r.substr(0,r.indexOf("-"))),"string"!=typeof a.xmlElement.StyleId.tail.skill[r]||void e(n).attr("ss:StyleID",a.xmlElement.StyleId.tail.skill[r]))})},renderSkillItemDemo:function(t,a,n){var r=this,l=r.cloneArrayDomsXml(r.xmlElement.CellSkill);e.each(["name","level-1","level-2","level-3","level-4","level-5","exper"],function(e,t){a.append(l[t])}),n&&t.find("Table").append(a)},setValForCell:function(e,t){var a=this;if("undefined"==typeof t&&(t=""),e.attr("d-cell-date-format")&&t){var n=e.attr("d-cell-date-format"),r=new Date(t),l=r.getDate();l<10&&(l="0"+l);var i=r.getMonth()+1;i<10&&(i="0"+i),t=n.replace(/y/gi,r.getFullYear()).replace(/m/gi,i).replace(/d/gi,l)}if(e.attr("d-val-suffix")&&(t+=" "+e.attr("d-val-suffix")),e.children("Data").length)e.children("Data").text(t);else{var o=a.xmlElement.Data.clone();o.text(t),e.append(o)}},cloneDomsXml:function(t,a,n,r,l){return"object"==typeof a&&a||(a={}),"string"==typeof l&&l||(l=""),e.each(r,function(e,r){a[r]=t.find("Cell["+n+'="'+(l+r)+'"]').clone()}),a},getStyleIdDomsXml:function(t,a,n,r){return"object"==typeof a&&a||(a={}),e.each(r,function(e,r){a[r]=t.find("Cell["+n+'="'+r+'"]').attr("ss:StyleID")}),a},cloneArrayDomsXml:function(t){var a={};return e.each(t,function(e,t){a[e]=t.clone()}),a},getValOfDomHtml:function(t,a,n,r,l){return"object"==typeof a&&a||(a={}),"string"==typeof l&&l||(l="text"),e.each(r,function(e,r){var i=t.find("["+n+'="'+r+'"]'),o=i[l]();return o&&(o=o.trim()),"val"===l?(a[r]=o,!0):(a[r]=i.attr("title"),void(a[r]||(a[r]=o)))}),a}},p["import"]={init:function(){var t=this,a=e('[d-ss-input="file-cv"]');return!!a.length&&(t.option={type:["csv","xls","xlsx"],size:5,message_required:c.file_required,message_size:c.file_large,message_type:c.file_type+": xls, xlsx, csv"},t.file={colMin:"A".charCodeAt(0),colMax:"T".charCodeAt(0)+1,rowPS:0},t.initDataLabel(),void e('[d-ss-dom="import"]').click(function(n){n.preventDefault(),t.changeInput(e(this),a)}))},changeInput:function(a,n){var r=this;if(!n[0].files||!n[0].files[0])return r.inputImportError(r.option.message_required,n),!1;var l=n[0].files[0];return e.inArray(t.simple.getFileSplitFromPath(l.name)[2],r.option.type)===-1?(n.val(""),r.inputImportError(r.option.message_type,n),!1):l.size/1e3/1e3>r.option.size?(n.val(""),r.inputImportError(r.option.message_size,n),!1):(r.inputImportError("",n),void r.preProcessFile(l,a,n))},preProcessFile:function(t,a){var n=this,r=a.find(".loading-submit"),l=a.find(".loading-hidden-submit");return!!a.data("running")||(a.data("running",!0),a.prop("disabled",!0),r.removeClass("hidden"),l.addClass("hidden"),e(".overlay-par").removeClass("hidden"),void n.readFile(t,a))},readFile:function(e,t){var a=this,n=new FileReader;n.onload=function(e){var n=e.target.result,r=XLSX.read(n,{type:"binary",dateNF:"yyyy-mm-dd"}),l=r.SheetNames[0],i=r.Sheets[l];delete i["!margins"],delete i["!ref"],delete i["!merges"],a.messageError="",a.execData(i,t)},n.readAsBinaryString(e)},execData:function(a,r){var l=this,i=l.getValCell(a.A2),o=p.lang.getLangCur();return("en"===o&&new RegExp("情 報 処 理 技 術 者 経 歴 書(.|\r|\n|\r\n)*").test(i)||"ja"===o&&new RegExp("Developer Skill Sheet(.|\r|\n|\r\n)*","i").test(i))&&!confirm(globalValidMess.confirm_continue_import)?void l.processCompleteImport(r):(l.resetData(),l.excecDataProj(a),l.execDataBasicInfo(a),l.changeData(),l.messageError?(l.inputImportError("<ul>"+l.messageError+"</ul>"),l.processCompleteImport(r),!0):void e.ajax({url:r.attr("action"),type:"POST",dataType:"json",data:{data:JSON.stringify(l.data),_token:siteConfigGlobal.token,lang:o},success:function(e){return"undefined"!=typeof e.reload&&""+e.reload=="1"?(n.location.reload(),!0):("undefined"!=typeof e.status&&e.status||t.notify(e.message,!1),void l.processCompleteImport(r))},error:function(e){"object"==typeof e&&e.message?t.notify(e.message,!1):"object"==typeof e&&"object"==typeof e.responseJSON&&e.responseJSON.message?t.notify(e.responseJSON.message,!1):t.notify("System error",!1),l.processCompleteImport(r)}}))},processCompleteImport:function(t){t.data("running",!1),t.prop("disabled",!1),t.find(".loading-submit").addClass("hidden"),t.find(".loading-hidden-submit").removeClass("hidden"),e(".overlay-par").addClass("hidden")},execDataBasicInfo:function(e){var t,a=this;for(t=4;t<10;t++)a.execDataBasicInfoCol(e,t);a.file.rowReference>0&&a.execDataBasicInfoCol(e,a.file.rowReference)},execDataBasicInfoCol:function(t,a){for(var n=this,r=n.file.colMin;r<n.file.colMax;r++){var l=t[String.fromCharCode(r)+""+a];if("undefined"!=typeof l){var i=n.getValCell(l);e.each(n.labelColBasic,function(e,l){var o=new RegExp("^("+e+")$","i");if(!o.test(i)||"undefined"==typeof t[String.fromCharCode(r+l[4])+""+a])return!0;var d=t[String.fromCharCode(r+l[4])+""+a],s=n.getValCell(d);s&&(s=s.trim()),"undefined"!=typeof l[2]&&(s=n[l[2]](s,"undefined"!=typeof l[3]?l[3]:null)),s!==!1&&(n.data[l[0]][l[1]]=s),delete t[String.fromCharCode(r+l[4])+""+a]}),delete t[String.fromCharCode(r)+""+a]}}},excecDataProj:function(t){var a=this,n=13,r=9,l={proj:{},skill:{}};[n,r].map(function(n){for(var r=a.file.colMin;r<a.file.colMax;r++){var i=String.fromCharCode(r),o=t[i+""+n];if("undefined"!=typeof o){var d=a.getValCell(o);e.each(a.labelColSkills,function(e,t){var a=new RegExp("^("+e+")$","i");return!a.test(d)||void(l[t[0]][t[1]]={col:i,func:"undefined"!=typeof t[2]&&t[2]?t[2]:null,validate:"object"==typeof t[3]&&"object"==typeof t[3].messages&&"object"==typeof t[3].rules?t[3]:null})})}}}),a.execDataRowsProj(t,l.proj),a.execDataRowsSkill(t,l.skill)},execDataRowsProj:function(t,a){var n=this;if(e.isEmptyObject(a))return null;for(var r=14,l=!0;;){if(!(t[a.name.col+""+r]||t[a.name.col+""+(r+2)]||t[a.name.col+""+(r+4)]||t[a.name.col+""+(r+6)]))break;n.data.proj[r]={},e.each(a,function(a,i){var o=i.col+"";if(t[o+r]){var d=n.getValCell(t[o+r]);if(i.func&&(d=n[i.func](d)),i.validate&&e.each(i.validate.rules,function(e,t){switch(e){case"max":d.length>t&&(n.messageError+="<li>"+o+r+":"+i.validate.messages.max+"</li>",l=!1)}}),"name"===a)return n.data.proj[r].name=d,void("undefined"!=typeof t[o+(r+1)]&&(n.data.proj[r].description=n.getValCell(t[o+(r+1)])));if("role_team_size"===a){if(n.data.proj[r].role=d,n.data.proj[r].total_member=null,n.data.proj[r].total_mm=null,"undefined"!=typeof t[o+(r+1)]){var s=n.getValCell(t[o+(r+1)]),c=s.match(/^\s*(Team|チーム)\s*:\s*(\d+)\s*(members*|名|)\s*/i),p=s.match(/\s*(全体|Total)\s*:\s*(\d+[\.\,]?\d+|\d+)\s*(MM|)\s*$/i);c&&4===c.length&&(n.data.proj[r].total_member=c[2]),p&&4===p.length&&(n.data.proj[r].total_mm=p[2].replace(",","."))}return}if("time"===a)return n.data.proj[r].start_at=d,void("undefined"!=typeof t[o+(r+2)]&&(n.data.proj[r].end_at=n.convertDate(n.getValCell(t[o+(r+2)]))));n.data.proj[r][a]=d}delete t[i.col+""+r]}),r+=4}return n.file.rowReference=r+1,l},execDataRowsSkill:function(t,a){var n=this;if(e.isEmptyObject(a))return null;a=n.execTitleSkill(a);for(var r=10,l="lang",i=1;;)if(r++,t[a.info.tag_id.col+""+r])if(i=1,t[a.info.exp.col+""+r]){var o={};e.each(a.info,function(e,a){if(t[a.col+""+r]){var l=n.getValCell(t[a.col+""+r]);a.func&&(l=n[a.func](l)),o[e]=l}delete t[a.col+""+r]}),o.exp||(o.exp=0);var d=n.convertExpTime(o.exp,"Year");e.extend(o,d,!0),e.each(a.level,function(e,a){if(t[a.col+""+r]){var l=n.getValCell(t[a.col+""+r]);l&&(o.level=e)}delete t[a.col+""+r]}),n.data.skill[r]={},n.data.skill[r][l]=o}else l=n.getSkillTitleType(t[a.info.tag_id.col+""+r]),delete t[a.info.tag_id.col+""+r];else if(i++,i>5)break},execTitleSkill:function(t){var a={level:{},info:{},more:{}};return e.each(t,function(e,t){isNaN(e)?a.info[e]=t:a.level[e]=t}),a.info.exp&&(a.more.exp_y={col:String.fromCharCode(a.info.exp.col.charCodeAt()+1),func:null}),a},getSkillTitleType:function(t){var a,n=this,r=n.getValCell(t);return e.each(n.skillHead,function(e,t){var n=new RegExp("^("+e+")$","i");return!n.test(r)||(a=t,!1)}),a},inputImportError:function(t,a){var n=e('[data-ss-error="file-cv"]');n.length||(a.after('<p class="error hidden" data-ss-error="file-cv"></p>'),n=e('[data-ss-error="file-cv"]')),n.html(t),t?n.removeClass("hidden"):n.addClass("hidden")},initDataLabel:function(){var e=this;e.labelColBasic={"氏名|Name":["employees","name",void 0,void 0,2],"No.|序数":["employees","proj_number",void 0,void 0,2],"カナ":["employees","japanese_name",void 0,void 0,2],"性別|Gender":["employees","gender","convertGender",void 0,1],"生年月日|Date of Birth":["employees","birthday","convertDate",void 0,1],"本籍地|Place of Birth":["empl_cv_attr_values","code","convertAttr","address_home",2],"住所|Address":["empl_cv_attr_values","code","convertAttr","address",2],"出身校|Alma Mater":["empl_cv_attr_values","code","convertAttr","school_graduation",2],"対応可能分野|Compatible Field":["empl_cv_attr_values","code","convertAttr","field_dev",2],"日本語レベル(.|\r|\n|\r\n)*|Others Languages|Japanese level":["empl_cv_attr_values","code","convertAttrSingle","lang_ja_level",1],"業務経験(.|\r|\n|\r\n)*|Work experience":["empl_cv_attr_values","code","convertAttrSingle","exper_year",2],"日本常駐経験|International Work Experience":["empl_cv_attr_values","code","convertAttr","exper_japan",2],"英語レベル(.|\r|\n|\r\n)*|English(.|\r|\n|\r\n)*level":["empl_cv_attr_values","code","convertAttrSingle","lang_en_level",1],"自己PR(.|\r|\n|\r\n)*|Personal Summary(.|\r|\n|\r\n)*":["empl_cv_attr_value_texts","code","convertAttrText","statement",2],"参照(.|\r|\n|\r\n)*|Reference(.|\r|\n|\r\n)*":["empl_cv_attr_value_texts","code","convertAttrText","reference",2]},e.labelColSkills={"Previous Projects|業(.|\r|\n|\r\n)*務(.|\r|\n|\r\n)*内(.|\r|\n|\r\n)*容":["proj","name",null,{rules:{max:255},messages:{max:"Tên dự án không được lớn hơn 255 ký tự"}}],"No.|序(.|\r|\n|\r\n)*数":["proj","proj_number"],"Role(.|\r|\n|\r\n)*Team size|役割(.|\r|\n|\r\n)*規模":["proj","role_team_size"],"Programming Languages|使(.|\r|\n|\r\n)*用(.|\r|\n|\r\n)*言(.|\r|\n|\r\n)*語":["proj","lang","convertBreak"],"Environment|環(.|\r|\n|\r\n)*境":["proj","db","convertBreak"],"Assigned Phases|担(.|\r|\n|\r\n)*当(.|\r|\n|\r\n)*フ(.|\r|\n|\r\n)*ェ(.|\r|\n|\r\n)*ー(.|\r|\n|\r\n)*ズ":["proj","res","convertBreak"],"Start(.|\r|\n|\r\n)*End|開(.|\r|\n|\r\n)*始(.|\r|\n|\r\n)*終了":["proj","time","convertDate"],"Start(.|\r|\n|\r\n)*date|作(.|\r|\n|\r\n)*業(.|\r|\n|\r\n)*開(.|\r|\n|\r\n)*始":["proj","start_at","convertDate"],"End(.|\r|\n|\r\n)*date|作(.|\r|\n|\r\n)*業(.|\r|\n|\r\n)*終(.|\r|\n|\r\n)*了":["proj","end_at","convertDate"],"Ranking|ランキング":["skill","tag_id"],1:["skill","1"],2:["skill","2"],3:["skill","3"],4:["skill","4"],5:["skill","5"],"Years(.|\r|\n|\r\n)*of(.|\r|\n|\r\n)*experience|経験年数":["skill","exp"]},e.skillHead={"プログラミング言語|Languages":"lang","データベース|フレームワーク.*|Environment|Framework.*|Database":"other","プログラミング言語|OS":"os"},e.formatsDate={"^([0-9]{4})\\D+([0-9]{2})\\D+([0-9]{2})\\D*$":"YYYY-MM-DD","^([0-9]{4})\\D+([0-9]{1})\\D+([0-9]{2})\\D*$":"YYYY-M-DD","^([0-9]{4})\\D+([0-9]{1})\\D+([0-9]{1})\\D*$":"YYYY-M-D","^([0-9]{4})\\D+([0-9]{2})\\D+([0-9]{1})\\D*$":"YYYY-MM-D","^([0-9]{2})\\D+([0-9]{2})\\D+([0-9]{2})\\D*$":"YY-MM-DD","^([0-9]{2})\\D+([0-9]{1})\\D+([0-9]{2})\\D*$":"YY-M-DD","^([0-9]{2})\\D+([0-9]{1})\\D+([0-9]{1})\\D*$":"YY-M-D","^([0-9]{2})\\D+([0-9]{2})\\D+([0-9]{1})\\D*$":"YY-MM-D","^([0-9]{2})\\D+([0-9]{2})\\D+([0-9]{4})\\D*$":"DD-MM-YYYY","^([0-9]{2})\\D+([0-9]{1})\\D+([0-9]{4})\\D*$":"DD-M-YYYY","^([0-9]{1})\\D+([0-9]{2})\\D+([0-9]{4})\\D*$":"D-MM-YYYY","^([0-9]{1})\\D+([0-9]{1})\\D+([0-9]{4})\\D*$":"D-M-YYYY","^([0-9]{1})\\D+([0-9]{2})\\D+([0-9]{2})\\D*$":"D-MM-YY","^([0-9]{1})\\D+([0-9]{1})\\D+([0-9]{2})\\D*$":"D-M-YY","^([0-9]{2})\\D+([a-zA-Z]{3})\\D+([0-9]{2})\\D*$":"DD-MMM-YY","^([0-9]{1})\\D+([a-zA-Z]{3})\\D+([0-9]{2})\\D*$":"D-MMM-YY","^([0-9]{4})\\D+([0-9]{2})\\D*$":"YYYY-MM","^([0-9]{4})\\D+([0-9]{1})\\D*$":"YYYY-M","^([0-9]{2})\\D+([0-9]{2})\\D*$":"YY-MM","^([0-9]{2})\\D+([0-9]{1})\\D*$":"YY-M","^([a-zA-Z]{3})\\D+([0-9]{1})\\D+([0-9]{4})\\D*$":"MMM-D-YYYY","^([a-zA-Z]{3})\\D+([0-9]{2})\\D+([0-9]{4})\\D*$":"MMM-DD-YYYY","^([a-zA-Z]{3})\\D+([0-9]{1})\\D+([0-9]{2})\\D*$":"MMM-D-YY","^([a-zA-Z]{3})\\D+([0-9]{2})\\D+([0-9]{2})\\D*$":"MMM-DD-YY","^([a-zA-Z]{3})\\D+([0-9]{2})\\D*$":"MMM-YY","^([a-zA-Z]{3})\\D+([0-9]{4})\\D*$":"MMM-YYYY"},e.resetData()},resetData:function(){var e=this;e.data={eav:{},employees:{},eav_s:{},eav_t:{},proj:{},skill:{}}},convertGender:function(t){var a={"Male|男":1,"Female|女":0},n=null;return e.each(a,function(e,a){var r=new RegExp("^("+e+")$","i");if(r.test(t))return n=a,!1}),n},convertDate:function(t){var a=this,n=null;return e.each(a.formatsDate,function(e,a){var r=new RegExp(e,"i"),l=t.match(r);if(l){if(l[3]||(l[3]=1),("DD-MM-YYYY"===a||"D-MM-YYYY"===a||"D-MM-YY"===a)&&l[2]>12){var i=l[2];l[2]=l[1],l[1]=i}return n=moment(l[1]+"-"+l[2]+"-"+l[3],a),n=n.format("YYYY-MM-DD"),!1}}),n?n:null},convertAttr:function(e,t){var a=this;return"undefined"==typeof t&&(t=null),"exper_japan"==t&&(e=parseFloat(e)+""),a.data.eav[t]=e,!1},convertAttrText:function(e,t){var a=this;return"undefined"==typeof t&&(t=null),a.data.eav_t[t]=e,!1},convertAttrSingle:function(e,t){var a=this;return"undefined"==typeof t&&(t=null),"exper_year"==t&&(e=parseFloat(e)+""),a.data.eav_s[t]=e,!1},convertBreak:function(e){var t=[];return e.split(/\n|\r|\r\n|\,/).forEach(function(e){return!e||(!(e=e.replace(/^(\s)+|(・)|(\s)+$/gi,""))||void t.push(e))}),t},convertExpTime:function(e,t){if(!e)return{exp_y:0,exp_m:0};var a=e.match(new RegExp("^[\\s]{0,}([0-9]{1,})[\\s]{0,}(Y|年)[\\s]{0,}-[\\s]{0,}([0-9]{1,2})[\\s]{0,}(M|ヶ月)[\\s]{0,}$"));return!a||a.lenth<5?{exp_y:0,exp_m:0}:{exp_y:a[1],exp_m:a[3]}},changeData:function(){var t=this,a=t.data.eav_s.exper_year;a&&(a=a.replace(/(年|year|years).*/,"").trim(),isNaN(a)&&e.each(t.charNumberJp(),function(e,t){var n=new RegExp(""+e,"gi");a=a.replace(n,t)}),isNaN(a)&&(a=null),t.data.eav_s.exper_year=a)},getValCell:function(e){var t="undefined"!=typeof e&&"undefined"!=typeof e.w?e.w:e.v;return t?t.trim():t},charNumberJp:function(){return{"１":1,"２":2,"３":3,"４":4,"５":5,"６":6,"７":7,"８":8,"９":9,"０":0}}},p.lang.init(),e(n).load(function(){p.edit.init(),p["import"].init()})}(jQuery,RKExternal,document,window),jQuery(document).ready(function(e){e("#fb-ss").on("click",function(){e("#feedback-modal").modal("show"),e("#feedback-modal textarea").focus()}),e("#form-comment-feedback").length&&e('form[id="form-comment-feedback"]').validate({rules:{"skc[content]":"required"},messages:{"skc[content]":requiredText},submitHandler:function(t){var a=e(this).attr("action"),n=e("#ss-comment").val(),r=e("#token-comment").val(),l=e("#employeeId").val();e.ajax({type:"POST",url:a,data:{content:n,_token:r,employeeId:l},success:function(t){var a=t.name+" ("+t.email+") ";e("div.cmt-wrapper strong.cmt-created_by").text(a),e("div.cmt-wrapper span.cmt-created_at").text(t.created_at),e("div.cmt-wrapper .comment").text(t.content);var n=e(".cmt-wrapper").html();e(".grid-data-query-table").prepend(n),e("#ss-comment").val(""),e("#add-comment-feedback").removeAttr("disabled")}})}}),e("#form-review-feedback").length&&e('form[id="form-review-feedback"]').validate({rules:{fb:"required"},messages:{fb:requiredText},submitHandler:function(e){e.submit()}})}),$("body").on("click","#btn_export_cv",function(e){e.preventDefault();var t=$(this).data("url");if("undefined"!=typeof t){var a=$('[name="cv_view_lang"]:checked').val(),n=$('[name="type_export"]:checked').val();"en"!==a&&(a="ja");var r=document.createElement("form");r.setAttribute("method","post"),r.setAttribute("action",t);var l={_token:siteConfigGlobal.token,lang:a,typeExport:n,order:$("#order").attr("data-sort")};for(var i in l){var o=document.createElement("input");o.setAttribute("type","hidden"),o.setAttribute("name",i),o.setAttribute("value",l[i]),r.appendChild(o)}document.body.appendChild(r),r.submit(),r.remove()}});