function htmlEntities(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function renderTableHtml(e,t){var r="";if(!t)return r;r+="<thead><tr>";for(var a in e)r+="<td>"+htmlEntities(e[a])+"</td>";r+="</tr></thead>";for(var c=0;c<t.length;c++){var s=t[c];r+="<tr>";for(var a in e)r+="<td>"+htmlEntities(s[a])+"</td>";r+="</tr>"}return r}function s2ab(e){if("undefined"!=typeof ArrayBuffer){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a!==e.length;++a)r[a]=255&e.charCodeAt(a);return t}for(var t=[],a=0;a!==e.length;++a)t[a]=255&e.charCodeAt(a);return t}!function(e){var t="members_checked",r=RKSession.getRawItem(t);if(r){for(var a=0;a<r.length;a++)e('.table-check-list .check-item[value="'+r[a]+'"]').prop("checked",!0);e("#tbl_check_all").prop("checked",e(".table-check-list .check-item").length===e(".table-check-list .check-item:checked").length)}e(".check-all").click(function(){var t=e(e(this).data("list"));t.find(".check-item").prop("checked",e(this).is(":checked")).trigger("change")}),e("body").on("change",".check-item",function(){var r=e(this).closest(".checkbox-list").data("all"),a=e(r);if(a.prop("checked",e('[data-all="'+r+'"] .check-item').length===e('[data-all="'+r+'"] .check-item:checked').length),"#tbl_check_all"===r){var c=RKSession.getRawItem(t);if(e(this).is(":checked"))c.push(e(this).val());else{var s=c.indexOf(e(this).val());s>-1&&c.splice(s,1)}RKSession.setRawItem(t,c)}}),e(document).on("click touchstart",".btn-reset-filter",function(e){e.preventDefault(),RKSession.removeItem(t)}),e("#form_export_member").submit(function(){var r=e(this),a=r.find(".error-mess");a.addClass("hidden");var c=r.find('[name="itemsChecked"]');c.val("");var s=r.find('button[type="submit"]');if(r.find(".check-item:checked").length<1)return a.text(textNoneColSelected).removeClass("hidden"),s.prop("disabled",!1),!1;var i=RKSession.getRawItem(t);if(0===parseInt(r.find('[name="export_all"]:checked').val())&&i.length<1)return a.text(textNoneItemSelected).removeClass("hidden"),s.prop("disabled",!1),!1;var l=r.find(".icon-processing");return!!l.hasClass("hidden")&&(c.val(i.join(",")),l.removeClass("hidden"),e.ajax({method:"POST",url:r.attr("action"),data:r.serialize(),dataType:"json",success:function(t){var r=XLSX.utils.book_new(),c=t.sheetsData,s=t.colsHead;for(var i in c){for(var l=c[i],n=XLSX.utils.json_to_sheet(l),o=[],d=XLSX.utils.decode_range(n["!ref"]),h=d.s.c;h<=d.e.c;++h){var f=XLSX.utils.encode_col(h),p=f+"1";if("undefined"!=typeof n[p]){var m=n[p];"undefined"!=typeof s[m.v]&&(o[f]={t:s[m.v].t,fm:s[m.v].fm},m.v=s[m.v].tt,n[p]=m)}}n["!ref"]=XLSX.utils.encode_range(d);var u=[];for(var v in s)u.push({wch:s[v].wch});n["!cols"]=u,e.each(n,function(e,t){if("!ref"!=e||"!cols"!=e){t.s={alignment:{wrapText:1}};var r=XLSX.utils.split_cell(e),a=r[0];if(o[a]&&t.v&&r.length>1&&1!=r[1])if("d"==o[a].t){var c=moment(t.v,"DD/MM/YYYY");c.isValid()||(t.t="s")}else"n"==o[a].t&&o[a].fm?t.z=o[a].fm:t.t="s";n[e]=t}}),XLSX.utils.book_append_sheet(r,n,i)}var k=t.fileName+".xlsx",_=XLSX.write(r,{bookType:"xlsx",bookSST:!0,type:"binary",cellStyles:!0,cellDates:!0});try{saveAs(new Blob([s2ab(_)],{type:"application/octet-stream"}),k)}catch(g){return void a.text("Error export file, please try again later!").removeClass("hidden")}},error:function(e){a.text(e.responseJSON).removeClass("hidden")},complete:function(){l.addClass("hidden"),s.prop("disabled",!1)}}),!1)}),e("#modal_member_relationship_export").click(function(){e("#modal-confirm-export").modal("show")});var c=e(".list_export_cols").clone();e(".cols-sorting").click(function(t){t.preventDefault();var r=e(this),a="asc";r.hasClass("desc")&&(a="desc");var c=e(".list_export_cols li").sort(function(t,c){return"desc"===a?(r.addClass("asc").removeClass("desc"),e(t).text().toUpperCase().localeCompare(e(c).text().toUpperCase())):(r.addClass("desc").removeClass("asc"),e(c).text().toUpperCase().localeCompare(e(t).text().toUpperCase()))});e(".list_export_cols").html(c),e(".list_export_cols li input").each(function(t){e(this).attr("name","columns["+t+"]")})}),e(".cols-clear-sort").click(function(t){t.preventDefault(),c.find("li input").each(function(){var t=e(".list_export_cols li #"+e(this).attr("id")).is(":checked");t&&e(this).prop("checked",t).attr("checked","checked")}),e(".list_export_cols").html(c.html()),e(".list_export_cols li input").each(function(t){e(this).attr("name","columns["+t+"]")})})}(jQuery);