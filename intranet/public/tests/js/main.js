function twoDigit(e){return e<10?"0"+e:e}function t_setItem(e,t){"undefined"!=typeof Storage&&sessionStorage.setItem(e,t)}function t_getItem(e){if("undefined"!=typeof Storage){var t=sessionStorage[e];return"undefined"!=typeof t?t:null}return null}function t_removeItem(e){"undefined"!=typeof Storage&&localStorage.removeItem(e)}function t_setStart(){"undefined"!=typeof Storage&&localStorage.setItem("hasStarted",!0)}function t_checkStart(){if("undefined"!=typeof Storage){var e=localStorage.getItem("hasStarted");return"undefined"!=typeof e&&e}return!1}function t_delStart(){"undefined"!=typeof Storage&&localStorage.removeItem("hasStarted")}function selectSearchReload(e){optionDefault={showSearch:!1},e=jQuery.extend(optionDefault,e),e.showSearch?jQuery(".select-search").select2():(jQuery(".select-search.has-search").select2(),jQuery(".select-search:not(.has-search)").select2({minimumResultsForSearch:1/0})),jQuery(".select-search").each(function(e,t){text=jQuery(this).find("option:selected").text().trim(),redirectRikkeiCode(text),jQuery(this).siblings(".select2-container").find(".select2-selection__rendered").text(text)}),jQuery(".select-search").on("select2:select",function(e){text=jQuery(this).find("option:selected").text().trim(),jQuery(this).siblings(".select2-container").find(".select2-selection__rendered").text(text),redirectRikkeiCode(text)})}function redirectRikkeiCode(e){var t=$(".start-action-exam .start-test");"Rikkei Code"===e?(t.attr("disabled",!0),window.open(exam_url,"_blank")):t.attr("disabled",!1)}function loadErrorImage(e){return e.onerror="",e.src=window.location.origin+"/common/images/noimage.png",!0}function showModalError(e){"undefined"==typeof e&&(e="Error!"),modal_warning.find(".text-default").html(e),modal_warning.modal("show")}var modal_warning=$("#modal-warning-notification"),keyAnswers="arrAnswers";!function(e){function t(t){e.ajax({type:"POST",url:t.data("url"),data:{test_id:e("#test_id").val(),email:t.val(),_token:_token},success:function(a){var n=t.closest(".form-group").find(".error_mess");a.check?(n.html(a.message),e(".test-content").addClass("hidden"),e("#btn_submit_test").prop("disabled",!0),e(".submit-box").addClass("hidden")):(n.html(""),p>0&&e(".test-content").removeClass("hidden"),e("#btn_submit_test").prop("disabled",!1),e(".submit-box").removeClass("hidden"))}})}function a(){var t=[];return e(".q_item").each(function(){var a=e(this),n=a.find(".q_order").data("order");a.find('input[type="checkbox"]._answer').length>0&&a.find('input[type="checkbox"]._answer:checked').length<1&&t.push(n),a.find('input[type="radio"]._answer').length>0&&a.find('input[type="radio"]._answer:checked').length<1&&t.push(n);var i=a.find('input[type="text"]._answer');i.length>0&&!i.val().trim()&&t.push(n);var s=a.find("select._answer");if(s.length>0){var r=!0;s.each(function(){!e(this).val()&&r&&(r=!1)}),r||t.push(n)}}),t}function n(){clearInterval(u);var e=1e3*(60*p+_);t_setItem("originTime",e),t_setItem("startTime",(new Date).getTime()),t_setItem("testId",m),u=setInterval(i,1e3)}function i(){if(0==_)if(0==p){var t=e("#btn_submit_test"),a=!0;t.prop("disabled",!0).addClass("hidden"),clearInterval(u),e(".time-btn").removeClass("btn-flickr"),e(".test-content").addClass("hidden"),e("textarea.written_answer").map(function(t,n){""!=e(n).val()&&(a=!1)}),"showSubmit"===e("input.written_answer").val()&&(a=!1),a===!0?(t.prop("disabled",!0),g=!1,alert(mesNoAnswersForWrittenTestDoesntCount)):(g=!0,alert(text_test_time_over),e("#submit_test_form").submit())}else _=59,p--,f.text(twoDigit(p));else 1==_&&0==p&&bootbox.hideAll(),_--;p<=5&&e(".time-btn").addClass("btn-flickr"),h.text(twoDigit(_))}function s(t,a){e("html, body").animate({scrollTop:0},500);var n=e(".test-paginate .prev-page"),i=e(".test-paginate .next-page"),s=(t-1)*PER_PAGE,r=t*PER_PAGE;e(".testing-page .q_item").addClass("hidden"),e(".testing-page .q_item").slice(s,r).removeClass("hidden"),e(".test-paginate a").removeClass("active"),e('.test-paginate a[data-page="'+t+'"]').not(".next-page, .prev-page").addClass("active"),t>1?(n.removeClass("hidden"),n.data("page",t-1)):n.addClass("hidden"),t<a?(i.removeClass("hidden"),i.data("page",t+1)):i.addClass("hidden")}e(".switch-lang-form .select-lang").change(function(){var t=e(this).closest("form"),a=t.attr("action");e.ajax({type:"GET",url:a,data:{lang:e(this).val()},success:function(){window.location.reload()}})}),e("#form_auth").length>0&&e('#form_auth input[name="email"]').focus(),e("#select_form").submit(function(){return e("#test_box").val()?e("#candidate_box").length>0&&!e("#candidate_box").val()?(e("#test_error").text(text_please_select_candidate),!1):(e("#test_error").text(""),!0):(e("#test_error").text(text_please_select_test),!1)}),e("#candidate_box").length>0&&e("#candidate_box").select2({ajax:{url:url_load_candidate,dataType:"json",delay:250,data:function(e){return{q:e.term}},processResults:function(e,t){return t.page=t.page||1,{results:e.items,pagination:{more:20*t.page<e.total_count}}},cache:!0},minimumInputLength:1}),e("#submit_test_form").validate({rules:{"person[name]":{required:!0,maxlength:255},"person[email]":{required:!0,email:!0,maxlength:255},"person[phone]":{required:!0,maxlength:11}},messages:{"person[name]":{required:text_field_required,maxlength:text_max_length},"person[email]":{required:text_field_required,email:text_email_format,maxlength:text_max_length},"person[phone]":{required:text_field_required,maxlength:text_max_length_11}}}),e("#type_box").on("change",function(){if(e(this).val()){var t=e(this),a=e(this).find("option:selected"),n=e(this).val(),i=a.attr("data-parent");e("#test_box").prop("disabled",!0),e(this).prop("disabled",!0),e.ajax({url:e(this).data("url"),type:"GET",data:{type_id:n,is_group:i},success:function(t){t&&e("#test_box").html(t)},complete:function(){e("#test_box").prop("disabled",!1),t.prop("disabled",!1)}})}}),e("#test_box").on("change",function(){var t=e(this).closest("form"),a=t.data("url");t.attr("action",a+"/"+e(this).val()),e("#test_error").text("")});var r=e(".submit-box"),o=e("#header").height(),l=r.css("top");e(window).scroll(function(){var t=e(this).scrollTop();t>5?r.css("top",t-o+5):r.css("top",l)});var d=e("#person_email");if(d.length>0){var c;d.on("keyup",function(){clearTimeout(c),c=setTimeout(function(){t(d)},1e3)}),""!=d.val().trim()&&t(d)}if(e(".testing-page").length>0){var u,m=e("#test_id").val(),f=e(".time-btn .minute"),h=e(".time-btn .second"),p=parseInt(f.text()),_=parseInt(h.text());n();var g=!1;e("#btn_submit_test").click(function(){var t=!0,n=e(this),i=n.closest("form");if(e("textarea.written_answer").map(function(a,n){""!=e(n).val()&&(t=!1)}),"showSubmit"===e("input.written_answer").val()&&(t=!1),t===!0)return bootbox.dialog({closeButton:!1,className:"modal-warning modal-confirm-submit",message:mesNoAnswersForWritten,buttons:{success:{label:"Ok",callback:function(){n.prop("disabled",!1)}}}}),!1;if(e("#required_answer").html(""),n.prop("disabled",!0),!i.valid())return void n.prop("disabled",!1);var s=n.data("noti"),r=a();return r.length>0&&(s=text_questions_not_answer+": "+r.join(", ")+"<br />"+s),e(".modal-confirm-submit").modal("hide"),bootbox.confirm({className:"modal-warning modal-confirm-submit",message:s,callback:function(e){e?(g=!0,t_removeItem(keyAnswers),i.submit()):n.prop("disabled",!1)}}),!1}),e("#submit_test_form").on("submit",function(){t_removeItem(keyAnswers)}),window.onbeforeunload=function(e){if(!g)return!0},e("._answer").on("change",function(){var t,a,n=[],i=e(this).closest(".child_item");i.length>0?(a=i.data("child"),n.push(e(this).val())):(a=e(this).closest(".q_item").data("id"),e(this).closest(".q_item").find("._answer:checked").each(function(){n.push(e(this).val())})),t=localStorage.getItem(keyAnswers),t=t?JSON.parse(t):[];var s=!1;for(var r in t){var o=t[r];if(o.qid==a){o.ans=n,t[r]=o,s=!0;break}}var l={qid:a,ans:n};s||t.push(l);var d=JSON.stringify(t);if(localStorage.setItem(keyAnswers,d),"undefined"!=typeof testTemp&&"undefined"!=typeof saveTempResultUrl){var c=localStorage.getItem(keyAnswers,d);c=JSON.parse(c);for(var r in c){var o=c[r],u=e("#question_"+o.qid);if(u.length>0){var m=o.ans;for(var f in m)e("#answer_"+m[f]).prop("checked",!0)}else u=e('.child_item[data-child="'+o.qid+'"]'),u.length>0&&o.ans.length>0&&u.find("select._answer").val(o.ans[0])}}});var v=localStorage.getItem(keyAnswers);v=JSON.parse(v);for(var b in v){var x=v[b],w=e("#question_"+x.qid);if(w.length>0){var y=x.ans;for(var k in y)e("#answer_"+y[k]).prop("checked",!0)}else w=e('.child_item[data-child="'+x.qid+'"]'),w.length>0&&x.ans.length>0&&w.find("select._answer").val(x.ans[0])}}selectSearchReload(),e(document).ready(function(){if("undefined"!=typeof PER_PAGE){var t=Math.ceil(e(".testing-page .q_item").length/PER_PAGE);s(1,t),e(".test-paginate a").click(function(a){a.preventDefault();var n=e(this).data("page");"undefined"!=typeof n&&n&&s(n,t)})}})}(jQuery);