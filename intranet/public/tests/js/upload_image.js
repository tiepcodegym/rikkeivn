!function(e){function t(t,a){for(var i=!1,n=a;n>=0;n--){var r=e('.img-preview[data-index="'+n+'"]');if(r.length>0){r.after(t),i=!0;break}}i||t.prependTo(o)}function a(e){return/image\/(.*)$/i.test(e)}function i(e){return/audio\/(.*)$/i.test(e)}var n=e("#uploaded_box"),o=n.find(".list-images"),r=e("#upload_form"),d=e("#upload_field"),s=["image/jpeg","image/jpg","image/png","image/gif","audio/mp3","audio/wav","audio/wma"];e("#upload_field").click(function(){e(this).val("")});var l=[],c=-1;d.change(function(n){n.preventDefault();var o=e(this),r=new FormData;r.append("_token",_token);for(var d=o[0].files,u=0,f=0;f<d.length;f++){if(r.append("images[]",d[f]),d[f].size>5242880)return showModalError(globMess.file_max_size+" ("+d[f].name+" - "+Math.floor(d[f].size/1024)+"KB)"),void o.val("");if(s.indexOf(d[f].type)==-1)return showModalError(globMess.file_mimes+" ("+d[f].name+")"),void o.val("");u+=d[f].size,c++,l[c]=d[f];var m;if(a(d[f].type)){var p=new FileReader;!function(a){p.readAsDataURL(d[f]),p.onload=function(i){m=e("#preview_item").clone().removeAttr("id").removeClass("hidden").attr("data-index",a),m.find(".filename").text(l[a].name);var n=m.find("img");n.attr("src",i.target.result),n.src=n.prop("src"),"undefined"!=typeof EXIF?EXIF.getData(n,function(){var e=EXIF.getTag(n,"Orientation");"undefined"!=typeof e&&n.addClass("rotate-"+e),t(m,a)}):t(m,a)}}(c)}else i(d[f].type)&&(m=e("#preview_item").clone().removeAttr("id").removeClass("hidden").attr("data-index",c),m.find(".filename").text(d[f].name),m.find("img").attr("src",urlAudioIcon),t(m,c))}}),r.submit(function(){var t=e(this);e("#error_box").addClass("hidden").html("");var a=t.find('button[type="submit"]');if(l.length<1)return showModalError(globMess.no_file_selected),a.prop("disabled",!1),!1;var i=new FormData;i.append("_token",_token);var o=0;return n.find(".img-preview").each(function(){if("undefined"!=typeof e(this).attr("data-index")){var t=e(this).attr("data-index"),n=l[t];if(n){if(n.size>5242880)return showModalError(globMess.file_max_size+" ("+n.name+" - "+Math.floor(n.size/1024)+"KB)"),a.prop("disabled",!1),!1;o+=n.size,i.append("images["+t+"]",n),e(this).find(".gen-url .url").removeClass("hidden")}}}),d.prop("disabled",!0),a.find(".uploading").removeClass("hidden"),e.ajax({type:"POST",url:t.attr("action"),dataType:"json",data:i,cache:!1,contentType:!1,processData:!1,success:function(e){window.location.reload()},error:function(t){showModalError(t.responseJSON),e(".img-preview .gen-url .url").addClass("hidden")},complete:function(){a.prop("disabled",!1),d.prop("disabled",!1),a.find(".uploading").addClass("hidden")}}),!1}),e("body").on("click",".del-btn",function(t){t.preventDefault();var a=e(this).closest(".img-preview"),i=parseInt(a.attr("data-index"));l[i]=null,a.remove()});var u=e("#copy_tooltip");e("body").on("click",".copy-btn",function(){var t=e(this).closest("tr").find(".url-col .text").text(),a=document.createElement("input");a.setAttribute("value",t),document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a);var i=e(this).position();u.removeClass("hidden").css("top",i.top-32).css("left",i.left-10)}),e("body").on("mouseleave",".copy-btn",function(){u.addClass("hidden")}),e("body").on("click","#m_action_delete",function(){var t=e(this),a="",i=t.data("noti");e(".check_item:checked").each(function(){var t=e(this).closest("tr");1==parseInt(t.attr("inuse"))&&(a+="<b>-</b> "+t.find(".img-title").text()+": "+t.find(".btn-delete").attr("data-mess")+"<br />")}),""!=a?(a+=globMess.continue_delete,t.data("noti",a)):t.data("noti",i)}),e(document).ready(function(){var t=[];e(".check_item").each(function(){t.push(e(this).val())}),t.length<1||e.ajax({url:checkImageInUseUrl,type:"GET",data:{"image_ids[]":t},success:function(t){if(t.length>0)for(var a=0;a<t.length;a++){var i=t[a];i.in_use&&(e("#image_"+i.id+" .btn-delete").attr("data-noti",i.test_name+" "+globMess.continue_delete).attr("data-mess",i.test_name),e("#image_"+i.id).attr("inuse",1))}}})}),e(document).ready(function(){var t=[];e(".check_item").each(function(){t.push(e(this).val())}),t.length<1||e.ajax({url:checkImageInUseUrl,type:"GET",data:{"image_ids[]":t},success:function(t){if(t.length>0)for(var a=0;a<t.length;a++){var i=t[a];i.in_use&&e("#image_"+i.id+" .btn-delete").attr("data-noti",i.test_name)}}})})}(jQuery);