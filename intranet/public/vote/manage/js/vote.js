function showModalError(e){"undefined"==typeof e&&(e="Error!"),modal_warning.find(".text-default").html(e),modal_warning.modal("show")}function showModalConfirm(e){modal_confirm.find(".text-default").html(e),modal_confirm.modal("show")}jQuery.validator.addMethod("lessThan",function(e,t,a){var n=!1,i=$(a[0]).val();for(var o in a){var r=$(a[o]).val();r&&(n=!0,i>r&&(i=r))}return!(e&&n&&i)||(this.optional(t)||e<=i)},textValidLessThan),jQuery.validator.addMethod("greaterThan",function(e,t,a){var n=!1,i=$(a[0]).val();for(var o in a){var r=$(a[o]).val();r&&(n=!0,i<r&&(i=r))}return!(e&&n&&i)||(this.optional(t)||e>=i)},textValidGreaterThan),function(e){function t(){var t=!1;e(".vote-field").each(function(){var a=e(this),n=a.attr("data-value").trim(),i=a.val().trim(),o=e("#cke_vote_content");n!=i?(a.css("background","#fcf8e3"),a.next(".select2-container").find(".select2-selection").css("background","#fcf8e3"),o.length>0&&o.find(".cke_top").css("background","#fcf8e3"),t||(t=!0)):(a.css("background","#fff"),a.next(".select2-container").find(".select2-selection").css("background","#fff"),o.length>0&&o.find(".cke_top").css("background","#f8f8f8")),a.val()&&"vote_content"==a.attr("id")&&a.parent().find("label.error").remove()}),t?e("#change_data").val(1):e("#change_data").val(0)}function a(t){var a=t.attr("href"),n=e(a);if(!n.hasClass("loaded")){var i=n.find(".grid-data-query-table");i.html('<i class="fa fa-spin fa-refresh"></i>');var o=t.data("url");e.ajax({url:o,type:"GET",dataType:"json",success:function(e){e.success?(i.html(e.html),n.addClass("loaded")):i.html(e.message)},error:function(){i.text(textErrorMessage)}})}}var n={format:"YYYY-MM-DD HH:mm"};if(e(".create-vote-page").length>0){var i=new Date;i.setHours(0),i.setMinutes(0),n.minDate=i}e(".input_date").datetimepicker(n),e(".vote-field.input_date").on("dp.change",function(t){e("#vote_form").valid()}),e("#vote_form").validate({ignore:[],errorPlacement:function(e,t){var a=t.closest("div");a.length>0?e.appendTo(a):t.after(e.css("display","block"))},rules:{title:{required:!0,maxlength:255},status:"required",nominate_start_at:{lessThan:['input[name="nominate_end_at"]','input[name="vote_start_at"]']},nominate_end_at:{greaterThan:['input[name="nominate_start_at"]'],lessThan:['input[name="vote_start_at"]']},vote_start_at:{required:!0,greaterThan:['input[name="nominate_start_at"]','input[name="nominate_end_at"]'],lessThan:['input[name="vote_end_at"]']},vote_end_at:{required:!0,greaterThan:['input[name="vote_start_at"]']},nominee_max:{number:!0,min:0},vote_max:{number:!0,min:0},content:{required:function(){return CKEDITOR.instances.vote_content&&CKEDITOR.instances.vote_content.updateElement(),!0}}},messages:{title:{required:textValidRequired,maxlength:textValidMaxLen+" 255 "+textSymbol},status:{required:textValidRequired},nominate_start_at:{lessThan:textValidLessThan+textFieldNominateEndAt},nominate_end_at:{lessThan:textValidLessThan+textFieldVoteStartAt,greaterThan:textValidGreaterThan+textFieldNominateStartAt},vote_start_at:{required:textValidRequired,lessThan:textValidLessThan+textFieldVoteEndAt,greaterThan:textValidGreaterThan+textFieldNominateStartAt+" "+textAnd+" "+textFieldNominateEndAt},vote_end_at:{required:textValidRequired,greaterThan:textValidGreaterThan+textFieldVoteStartAt},content:{required:textValidRequired},nominee_max:{number:textValidNumber,min:textValidMin+"0"},vote_max:{number:textValidNumber,min:textValidMin+"0"}}}),e("#nominate_form_mail").validate({ignore:[],errorPlacement:function(e,t){var a=t.closest(".form-group");a.length>0?e.appendTo(a):e.appendTo(t.closest("div"))},rules:{"mail_bcc[]":{required:function(){return!e('select[name="mail_team_ids[]"]').val()}},mail_subject:{required:!0,maxlength:255},mail_content:{required:function(){return CKEDITOR.instances.mail_content&&CKEDITOR.instances.mail_content.updateElement(),!0}}},messages:{"mail_bcc[]":{required:textValidSelectTeamOrEmail},mail_subject:{required:textValidRequired,maxlength:textValidMaxLen+" 255 "+textSymbol},mail_content:{required:textValidRequired}}}),e(".validate-field").on("change",function(){e(this).val()&&e(this).parent().find("label.error").remove()}),e("#vote_form_mail").validate({ignore:[],errorPlacement:function(e,t){var a=t.closest(".form-group");a.length>0?e.appendTo(a):e.appendTo(t.closest("div"))},rules:{"mail_vote_bcc[]":{required:function(){return!e('select[name="mail_vote_team_ids[]"]').val()}},mail_vote_subject:{required:!0,maxlength:255},mail_vote_content:{required:function(){return CKEDITOR.instances.mail_vote_content&&CKEDITOR.instances.mail_vote_content.updateElement(),!0}}},messages:{"mail_vote_bcc[]":{required:textValidSelectTeamOrEmail},mail_vote_subject:{required:textValidRequired,maxlength:textValidMaxLen+" 255 "+textSymbol},mail_vote_content:{required:textValidRequired}}}),e("#add_nominee_form").validate({rules:{nominee_employee_id:{required:!0}},messages:{nominee_employee_id:{required:textValidRequired}}});var o=[];e(".mail_bcc").each(function(){var t=e(this).data("url"),a=e(this).data("voteId")||null;e(this).select2({ajax:{url:t,dataType:"json",delay:500,data:function(e){return{q:e.term,page:e.page,vote_id:a}},processResults:function(e,t){return t.page=t.page||1,e.items.map(function(e){o[e.id]=e.name}),{results:e.items,pagination:{more:20*t.page<e.total_count}}},cache:!0,minimumInputLength:1},selectOnClose:!0})}),e("body").on("keyup",".select2-search input.select2-search__field",function(t){var a=e(this).closest(".select2-container").prev(".mail_bcc");a.length>0&&32==t.keyCode&&a.select2("close")}),e("#nominee_name").length>0&&e(".mail_bcc").change(function(){e("#nominee_name").val(o[e(this).val()])}),selectSearchReload(),e("#btn_sendmail").on("click",function(){CKEDITOR.instances.vote_content&&CKEDITOR.instances.vote_content.updateElement(),t(),setTimeout(function(){1==e("#change_data").val()?showModalError(textValidSaveBeforeSendMail):(e("#sendmail_modal label.error").remove(),e("#sendmail_modal").modal("show"))},300)}),e("#btn_send_mail_vote").on("click",function(){CKEDITOR.instances.vote_content&&CKEDITOR.instances.vote_content.updateElement(),t(),setTimeout(function(){1==e("#change_data").val()?(e('a[href="#vote_info"]').click(),showModalError(textValidSaveBeforeSendMail)):(e("#modal_send_mail_vote label.error").remove(),e("#modal_send_mail_vote").modal("show"))},300)}),e("#vote_tabs li a").on("shown.bs.tab",function(t){a(e(this))}),e(document).ready(function(){a(e("#vote_tabs li.active a"));var t=[];e("#mail_vote_content").length>0&&t.push("mail_vote_content"),e("#mail_content").length>0&&t.push("mail_content"),e("#vote_content").length>0&&t.push("vote_content");var n=null;if(t.length>0)var n=RKfuncion.CKEditor.init(t);n&&n.vote_content&&(setTimeout(function(){var t=n.vote_content.getData().trim();e("#vote_content").attr("data-value",t)},500),n.vote_content.on("key",function(){e("#vote_content-error").remove()}))}),e("#nominator_modal, #voter_modal").on("show.bs.modal",function(t){var a=e(t.relatedTarget),n=a.data("url"),i=a.closest("tr").find(".td-nominee-name").text(),o=e(this);o.find(".nominee-name").text(i);var r=o.find(".grid-data-query"),s=o.find(".grid-data-query-table");n!=r.attr("data-url")&&(r.attr("data-url",n),s.html('<i class="fa fa-spin fa-refresh"></i>'),e.ajax({url:n,type:"GET",dataType:"json",success:function(t){t.success?(s.html(t.html),e(".content-more").shortContent()):s.html(t.message)},error:function(){s.text(textErrorMessage)}}))}),e("body").on("click",".edit-input .edit_btn",function(t){t.preventDefault(),e(".edit-input:not(.error)").removeClass("i_show");var a=e(this).parent();a.hasClass("i_show")||(a.find(".edit-value").height(a.height()),a.find(".edit-value").width(a.width()-16)),a.addClass("i_show"),a.find(".edit-value").focus()}),e("body").on("change",".edit-input .edit-value",function(t){var a=e(".desc-loading"),n=e(this).parent();if(!n.hasClass("updating")){var i=n.find(".value"),o=n.find(".edit-value"),r=n.attr("data-url");if(o.val().trim().length>500)return n.addClass("i_show error"),void showModalError(textValidMaxLen+" 255 "+textSymbol+" ("+o.val().trim().length+" "+textSymbol+")");a.removeClass("hidden"),n.addClass("updating"),e.ajax({url:r,type:"PUT",data:{_token:_token,description:o.val()},success:function(e){e.success?(i.text(o.val()),n.removeClass("i_show error")):(n.addClass("i_show error"),showModalError(e.message))},error:function(){n.addClass("i_show error"),showModalError(textErrorMessage)},complete:function(){a.addClass("hidden"),n.removeClass("updating")}})}}),e(document).on("click",function(t){if(!(e(t.target).closest("#modal-warning-notification").length>0)){var a=e(t.target.closest(".edit-input")),n=!1;a.length>0&&a.hasClass("i_show")&&(n=!0),e(".edit-input:not(.error)").removeClass("i_show"),n&&a.addClass("i_show")}}),e("#check_all_team").on("click",function(){var t=e(this).attr("check-label"),a=e(this).attr("not-check-label");e(this).hasClass("checked")?(e(this).text(t),e(".check_team_item").prop("checked",!1),e(this).removeClass("checked")):(e(this).text(a),e(".check_team_item").prop("checked",!0),e(this).addClass("checked"))}),e("#team_modal").on("show.bs.modal",function(t){e(".check_team_item").prop("checked",!1);var a=e(t.relatedTarget),n=a.data("field"),i=a.data("text");e(this).find("#btn_submit_team").data("field",n).data("text",i);var o=e(n).val();if(o)for(var r in o){var s=o[r];e('.check_team_item[value="'+s+'"]').prop("checked",!0)}}),e("#btn_submit_team").on("click",function(){var t=[],a="",n=e(e(this).data("field")),i=e(e(this).data("text"));if(e(".check_team_item:checked").each(function(){var n=e(this).parent().text().trim();t.push(n),a+='<option value="'+e(this).val()+'" selected></option>'}),n.html(a),t.length>0){var o=n.attr("data-relate");"undefined"!=typeof o&&e(o).parent().find("label.error").remove()}i.val(t.join(", "))}),e.fn.shortContent=function(t){var a={showChars:150,showLines:3,ellipsesText:"...",moreText:textShowMore,lessText:textShowLess};return t&&e.extend(a,t),e(document).off("click",".morelink"),e(document).on({click:function(){var t=e(this);return t.hasClass("less")?(t.removeClass("less"),t.html(a.moreText)):(t.addClass("less"),t.html(a.lessText)),t.parent().prev().toggle(),t.prev().toggle(),!1}},".morelink"),this.each(function(){var t=e(this);if(!t.hasClass("shortened")){t.addClass("shortened");var n=t.html(),i="",o=n.split("\n"),r=n,s="",l=!1;if(o.length>a.showLines&&(l=!0,n=o.splice(0,a.showLines).join("\n"),i=o.join("\n")),n.length>a.showChars?(l=!0,r=n.substr(0,a.showChars),s=n.substr(a.showChars,n.length-a.showChars)+i):(r=n,s=i),l){var d=r+'<span class="moreellipses">'+a.ellipsesText+' </span><span class="morecontent"><span>'+s+'</span> <a href="#" class="morelink">'+a.moreText+"</a></span>";t.html(d),e(".morecontent span").hide()}}})}}(jQuery);var modal_warning=$("#modal-warning-notification"),modal_confirm=$("#modal-warn-confirm");